function mergeKeyArrays(a,b){for(var c=[];a.length&&b.length;)a[0].key.toLowerCase()<b[0].key.toLowerCase()?(console.log(a[0]),console.log(b[0]),c.push(a.shift())):a[0].key.toLowerCase()===b[0].key.toLowerCase()?(console.log("equal"),c.push(a.shift()),b.shift()):(console.log(a[0]),console.log(b[0]),c.push(b.shift()));for(;a.length;)c.push(a.shift());for(;b.length;)c.push(b.shift());return c}function applyTicks(a){"intro"==a||"add"==a?($("span.glyphicon.add").addClass("hidden"),$("span.glyphicon.map").addClass("hidden"),$("span.glyphicon.validate").addClass("hidden")):"validate"==a?($("span.glyphicon.add").removeClass("hidden"),$("span.glyphicon.validate").addClass("hidden"),$("span.glyphicon.map").addClass("hidden")):"map"==a?($("span.glyphicon.add").removeClass("hidden"),$("span.glyphicon.validate").removeClass("hidden"),$("span.glyphicon.map").addClass("hidden")):"finish"==a&&($("span.glyphicon.add").removeClass("hidden"),$("span.glyphicon.map").removeClass("hidden"),$("span.glyphicon.validate").removeClass("hidden"))}function splitInput(a){var b=[],c=/\r\n|\n\r|\n|\r/g,d=a.replace(c,"\n").split("\n");if(1==d.length&&""==d[0].trim())return!1;d=$.map(d,$.trim),d.clean(""),d.clean(void 0);var e=!0,f="";return jQuery.each(d,function(a,c){var d=smilesOrInchi(c);0==a&&(f=d),d!=f&&(e=!1),b.push(c.trim())}),e?{type:f,objects:b}:!1}function smilesOrInchi(a){var b="";return b=a.trim().match(/^([^J][A-Za-z0-9@+\-\[\]\(\)\\=#$.]+)$/)?"Smiles":a.trim().match(/^((InChI=)?[^J][0-9BCOHNSOPrIFla+\-\(\)\\\/,pqbtmsih]{6,})$/gi)?"InChi":a.trim().match(/^((CHEMBL)?[0-9])$/)?"ChEMBL ID":"unknown"}function prepCustomFields(a){var b={};a.map(function(a){a.name&&a.value&&(b[a.name]=a.value)});return b}function detectIE(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);var c=a.indexOf("Trident/");if(c>0){var d=a.indexOf("rv:");return parseInt(a.substring(d+3,a.indexOf(".",d)),10)}var e=a.indexOf("Edge/");return e>0?parseInt(a.substring(e+5,a.indexOf(".",e)),10):!1}angular.module("schemaForm").run(["$templateCache",function(a){a.put("directives/decorators/bootstrap/array.html",'<div sf-array="form" class="schema-form-array {{form.htmlClass}}" ng-model="$$value$$" ng-model-options="form.ngModelOptions"><label class="control-label" ng-show="showTitle()">{{ form.title }}</label><div class="help-block" ng-show="(hasError() && errorMessage(schemaError())) || form.description" ng-bind-html="(hasError() && errorMessage(schemaError())) || form.description"></div><ol class="list-group" ng-model="modelArray" ui-sortable="draggable"><li style="cursor: move;" class="list-group-item {{form.fieldHtmlClass}}" ng-repeat="item in modelArray track by $index"><button ng-hide="form.readonly || form.remove === null || item.id" ng-click="deleteFromArray($index)" style="position: relative; z-index: 20; font-size:2em; font-weight:bold; opacity:0.5" type="button" class="close pull-right"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><sf-decorator ng-init="arrayIndex = $index" form="copyWithIndex($index)"></sf-decorator><span class="glyphicon glyphicon-move pull-right "style="color:grey;position: relative; z-index: 20; margin-top:-50px"></span></li></ol><div class="clearfix" style="padding: 15px;"><button ng-hide="form.readonly || form.add === null" ng-click="appendToArray()" type="button" class="btn {{ form.style.add || \'btn-default\' }} pull-right"><i class="glyphicon glyphicon-plus"></i> {{ form.add || \'Add\'}}</button></div></div>'),a.put("directives/decorators/bootstrap/default.html",'<div class="form-group schema-form-{{form.type}} {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false }"><label class="control-label {{form.labelHtmlClass}}" ng-class="{\'sr-only\': !showTitle()}" for="{{form.key.slice(-1)[0]}}">{{form.title}}</label> <input ng-if="!form.fieldAddonLeft && !form.fieldAddonRight" ng-show="form.key" type="{{form.type}}" step="any" sf-changed="form" placeholder="{{form.placeholder}}" class="form-control {{form.fieldHtmlClass}}" id="{{form.key.slice(-1)[0]}}" ng-model-options="form.ngModelOptions" ng-model="$$value$$" ng-disabled="form.readonly ? true : (form.isReadOnly ? form.isReadOnly(form.key) : false)" schema-validate="form" name="{{form.key.slice(-1)[0]}}" aria-describedby="{{form.key.slice(-1)[0] + \'Status\'}}"><div ng-if="form.fieldAddonLeft || form.fieldAddonRight" ng-class="{\'input-group\': (form.fieldAddonLeft || form.fieldAddonRight)}"><span ng-if="form.fieldAddonLeft" class="input-group-addon" ng-bind-html="form.fieldAddonLeft"></span> <input ng-show="form.key" type="{{form.type}}" step="any" sf-changed="form" placeholder="{{form.placeholder}}" class="form-control {{form.fieldHtmlClass}}" id="{{form.key.slice(-1)[0]}}" ng-model-options="form.ngModelOptions" ng-model="$$value$$" ng-disabled="form.readonly" schema-validate="form" name="{{form.key.slice(-1)[0]}}" aria-describedby="{{form.key.slice(-1)[0] + \'Status\'}}"> <span ng-if="form.fieldAddonRight" class="input-group-addon" ng-bind-html="form.fieldAddonRight"></span></div><span ng-if="form.feedback !== false" class="form-control-feedback" ng-class="evalInScope(form.feedback) || {\'glyphicon\': true, \'glyphicon-ok\': hasSuccess(), \'glyphicon-remove\': hasError() }" aria-hidden="true"></span> <span ng-if="hasError() || hasSuccess()" id="{{form.key.slice(-1)[0] + \'Status\'}}" class="sr-only">{{ hasSuccess() ? \'(success)\' : \'(error)\' }}</span><div class="help-block" sf-message="form.description"></div></div>'),a.put("directives/decorators/bootstrap/select.html",'<div class="form-group {{form.htmlClass}} schema-form-select" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false}"><label class="control-label {{form.labelHtmlClass}}" ng-show="showTitle()">{{form.title}}</label><select ng-model="$$value$$" ng-model-options="form.ngModelOptions" ng-disabled="form.readonly ? true : (form.isReadOnly ? form.isReadOnly(form.key) : false)"  sf-changed="form" class="form-control {{form.fieldHtmlClass}}" schema-validate="form" ng-options="item.value as item.name group by item.group for item in form.titleMap" name="{{form.key.slice(-1)[0]}}"></select><div class="help-block" sf-message="form.description"></div></div>')}]),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider","sfBuilderProvider",function(a,b,c,d){var e=(d.builders.simpleTransclusion,d.builders.ngModelOptions),f=d.builders.ngModel,g=d.builders.sfField,h=d.builders.condition,i=d.builders.array;b.addMapping("bootstrapDecorator","filtereddropdown","views/templates/filtered-dropdown-form-template.html",[g,e,f,i,h]),b.createDirective("filtereddropdown","views/templates/filtered-dropdown-form-template.html")}]),angular.module("schemaForm").controller("filtereddropdownController",["$scope","$rootScope","$timeout","$filter",function(a,b,c,d){a.loading=!0,a.opened=function(c,d){b.$broadcast(a.form.options.fetchDataEventName,{key:c,autocomplete:d})},a.autoComp="",a.form.options.staticItems&&a.form.options.staticItems.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0}),a.form.options.dataArrivesEventName&&a.$on(a.form.options.dataArrivesEventName,function(b,c){if(a.autoComp==c.autocomplete){a.numberItemsMissing=c.unique_count-c.items.length,a.loading=!1;var e=[];a.form.options.staticItems&&(e=angular.copy(a.form.options.staticItems));var f=d("filter")(e,{key:a.autoComp});if(a.items=mergeKeyArrays(c.items,f),a.autoComp){var g=!1;angular.forEach(a.items,function(b){b.key.toLowerCase()==a.autoComp.toLowerCase()&&(g=!0)}),g?a.autoCompNotInList=void 0:a.form.options.tagging?a.autoCompNotInList={key:a.autoComp,doc_count:0}:a.autoCompNotInList=void 0}else a.autoCompNotInList=void 0}}),a.$watch("autoComp",function(b,c){b!=c&&a.opened(a.form.key,a.autoComp)}),a.autoCompNotInList=void 0,a.newTags=[],a.newTagsObjects=[],a.form.options.multiple?(a.checkItem=function(a,b){return angular.isDefined(b)?b.indexOf(a):-1},a.toggleItem=function(b,d){c(function(){a.$apply(function(){var c;c=a.model[a.form.key[0]].indexOf(b.key);var e=a.newTags.indexOf(b.key);-1==c?(a.model[a.form.key[0]].push(b.key),d&&(a.newTags.push(b.key),a.newTagsObjects.push(b),a.autoComp=""),a.autoCompNotInList=void 0):(a.model[a.form.key[0]].splice(c,1),d&&(a.newTags.splice(e,1),a.newTagsObjects.splice(e,1)))}),a.evalExpr(a.form.onChange,{modelValue:a.model[a.form.key[0]],form:a.form})})}):(a.checkItem=function(a,b){return angular.isDefined(b)&&b==a?1:-1},a.toggleItem=function(b,d){c(function(){a.$apply(function(){var c=!1;a.model[a.form.key[0]]==b.key&&(c=!0);var e=a.newTags.indexOf(b.key);c?(a.model[a.form.key[0]]="",d&&a.newTags.splice(e,1)):(a.newTags.indexOf(a.model[a.form.key[0]])>-1&&(a.newTags=[]),a.model[a.form.key[0]]=b.key,d&&(a.newTags.push(b.key),a.autoComp=""),a.autoCompNotInList=void 0),a.newTagsObjects=a.newTags.map(function(a){return{key:a}})}),a.evalExpr(a.form.onChange,{modelValue:a.model[a.form.key[0]],form:a.form})})}),a.items=[]}]),angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(a,b,c){var d=function(b,d,e){if("string"===d.type&&"chemdoodle"==d.format){var f=a.stdFormObj(b,d,e);return f.key=e.path,f.type="chemdoodle",e.lookup[c.stringify(e.path)]=f,f}};a.defaults.object.unshift(d),b.addMapping("bootstrapDecorator","chemdoodle","views/templates/chemdoodle-form-template.html")}]);var lightApp=angular.module("lightApp",["angular-underscore/filters","schemaForm","pascalprecht.translate","ui.select","ui.sortable"]),chembiohubAssayApp=angular.module("chembiohubAssayApp",["chemdoodleAngular","lightApp","ngAnimate","ngCookies","ngMessages","ngResource","ngGrid","ngSanitize","ngTouch","ui.router","ui.bootstrap","ui.ace","dndLists","flow","ngClipboard","ngRaven","angular-underscore/filters","schemaForm","pascalprecht.translate","ui.select","ui.sortable","angularUtils.directives.dirPagination","angular-info-box","elasticui","schemaForm-file-upload","xeditable"]),arr=window.location.href.split("/"),part="dev/api",bit="",admin_base="/",base=arr[0]+"//"+arr[2];"localhost:9000"!=arr[2]?(bit=arr[3],part=bit+"/api",base=arr[0]+"//"+arr[2]+"/"+bit+"/"):admin_base="http://localhost:8000/";var path=arr[0]+"//"+arr[2]+"/"+part+"/",admin_url=admin_base+part,configuration={cbh_batch_upload:{list_endpoint:path+"cbh_batch_upload",schema:path+"cbh_batch_upload/schema"},cbh_project_types:{list_endpoint:path+"cbh_project_types",schema:path+"cbh_project_types/schema"},cbh_permissions:{list_endpoint:path+"cbh_permissions",schema:path+"cbh_permissions/schema"},cbh_projects:{list_endpoint:path+"cbh_projects",schema:path+"cbh_projects/schema"},cbh_saved_search:{list_endpoint:path+"cbh_saved_search",schema:path+"cbh_saved_search/schema"},cbh_plate_map:{list_endpoint:path+"cbh_plate_map",schema:path+"cbh_plate_map/schema"},cbh_skinning:{list_endpoint:path+"cbh_skinning",schema:path+"cbh_skinning/schema"},cbh_compound_batches:{list_endpoint:path+"cbh_compound_batches",schema:path+"cbh_compound_batches/schema"},cbh_compound_batches_v2:{list_endpoint:path+"cbh_compound_batches_v2",schema:path+"cbh_compound_batches_v2/schema"},users:{list_endpoint:path+"users",schema:path+"users/schema"},invitations:{list_endpoint:path+"invitations",schema:path+"invitations/schema"},cbh_draft_data:{list_endpoint:path+"datastore/cbh_draft_data",schema:path+"datastore/cbh_draft_data/schema"},cbh_multiple_batches:{list_endpoint:path+"cbh_multiple_batches",schema:path+"cbh_multiple_batches/schema"},cbh_chemical_search:{list_endpoint:path+"cbh_chemical_search",schema:path+"cbh_chemical_search/schema"},instance_path:{url_frag:path,base:base,bit:bit},cbh_custom_field_configs:{list_endpoint:path+"cbh_custom_field_configs",schema:path+"cbh_custom_field_configs/schema"},cbh_queries:{list_endpoint:path+"cbh_queries",schema:path+"cbh_queries/schema"},admin:{list_endpoint:admin_url}};angular.module("chembiohubAssayApp").value("urlConfig",configuration),angular.module("chembiohubAssayApp").value("prefix",part);var initInjector=angular.injector(["ng"]),$http=initInjector.get("$http"),$q=initInjector.get("$q"),$timeout=initInjector.get("$timeout"),schemaGetter=function(a){var b={type:"object",properties:{},required:[]};return angular.forEach(a,function(a){angular.extend(b.properties,angular.copy(a.edit_schema.properties)),a.required&&b.required.push(a.name)}),b},viewFormGetter=function(a,b,c){angular.isDefined(b)||(b="col-xs-12");var d=[];return angular.forEach(a,function(a){var b=angular.copy(a.view_form.form);d.push(b)}),d},formGetter=function(a,b,c){angular.isDefined(b)||(b="col-xs-12");var d=[];return angular.forEach(a,function(a){var c=angular.copy(a.edit_form.form[0]);c.htmlClass=b,d.push(c)}),d};angular.module("chembiohubAssayApp").factory("CustomFieldConfig",function(){return{getSchema:schemaGetter,getForm:formGetter}});var skinReq=$http({method:"get",url:configuration.cbh_skinning.list_endpoint}),projReq=$http({method:"get",url:configuration.cbh_projects.list_endpoint,params:{do_cache:!0,limit:1e3,project_type__saved_search_project_type:!1}}),userReq=$http({method:"get",url:configuration.users.list_endpoint,params:{limit:1e4}});$q.all([skinReq,projReq,userReq]).then(function(a){var b=a[0],c=a[1],d=a[2];b.data.objects[0].tabular_data_schema=angular.copy(c.data.tabular_data_schema),b.data.objects[0].refresh_tabular_schema=function(){b.data.objects[0].tabular_data_schema.copied_schema=angular.copy(b.data.objects[0].tabular_data_schema.schema)},b.data.objects[0].get_table_schema_by_name=function(a){var c=b.data.objects[0].tabular_data_schema.included_in_tables[a]["default"].map(function(a){return b.data.objects[0].tabular_data_schema.copied_schema[a]});return c},b.data.objects[0].get_filtered_table_schema=function(a,c){var d=c.map(function(a){return a.id}),e=b.data.objects[0].get_table_schema_by_name(a),f=[];return angular.forEach(e,function(a){var b=!1;a.project_specific_schema?angular.forEach(a.project_specific_schema,function(a,c){d.indexOf(parseInt(c))>-1?b=!0:0==d.length&&(b=!0)}):b=!0,b&&f.push(a)}),f},angular.module("chembiohubAssayApp").value("skinConfig",b.data),angular.module("chembiohubAssayApp").value("userList",d.data.objects);var e=null;angular.forEach(d.data.objects,function(a){a.is_logged_in&&(e=a)}),angular.module("chembiohubAssayApp").value("loggedInUser",e),angular.forEach(c.data.objects,function(a){a.schemaform={form:formGetter(a.custom_field_config.project_data_fields,"col-xs-12",a),schema:schemaGetter(a.custom_field_config.project_data_fields),viewForm:viewFormGetter(a.custom_field_config.project_data_fields)}}),angular.module("chembiohubAssayApp").value("projectList",c.data);var f=c.data.objects.map(function(a){return a.project_key});window.projectKeys=f,window.projectUrlMatcher="/{projectKey:"+f.join("|")+"}/",angular.element(document).ready(function(){angular.bootstrap(angular.element(document.querySelector("#bodytest")),["chembiohubAssayApp"])})}),angular.module("chembiohubAssayApp").constant("euiHost",arr[0]+"//"+arr[2]+"/"+part+"/datastore"),angular.module("elasticsearch",[]).factory("esFactory",["$http","$q",function(a,b){return function(c){return{search:function(d){var e=b.defer(),f=b.defer();return a({method:"POST",url:c.host+"/"+d.index+"/_search",params:{size:d.size,from:d.from},data:d.body.toJSON(),timeout:e.promise}).then(function(a){f.resolve(a.data)},function(){f.reject.apply(this,arguments)}),f.promise.abort=function(){e.resolve()},f.promise["finally"](function(){f.promise.abort=angular.noop,e=f=null}),f.promise}}}}]),window.searchParamsString="?pids=&page=&compoundBatchesPerPage=&viewType=&limit&offset&encoded_query=&encoded_sorts=&encoded_hides=&textsearch=&chemical_search_id=",window.searchResolve={gridconfig:["CompoundListSetup",function(a){return a}],projectFactory:["ProjectFactory",function(a){return a}],messages:["MessageFactory",function(a){return a.getMessages()}]},angular.module("chembiohubAssayApp").provider("modalState",["$stateProvider",function(a){var b=this;this.$get=function(){return b},this.state=function(b,c){var d;return a.state(b,{url:c.url,onEnter:["$modal","$state",function(a,e){d=a.open(c),d.result["finally"](function(){d=null,e.$current.name===b&&e.go("^")})}],onExit:function(){d&&d.close()}}),this}}]).config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","modalStateProvider",function(a,b,c,d){b.when("","/projects/list"),b.otherwise("/404"),c.defaultSquashPolicy("slash");a.state("cbh",{url:"",templateUrl:"views/cbh.html","abstract":!0,controller:"CbhCtrl",controllerAs:"cbh"}).state("404",{url:"/404",templateUrl:"404.html",controller:["$scope",function(a){}]}).state("cbh.search",{url:"/search?creator_uri=textsearch=created_by=editMode=&archived=&scroll=&scrollTop=&sorts=&page=&compoundBatchesPerPage=&project__project_key__in&functional_group&flexmatch&related_molregno__chembl__chembl_id__in&with_substructure&similar_to&fpValue&created__gte&created__lte&molfile&smiles&search_custom_fields__kv_any&multiple_batch_id=&viewType=&doScroll=&showBlanks=&showNonBlanks=&limit&offset&justAdded=",resolve:{gridconfig:["CompoundListSetup",function(a){return a}],projectFactory:["ProjectFactory",function(a){return a}],messages:["MessageFactory",function(a){return a.getMessages()}]},views:{"":{templateUrl:"views/search.html"},"form@cbh.search":{controller:"SearchCtrl",templateUrl:"views/templates/search-template.html"},"newresults@cbh.search":{templateUrl:"views/compound-list-new.html",controller:"CompoundbatchCtrl"}}}).state("cbh.searchv2",{url:"/searchv2"+window.searchParamsString+"&editMode=",resolve:angular.copy(window.searchResolve),params:{archived:void 0},views:{"":{templateUrl:"views/search.html",controller:["$scope","$state",function(a,b){a.$state=b}]},"form@cbh.searchv2":{controller:"Searchv2Ctrl",templateUrl:"views/templates/search-templatev2.html"},"newresults@cbh.searchv2":{templateUrl:"views/compound-list-newv2.html",controller:"Compoundbatchv2Ctrl"}}}).state("cbh.archiveitems",{url:"/archiveitems"+window.searchParamsString,resolve:angular.copy(window.searchResolve),params:{archived:!1},views:{"":{templateUrl:"views/search.html",controller:["$scope","$state",function(a,b){a.$state=b}]},"form@cbh.archiveitems":{controller:"Searchv2Ctrl",templateUrl:"views/templates/search-templatev2.html"},"newresults@cbh.archiveitems":{templateUrl:"views/compound-list-newv2.html",controller:"Compoundbatchv2Ctrl"}}}).state("cbh.restoreitems",{url:"/restoreitems"+window.searchParamsString,resolve:angular.copy(window.searchResolve),params:{archived:!0},views:{"":{templateUrl:"views/search.html",controller:["$scope","$state",function(a,b){a.$state=b}]},"form@cbh.restoreitems":{controller:"Searchv2Ctrl",templateUrl:"views/templates/search-templatev2.html"},"newresults@cbh.restoreitems":{templateUrl:"views/compound-list-newv2.html",controller:"Compoundbatchv2Ctrl"}}}).state("cbh.search_assays",{url:"/search-assays?textsearch=&l0=&l1=&l2=&start=&end=&useruris=",resolve:{},templateUrl:"views/searchassays.html",controller:"SearchAssaysCtrl",controllerAs:"searchassay"}).state("cbh.help",{url:"/help",resolve:{messages:["MessageFactory",function(a){return a.getMessages()}]},templateUrl:"views/help.html",controller:["$scope","$rootScope","$anchorScroll","$location",function(a,b,c,d){a.slides=[{image:"images/add-compounds-v2.37e0a762.gif",text:"Adding compounds"},{image:"images/searching-v2.e6adb6f0.gif",text:"Searching by tag"},{image:"images/searching-struc-v2.cb29fb82.gif",text:"Searching by structure"}],b.projName="",a.scrollTo=function(a){d.hash(a),c()}}]}).state("cbh.projects",{url:"/projects",resolve:{gridconfig:["CompoundListSetup",function(a){return a}],messages:["MessageFactory",function(a){return a.getMessages()}]},templateUrl:"views/projects.html",controller:"ProjectCtrl"}).state("cbh.users",{url:"/users",templateUrl:"views/users-list.html",resolve:{userList:["UserFactory",function(a){return a.get().$promise}],messages:["MessageFactory",function(a){return a.getMessages()}]},controller:["$scope","$rootScope","userList",function(a,b,c){a.users=c.objects,b.projName="Projects"}]}).state("cbh.user",{url:"/user/:username",templateUrl:"views/user-profile.html",resolve:{userFromList:["UserFactory","$stateParams","$q",function(a,b,c){var d=c.defer();return a.get({username:b.username},function(a){d.resolve(a)}),d.promise}],batchesForUser:["CBHCompoundBatch","userFromList","$q",function(a,b,c){var d=c.defer();return a.multiBatchForUser(b.objects[0].username).then(function(a){d.resolve(a)}),d.promise}],messages:["MessageFactory",function(a){return a.getMessages()}]},controller:["$scope","$rootScope","userFromList","batchesForUser",function(a,b,c,d){a.userFromList=c.objects[0],a.batchesForUser=d.objects,b.projName="Projects"}]}).state("cbh.home",{url:"/home",templateUrl:"views/user-profile.html",controller:["$scope","$rootScope","loggedInUser","urlConfig","$filter",function(a,b,c,d,e){a.links=[],a.userFromList=c,a.loadSavedSearches=function(){var b=e("encodeParamForSearch")({field_path:"created_by",value:c.display_name}),f={encoded_query:b};$http.get(d.cbh_saved_search.list_endpoint+"/",{params:f}).then(function(b){a.links=b.data.objects,a.$apply()})},a.loadSavedSearches()}]}).state("cbh.projects.list",{url:"/list",templateUrl:"views/projects-list.html",controller:"ProjectlistCtrl"}).state("cbh.projects.project",{url:window.projectUrlMatcher,templateUrl:"views/project-full.html",controller:["$scope","$rootScope","$state","projectKey",function(a,b,c,d){b.projectKey=d,a.cbh.searchPage=function(){c.go("cbh.search",{project__project_key__in:d},{reload:!0})}}],resolve:{projectKey:["$stateParams",function(a){return a.projectKey}]}}).state("cbh.projects.project.addcompounds",{url:"addcompounds/?mb_id=&warningsFilter=&page=&compoundBatchesPerPage=&sorts=",templateUrl:"views/add-compounds2.html",controller:"AddCompoundsCtrl"}).state("cbh.projects.project.addsingle",{url:"addsingle/?mb_id=&warningsFilter=&idToClone=",templateUrl:"views/add-single-compound.html",controller:"AddSingleCompoundCtrl",params:{idToClone:void 0},resolve:{mol:["CBHCompoundBatch","$stateParams","$timeout",function(a,b,c){return b.idToClone?a.get(b.idToClone).then(function(a){return a.customFields=a.custom_fields,a}):{molecule:"",customFields:{},supplementaryFields:[]}}]}}).state("cbh.projects.project.assay",{url:"assay/",controllerAs:"assayctrl","abstract":!0,resolve:{project_with_forms:["projectKey","AddDataFactory",function(a,b){return b.pwf.get({project_key:a},function(a){return a}).$promise}]},controller:["$scope","$stateParams","$rootScope","AddDataFactory","project_with_forms","projectKey","CustomFieldConfig",function(a,b,c,d,e,f,g){var h=this;h.dfc_lookup={},h.proj=e.objects[0],a.cbh.appName="AssayReg",angular.forEach(h.proj.data_form_configs,function(a){a.get_main_schema=function(){return g.getSchema(a[a.last_level].project_data_fields)},a.get_main_form=function(){return g.getForm(a[a.last_level].project_data_fields)},h.dfc_lookup[a.resource_uri]=a,"l0"==a.last_level&&(h.l0_dfc=a,h.l0_cfc=h.l0_dfc.l0,h.l0_schema=a.get_main_schema(),h.l0_form=a.get_main_form())}),angular.forEach(h.proj.data_form_configs,function(a){a.full_permitted_children=a.permitted_children.map(function(a){return h.dfc_lookup[a]})})}],templateUrl:"views/demo-add.html"}).state("cbh.projects.project.assay.add_data",{url:"add_data/:dc?lev=&data_form_id=",templateUrl:"views/add-data.html",controller:"AddDataCtrl",controllerAs:"addctrl"}).state("cbh.projects.project.assay.edit_data",{url:"edit_data/:dc?lev=",templateUrl:"views/edit-data.html",controller:"EditDataCtrl",controllerAs:"editctrl"}).state("cbh.projects.project.assay.view_data",{url:"view_data/:dc",templateUrl:"views/view-data.html",controller:"ViewDataCtrl",controllerAs:"viewctrl"}).state("cbh.projects.project.assay.data_overview",{url:"data_overview/",templateUrl:"views/data-overview.html",controller:"DataOverviewCtrl",controllerAs:"dataoverviewctrl"}).state("cbh.projects.project.addplate",{url:"add_plate/",templateUrl:"views/add_plate.html",controller:"PlatemapCtrl"}).state("cbh.projects.project.listplates",{url:"plates/?plate=&page=&compoundBatchesPerPage=",templateUrl:"views/list_plates.html",controller:"PlatemapCtrl"}),d.state("cbh.searchv2.record",{url:"/:uniqId?edit=",templateUrl:"views/templates/single-compound-full.html",size:"lg",controller:"SinglemolCtrl"}).state("cbh.archiveitems.record",{url:"/:uniqId?edit=",templateUrl:"views/templates/single-compound-full.html",size:"lg",controller:"SinglemolCtrl"}).state("cbh.restoreitems.record",{url:"/:uniqId?edit=",templateUrl:"views/templates/single-compound-full.html",size:"lg",controller:"SinglemolCtrl"})}]).run(["$http","$cookies","$rootScope","$document","$state","$urlMatcherFactory","LoginService","projectList","urlConfig","prefix",function(a,b,c,d,e,f,g,h,i,j){var k=j.split("/")[0];a.defaults.headers.post["X-CSRFToken"]=b[k+"csrftoken"],a.defaults.headers.patch["X-CSRFToken"]=b[k+"csrftoken"],a.defaults.headers.put["X-CSRFToken"]=b[k+"csrftoken"];var l=h.objects.map(function(a){return a.project_key});c.urlMatcher=f.compile("/{projectKey:"+l.join("|")+"}/?limit&offset"),c.$on("$stateChangeSuccess",function(a,b){d.scrollTop(0,0)}),c.$on("$stateChangeError",function(a,b,c,d,e,f){console.log(f)})}]).factory("authHttpResponseInterceptor",["$q","$location","urlConfig",function(a,b,c){return{response:function(b){return 401===b.status&&console.log("Response 401"),b||a.when(b)},responseError:function(b){return a.reject(b)}}}]).config(["ngClipProvider",function(a){a.setPath("bower_components/zeroclipboard/dist/ZeroClipboard.swf")}]).factory("globalInterceptor",["$q","$raven",function(a,b){return{response:function(b){return b||a.when(b)},responseError:function(b){return["4","5"].indexOf(b.status.toString().substring(0,1))>-1&&Raven.captureException(JSON.stringify(b.config),{extra:b.data}),a.reject(b)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authHttpResponseInterceptor"),a.interceptors.push("globalInterceptor")}]),angular.module("chembiohubAssayApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),Array.prototype.chunk=function(a){var b=this;return[].concat.apply([],b.map(function(c,d){return d%a?[]:[b.slice(d,d+a)]}))},Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this};var app=angular.module("chembiohubAssayApp");app.factory("ChEMBLFactory",["$http",function(a){var b=function(b,c){var d=this,e="http://dee.sgc.ox.ac.uk:8000/chemblws/compounds/";this.queryChembl=function(b){var c=a.get(b);c.then(function(a){d.data=a.data.compounds[0]})},"inchi"==d.input_type?this.queryChembl(e+d.input_str+".json"):"inchikey"==d.input_type?this.queryChembl(e+"stdinchikey/"+d.input_str+".json"):"smiles"==d.input_type?this.queryChembl(e+"smiles/"+d.input_str+".json"):"chemblid"==d.input_type&&this.queryChembl(e+d.input_str+".json")};return b}]),angular.module("chembiohubAssayApp").factory("chemFileValidation",function(){var a=42;return{someMethod:function(){return a}}}),angular.module("chembiohubAssayApp").directive("chemsvg",["$compile",function(a){return{templateUrl:"views/templates/chemsvg.html",restrict:"E",link:function(a,b,c){a.checkLocal(),a.getSmiles(),a.$watch("smiles",function(){a.getSmiles()})},controller:["$scope","$http",function(a){a.getSmiles=function(){a.src="";var b={size:a.size,ctab:a.smiles};b.smarts=a.properties.substructureMatch,$http.post(a.finalUrl,b).then(function(b){a.src=b.data})},a.checkLocal=function(){a.finalUrl=a.baseUrl,a.properties?a.cdxml=a.properties.cdxml:a.cdxml=""}}],scope:{size:"=",smiles:"=",dataType:"=",baseUrl:"=",properties:"="}}}]),angular.module("chembiohubAssayApp").directive("processStep",function(){return{template:"",restrict:"E",link:function(a,b,c){a.getImageURL()},controller:["$scope",function(a){a.getImageURL=function(){switch(a.status){case"no_change_req":a.imageURL="images/skip_next2.bf38bf7b.svg";break;case"error":a.imageURL="images/error2.10541995.svg";break;case"processing":a.imageURL="images/loader.957018df.gif";break;case"changed":a.imageURL="images/warning2.9d0ccb4b.svg"}}}],scope:{startSmiles:"=",endSmiles:"=",status:"=",name:"="}}}),angular.module("chembiohubAssayApp").filter("titlecase",function(){return function(a){var b=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return a.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(a,c,d){return c>0&&c+a.length!==d.length&&a.search(b)>-1&&":"!==d.charAt(c-2)&&("-"!==d.charAt(c+a.length)||"-"===d.charAt(c-1))&&d.charAt(c-1).search(/[^\s-]/)<0?a.toLowerCase():a.substr(1).search(/[A-Z]|\../)>-1?a:a.charAt(0).toUpperCase()+a.substr(1)})}}),angular.module("chembiohubAssayApp").directive("appProgress",[function(){return{templateUrl:"views/templates/app-progress.html",restrict:"E",scope:{wizard:"="},controller:function(){svgify()}}}]),angular.module("chembiohubAssayApp").factory("LoginService",["$resource","urlConfig",function(a,b){var c=b.users.list_endpoint,d=c;return a(d)}]),angular.module("chembiohubAssayApp").filter("notEmpty",function(){return function(a){return a?Object.keys(a).length>0:!1}}),angular.module("chembiohubAssayApp").filter("toTrusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("chembiohubAssayApp").filter("removeSpaces",function(){return function(a){return a.replace(/__space__/g," ")}}),angular.module("chembiohubAssayApp").factory("HTTPProject",["$stateParams",function(a,b){function c(a){var c=a||{};return c.data=c.data||{},c.data.projectKey=b.projectKey,c}var d={};return["delete","get","head","jsonp","post","put"].forEach(function(b){d[b]=function(d,e,f){var e=c(e);return a[b](d,e,f)}}),d}]),angular.module("chembiohubAssayApp").directive("projectList",function(){return{templateUrl:"views/templates/project-list.html",restrict:"E",controller:["$scope","$timeout",function(a,b){a.projects=a.cbh.projects.objects}],link:function(a,b,c){a.svgify=function(){jQuery("img.svg").each(function(){var a=jQuery(this),b=a.attr("id"),c=a.attr("class"),d=a.attr("src");jQuery.get(d,function(d){var e=jQuery(d).find("svg");"undefined"!=typeof b&&(e=e.attr("id",b)),"undefined"!=typeof c&&(e=e.attr("class",c+" replaced-svg")),e=e.removeAttr("xmlns:a"),a.replaceWith(e)},"xml")})},$timeout(function(){a.svgify()})}}}),angular.module("chembiohubAssayApp").factory("ProjectFactory",["$resource","urlConfig",function(a,b){return a(b.cbh_projects.list_endpoint+"/:projectId",{projectId:"@projectId"},{update:{method:"PATCH"}})}]),angular.module("chembiohubAssayApp").controller("ProjectCtrl",["$scope","$rootScope","$state","ProjectFactory","MessageFactory","$stateParams","urlConfig",function(a,b,c,d,e,f,g){a.urlConfig=g,b.headline="Projects",b.subheading="Click 'Show Project List' to see your projects",a.help_lookup="projects_help",b.glyphicon="folder-open",a.getMessage=function(a){return e.getMessage(a)},a.messages=e.getMessages()}]),angular.module("chembiohubAssayApp").factory("MessageFactory",function(){var a={};a.getMessage=function(a){return b[a]?b[a]:""},a.getMessages=function(){return b},a.getLegends=function(){return e},a.getStatuses=function(){return c},a.getUploadActions=function(){return d};var b={wizard_intro_text:"To upload multiple compounds you will need a list of SMILES; an InChI key or list of InChI keys; or either a SD, ChemDraw or Excel file.",projects_help:"If you believe you should have access to projects not shown or the functions available for each are not what you expect, contact your administrator",project_list_filter_help:"Narrow down the project list using this quick search box. Results will filter on project name and will match any part of the name, not just from the start.",
plate_list_filter_help:"Narrow down the plate list using this quick search box. Results will filter on plate name and description.",drawing_label_suppl:"Sketcher window provided by ChemDoodle.",drawing_label:"Draw your molecule here",file_upload_help_text:"Excel(xlsx), ChemDraw xml or SD files are accepted. For more detailed information, see the Help section.",assay_file_upload_help_text:"Excel(xlsx) are accepted. For more detailed information, see the Help section.",assay_file_use_template:"The system assumes that you are using data created from one of the available downloadable templates. Please ensure you have used this or your data may not map properly.",ids_not_processed:"No SMILES or InChI identifiers could be processed, please check the format, remove any spaces and try again.",file_error:"File cannot be processed even though the format appears valid. If you have questions please contact the ChemBio Hub team.",file_format_error:"File cannot be processed, the format is invalid. Files must be xlsx, cdxml, cdx or sdf format and labelled as such.",file_too_large:"File contains too many records to be able to process in one action - please consider splitting your input file into smaller parts.",oops:"Oops, should not have got here, if you have not pressed back on the browser, gone to an outdated bookmark or lost your data by refreshing please let the AssayReg team know. Click cancel to restart.",mapping_fields_help:"Drag column fields from your file to the appropriate custom mapping, or leave undragged to create a new custom field with that name.",edit_mode_unavailable_projects:"You cannot add single and edit at the same time. Edit and Add are only available when editing one project at a time where you have editor rights on that project.",edit_mode:"When in Edit mode, individual fields can be edited using the pencil icon and data can be filled down like in Excel. Edit and Add are only available when searching for one project at a time where you have editor rights on that project.",batch_reg_total_processed_0:"No substances were processed.",batch_reg_total_processed_1:"One substance was processed and:",batch_reg_total_processed_other:"substances were processed of which:",batch_reg_new_to_chemireg_other:"We check all of the projects you have access to to get this total.  If the number is zero it means all of your compounds already exist in AssayReg.",batch_prereg_to_public_single:"This substance is valid and was already registered as public.  A new private batch of this will be registered in this project.",batch_prereg_to_project_single:"This substance is valid and was already registered to this project.  A new private batch of this will be registered in this project.",batch_reg_new_to_chemireg_single:"This substance is not publically registered in ChemBio Hub AssayReg. The first batch of this substance will be registered to this project.",batch_overlaps:"Number of substances which have already been registered. New private batches will be registered in this project for each of these.",smiles_field:"Each line of data will be interpreted as a separate SMILES or InChI identifier. If you would like to be able to register compounds with a different type of identifier, please let the ChemBio Hub team know.",batch_duplicates:"Duplicate structures (with identical InChI keys).",batch_errors_single:"Number of errors in processing the molecule, possibly due to invalid valency",batch_errors_other:"Number of molecules could not be processed and will be ignored. They are located at positions ",field_errors_other:"Number of errors when attempting to map the fields in your uploaded data to the fields in AssayReg.",batch_reg_recent_registration_error:"You have already registered this batch today. Are you sure you wish to continue?",registration_success:"No batches were registered with the ids and properties shown below",registration_none_success:"No molecules were registered",registration_error:"An unknown error occurred when registering compounds, the ChemBio Hub team have been notified and will contact you when the issue has been investigated.",justSaved:"This data was recently saved, click start again or go back to the project page.",image_more_details:"Click the image for more details about that molecule",unmapped_values_written:"Any unmapped values will be written anyway.  User should contact administrator if they want the field to be available to the whole project.",mapped_values_written:"Mapped values will be written to the specified field against the project.  User should contact administrator if they want extra project fields.",total_values:"Total number of records submitted.",valid_structure_values:"Records with a valid structure as interpreted by AssayReg. If this result is zero for an Excel file you may need to identify the SMILES field below.",no_valid_structure_values:"Records with no valid structure as interpreted by AssayReg. This type of record can still be registered and searched for inventory management purposes.",error_total_values:"Data records that contain errors and cannot be processed. Check your input data and the info column below.",inchi_matching:"Compounds submitted have been compared to each other using their InChI key to detect duplicate structures and stereoisomers.",new_to_chemireg:"Compounds or items not previously registered to this project. These compounds or items may be present in other projects.",project_match_values:"Some of your compounds or items are already registered to this project. New batches of these compounds or items will be created in this project.",chemireg_match_values:"Some duplicate compounds have been detected in your data.",duplicate_count_values:"No duplicate compounds have been detected in your data.",project_data_field_download:"Download records from the table in Excel or SDF format. Note that the export function is only available when one project is selected and you are an editor of that project."},c={status_1:{name:"New",explanation:"The data has not been added to any project you have access to previously."},status_2:{name:"Duplicated record",explanation:"This data has been added previously with the exact same fields and values to this project."},status_3:{name:"Could not generate InChi",explanation:"For compound records, this indicates that the structure was recognised but contains bond types which are incompatible with the way we generate UOX IDs."},status_4:{name:"Data not processable",explanation:"For compound records in ChemDraw or SDF format, this indicates that the structure was incompatible with our conversion software and could not be recognised in the format inputted."},status_5:{name:"SMILES not processable",explanation:"For compound records in Excel format, the autodetected SMILES column for this record contained an invalid SMILES string and could not be processed."},status_6:{name:"Overlap",explanation:"For compound records, this indicates that an identical structure has been added to the system previously with different metadata or by another user where you have permission to see their uploaded data."}},d={action_1:{name:"New Batch",explanation:"This record will be added to the database when you click 'Save these records'"},action_2:{name:"Ignore",explanation:"This record will not be added to the database when you click 'Save these records'. Records which are automatically set to 'Ignore' contain incorrect or unprocessable structural data. You can choose to add these records as blinded compounds - the structural position will be ignored but a record will be created containing any additional data fields associated with the structure."}},e={legend_uox_id:{name:"UOx ID",explanation:"A unique identifier for this compound in this project. For each UOx ID there can be multiple batches."},legend_batch_id:{name:"Batch ID",explanation:"A sample of this compound - each time you re-register a compound you get a new batch. Batch IDs will soon be sequential per UOx ID. For each UOx ID there can be multiple batches"}};return a}),angular.module("chembiohubAssayApp").factory("CBHCompoundBatch",["$compile","$http","$q","$timeout","$cookies","urlConfig",function(a,b,c,d,e,f,g){var h={};h.getSingleMol=function(){return{acdAcidicPka:null,acdBasicPka:null,acdLogd:null,acdLogp:null,alogp:null,chemblId:"",created:"",ctab:"",customFields:{},editableBy:{},id:null,knownDrug:0,medChemFriendly:null,modified:"",molecularFormula:"",molecularWeight:null,numRo5Violations:null,passesRuleOfThree:null,preferredCompoundName:null,rotatableBonds:0,smiles:"",species:null,stdCtab:"",stdInChiKey:""}},h.delete_index=function(a){a.objects=[];var c=b.post(f.cbh_compound_batches.list_endpoint+"/delete_index/",a).then(function(a){return a.data});return c},h.reindexModifiedCompound=function(a){var c={id:a};return b.post(f.cbh_compound_batches.list_endpoint+"/reindex_compound/",c)},h.markAsArchived=function(a){return b.post(f.cbh_compound_batches.list_endpoint+"/archive/",{id:a})},h.getAddCompoundsResults=function(a,c,d,e,g){var h={limit:c,offset:d,current_batch:a,sorts:g};e.bool.must.length+e.bool.must_not.length+e.bool.should.length>0?h.query=JSON.stringify(e):console.log(e.bool);var i=b.get(f.cbh_compound_batches.list_endpoint+"/get_part_processed_multiple_batch/",{params:h});return i},h.validateList=function(a,c){c.projectKey=a;var d=b.post(f.cbh_compound_batches.list_endpoint+"/validate_list/",c).then(function(a){return a.data});return d},h.validate=function(a,c){return b.post(f.cbh_compound_batches.list_endpoint+"/validate/",{ctab:c,projectKey:a})},h.createMultiBatch=function(a){var d=c.defer(),e=function(a){d.resolve(a)};a.cancellers.push(e);var g;return console.log("gothere"),"file"==a.config.type&&(g=b.post(f.cbh_compound_batches.list_endpoint+"/validate_files/",a.config,{timeout:d.promise})),"smilesdata"==a.config.type&&(g=b.post(f.cbh_compound_batches.list_endpoint+"/validate_list/",a.config,{timeout:d.promise})),"sketch"==a.config.type&&(g=b.post(f.cbh_compound_batches.list_endpoint+"/validate_drawn/",a.config,{timeout:d.promise})),g},h.saveSingleCompound=function(a){return a.blinded_batch_id="EMPTY_ID",b.post(f.cbh_compound_batches_v2.list_endpoint+"/",a)},h.saveMultiBatchMolecules=function(a){return b.post(f.cbh_compound_batches.list_endpoint+"/multi_batch_save/",a)},h.validateBatch=function(a,c){return b.post(f.cbh_compound_batches.list_endpoint+"/bulk/validate",{projectKey:a,ctab:molfile})},h.uploadBatch=function(a,c){return b.post(f.cbh_compound_batches.list_endpoint+"/bulk/upload",{projectKey:a,ctab:molfile})},h.fetchHeaders=function(a,c){return b.post(f.cbh_batch_upload.list_endpoint+"/headers/",{projectKey:a,file_name:c})},h.queryv2=function(a){var c=b({url:f.cbh_compound_batches_v2.list_endpoint,method:"GET",params:a}).then(function(a){return a.data});return c},h.get=function(a){var c=b({url:f.cbh_compound_batches_v2.list_endpoint+"/"+a,method:"GET"}).then(function(a){return a.data});return c};var i=function(a){var c=b.patch(f.cbh_compound_batches_v2.list_endpoint+"/"+a.id+"/",a).then(function(a){return a.data});return c};return h.patch=i,h.patchList=function(a,b){var d=(c.defer(),[]);return angular.forEach(a.objects,function(a){var c=a.project.split("/"),e=c[c.length-1];angular.forEach(b,function(b){b.id==e&&(a.project_key=b.project_key)}),d.push(i(a))}),c.all(d)},h.getListByVersion=function(a,b){c.defer();angular.forEach(a,function(a){var c=obj.project.split("/"),d=c[c.length-1];angular.forEach(b,function(a){a.id==d&&(obj.project_key=a.project_key)})})},h.patchTempList=function(a){var c=b.post(f.cbh_compound_batches.list_endpoint+"/update_temp_batches/",a).then(function(a){return a});return c},h.search=function(a,c){c&&(a.properties__archived="true");var d=b({url:f.cbh_compound_batches.list_endpoint,method:"GET",params:a}).then(function(a){return a.data});return d},h.multiBatchForUser=function(a){var c=b({url:f.cbh_multiple_batches.list_endpoint,method:"GET",params:{created_by:a,limit:1e3}}).then(function(a){return a.data});return c},h.paginate=function(a){var c=b({url:a,method:"GET"}).then(function(a){return a.data});return c},h.saveBatchCustomFields=function(a){return b.post(f.cbh_compound_batches.list_endpoint+"/multi_batch_custom_fields/",a)},h.validateFiles=function(a,c,d){var e=b.post(f.cbh_compound_batches.list_endpoint+"/validate_files/",{projectKey:a,file_name:c,struccol:d}).then(function(a){return a.data});return e},h}]);var ngFooter=function(a,b){a.pagingOptions=b.pagingOptions,a.maxRows=function(){var b=Math.max(a.totalServerItems);return b},a.$on("$destroy",a.$watch("totalServerItems",function(b,c){a.currentMaxPages=a.maxPages()})),a.maxPages=function(){return 0===a.maxRows()?1:Math.ceil(a.maxRows()/a.pagingOptions.pageSize)},a.pageForward=function(){var b=a.pagingOptions.currentPage;a.totalServerItems>0?a.pagingOptions.currentPage=Math.min(b+1,a.maxPages()):a.pagingOptions.currentPage++},a.pageBackward=function(){var b=a.pagingOptions.currentPage;a.pagingOptions.currentPage=Math.max(b-1,1)},a.pageToFirst=function(){a.pagingOptions.currentPage=1},a.pageToLast=function(){var b=a.maxPages();a.pagingOptions.currentPage=b},a.cantPageForward=function(){var c=a.pagingOptions.currentPage,d=a.maxPages();return a.totalServerItems>0?c>=d:b.data.length<1},a.cantPageToLast=function(){return a.totalServerItems>0?a.cantPageForward():!0},a.cantPageBackward=function(){var b=a.pagingOptions.currentPage;return 1>=b}};angular.module("chembiohubAssayApp").controller("BatchesCtrl",["$scope","$modal","$timeout","$q","$state","$stateParams","$location","gridconfig","projectKey","MessageFactory","CBHCompoundBatch","paramsAndForm",function(a,b,c,d,e,f,g,h,i,j,k,l){var m={};a.chemadder=!1;var n=function(){a.chemadder=!0};c(n,1e3);var o=f.multiple_batch_id;a.state=e.current,a.params=f,a.legends=j.getLegends(),m="cbh.search"!==a.state.name?o?{multiple_batch_id:o,project__project_key:i}:a.validatedData?{multiple_batch_id:a.validatedData.currentBatch,project__project_key:i}:{project__project_key:i}:l.params,a.tagFunction=function(a){var b={value:a,label:a,description:"",group:""};return b},a.projects=a.cbh.projects.objects,angular.forEach(a.projects,function(b){b.project_key==i&&(a.proj=b)}),a.dummyproj="$scope.state.data.dummyproj",a.projectKey=i,a.gridconfig=h,e.params.offset&&e.params.limit?(a.gridconfig.configObject.pagingOptions.pageSize=e.params.limit||20,a.gridconfig.configObject.pagingOptions.currentPage=parseInt(e.params.offset)/parseInt(e.params.limit)):(a.gridconfig.configObject.pagingOptions.pageSize=20,a.gridconfig.configObject.pagingOptions.currentPage=1),a.gridconfig.configObject.compounds=[],a.gridconfig.configObject.filters=m;var p=a.projectKey?"project__project_key="+a.projectKey+"&":"",q=a.validatedData?"multiple_batch_id="+m.multiple_batch_id+"&":"";"cbh.search"===a.state.name?a.gridconfig.configObject.paramsUrl=l.paramsUrl:a.gridconfig.configObject.paramsUrl=p+q,a.gridconfig.footerController=new ngFooter(a,a.gridconfig.configObject),c(function(){a.gridconfig.initializeGridParams().then(function(b){a.gridconfig.configObject.totalServerItems=b.meta.totalCount,a.gridconfig.configObject.compounds=b.objects},10)}),a.$watch("gridconfig.configObject.pagingOptions",function(b,c){b===c||b.currentPage===c.currentPage&&b.pageSize===c.pageSize||a.gridconfig.initializeGridParams().then(function(c){a.gridconfig.configObject.totalServerItems=c.meta.totalCount,a.gridconfig.configObject.compounds=c.objects,g.search("limit",b.pageSize).search("offset",parseInt(b.currentPage*b.pageSize)).replace()})},!0),a.modalInstance={},a.mol={},a.openSingleMol=function(c,d){angular.forEach(a.gridconfig.configObject.compounds,function(b){b.chemblId==c&&b.id==d&&(a.mol=b)}),a.modalInstance=b.open({templateUrl:"views/single-compound.html",size:"lg",resolve:{mol:function(){return a.mol},projectsWithCustomFieldData:["ProjectFactory",function(b){var c;return angular.forEach(a.cbh.projects.objects,function(b){b.id==a.mol.project_id&&(c=b)}),c}]},controller:["$scope","$modalInstance","mol","projectsWithCustomFieldData","$timeout",function(a,b,c,d,e){a.mol=c,a.myform=d.objects[0].schemaform.form;var f=d.objects[0].schemaform.form,g=Math.ceil(f.length/2);a.firstForm=angular.copy(f).splice(0,g),a.secondForm=angular.copy(f).splice(g),a.myform2=angular.copy(f),a.init=function(){a.keyValues=a.myform2.map(function(b){var c=b;angular.isDefined(b.key)&&(c=b.key);var d="";return angular.isDefined(a.mol.customFields[c])&&(d=a.mol.customFields[c]),d.constructor===Array&&(d=d.join(", ")),{key:c,value:d}}),a.firstList=a.keyValues.splice(0,g),a.secondList=a.keyValues,console.debug(a.firstList)},a.init(),a.removeAlert=function(){a.update_success=!1},a.updateBatch=function(){k.patch({customFields:a.mol.customFields,projectKey:i,id:a.mol.id}).then(function(b){a.mol=b,c=b,a.update_success=!0,a.init(),e(a.removeAlert,5e3)})},a.myschema=d.objects[0].schemaform.schema,a.modalInstance=b}]})},a.openHeadersLegend=function(){a.modalInstance=b.open({templateUrl:"views/legend.html",size:"md",controller:["$scope","$modalInstance","MessageFactory",function(a,b,c){a.modalInstance=b,a.legends=c.getLegends()}]})},a.exportSearch=function(b){a.gridconfig.exportFullResults(b)}}]),angular.module("chembiohubAssayApp").service("CompoundListSetup",["CBHCompoundBatch","$rootScope","$stateParams","$q","urlConfig",function(a,b,c,d,e){this.configObject={},this.configObject.projectKey="",this.configObject.compounds=[],this.configObject.totalServerItems=0,this.configObject.pagingOptions={pageSizes:[10,20,50],pageSize:10,currentPage:1},this.configObject.filters={},this.configObject.baseUrl=e.cbh_compound_batches.list_endpoint,this.configObject.paramsUrl="",this.configObject.gridOptions={data:"gridconfig.configObject.compounds",showColumnMenu:!0,enableColumnReordering:!0,totalServerItems:"gridconfig.configObject.totalServerItems",enablePaging:!0,pagingOptions:this.configObject.pagingOptions,showFooter:!0,enableRowSelection:!1,enableColumnResize:!0,enableCellSelection:!0,rowHeight:200,columnDefs:[{field:"ctab",displayName:"Structure",width:"20%",cellTemplate:"views/img-template.html",cellClass:"white-bg"},{field:"chemblId",displayName:"UOx ID",width:"20%",cellTemplate:"<div class='ngCellText'><a ng-click='openSingleMol(row.getProperty(col.field), row.getProperty(\"id\"))'>{{row.getProperty(col.field)}}</a></div>"},{field:"id",displayName:"Batch ID",width:"10%"},{field:"created",displayName:"Added on",cellFilter:"date",width:"10%"},{field:"createdBy",displayName:"Added by",width:"10%"},{field:"molecularWeight",displayName:"Mol Weight"},{field:"knownDrug",displayName:"Known Drug",visible:!1},{field:"stdInChiKey",displayName:"Std InChi Key",visible:!1},{field:"medChemFriendly",displayName:"MedChem Friendly",visible:!1},{field:"passesRuleOfThree",displayName:"Ro3 Pass",visible:!1},{field:"preferredCompoundName",displayName:"Name",visible:!1},{field:"molecularFormula",displayName:"Formula",visible:!1},{field:"numRo5Violations",displayName:"Ro5 Violations",visible:!1},{field:"rotatableBonds",displayName:"Rotatable Bonds",width:"15%"},{field:"acdLogp",displayName:"acdLogp",visible:!1}]},this.initializeGridParams=function(){var a=d.defer(),b=this.getPagedDataAsync(this.configObject.pagingOptions.pageSize,this.configObject.pagingOptions.currentPage).then(function(a){return a});return a.resolve(b),a.promise},this.getPagedDataAsync=function(b,c){var e=d.defer(),f=parseInt(c-1)*parseInt(b),g={limit:b,offset:f};angular.extend(this.configObject.filters,g);a.query(this.configObject.filters).then(function(a){e.resolve(a)});return e.promise},this.exportFullResults=function(b){var c=angular.copy(this.configObject.filters);angular.extend(c,{format:b,responseType:"arraybuffer",limit:0,offset:0});a["export"](c).then(function(a){var b=URL.createObjectURL(a);window.open(b,"_self"),URL.revokeObjectURL(objectURL)})}}]),angular.module("chembiohubAssayApp").controller("SearchCtrl",["$scope","$http","$rootScope","$filter","$stateParams","$location","$state","$timeout","projectFactory","gridconfig","CBHCompoundBatch","urlConfig","searchUrlParams","$modal","loggedInUser","ProjectTypeFactory","SavedSearchFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){a.cbh.searchForm.related_molregno__chembl__chembl_id__in&&(a.searchFormSchema.schema.properties.related_molregno__chembl__chembl_id__in.items=a.cbh.searchForm.related_molregno__chembl__chembl_id__in.map(function(a){return{value:a,label:a}})),a.cbh.searchForm.search_custom_fields__kv_any&&(a.searchFormSchema.schema.properties.search_custom_fields__kv_any.items=a.cbh.searchForm.search_custom_fields__kv_any.map(function(a){return{value:a,label:a.replace("|",": ")}}))}a.cbh.appName="ChemiReg",a.searchFormSchema=angular.copy(a.cbh.projects.searchform),a.cbh.textsearch=e.textsearch,a.refresh=function(a,c,d){return b.get(c.async.url+"?chembl_id__chembl_id__startswith="+d)},a.refreshCustFields=function(c,d,e){console.log("refreshCustFields called");var f=a.cbh.withoutCustomFieldsUrl+"&custom__field__startswith="+e;return b.get(d.async.url+"?"+f)};var s=m.setup(e,{molecule:{}});a.cbh.pf=s,a.cbh.searchForm=angular.copy(s.searchForm),a.cbh.setupParams=function(b){a.cbh.baseDownloadUrl=b.paramsUrl,a.cbh.withoutCustomFieldsUrl=b.paramsUrlWithoutCF},a.cbh.setupParams(s),a.uoxFormItem=d("filter")(a.searchFormSchema.form,{key:"related_molregno__chembl__chembl_id__in"},!0),a.uoxFormItem[0].options.async.call=a.refresh,a.custFieldFormItem=d("filter")(a.searchFormSchema.simple_form,{key:"search_custom_fields__kv_any"},!0),a.custFieldFormItem[0].options.async.call=a.refreshCustFields,a.projectObj={},e.project__project_key__in&&e.justAdded&&(a.justAdded=e.justAdded,a.selected_projects=e.project__project_key__in.split(","),1==a.selected_projects.length&&angular.forEach(c.projects,function(b){b.project_key==a.selected_projects[0]&&(a.projectObj=b)})),r(),a.$on("sf-render-finished",function(){h(function(){a.cbh.watcher=a.$watch(function(a){return a.cbh.textsearch},function(b,c){b!=c&&a.cbh.runSearch()},!0),a.cbh.watcher2=a.$watch(function(a){var b={};Object.keys(a.cbh.searchForm).map(function(c,d){"molecule"!=c&&(b[c]=a.cbh.searchForm[c])});return b},function(b,c){JSON.stringify(b)!=JSON.stringify(c)&&(1!=b.project__project_key__in.length&&a.cbh.editMode&&a.cbh.toggleEditMode(),a.cbh.runSearch())},!0)}),a.cbh.searchForm.molecule.molfileChanged=function(){e[a.cbh.searchForm.substruc]=a.cbh.searchForm.molecule.molfile,g.params[a.cbh.searchForm.substruc]=a.cbh.searchForm.molecule.molfile,f.search(e).replace()}}),a.cancel=function(){g.params={},e={};var b=m.setup({},{molecule:{}});a.cbh.searchForm=angular.copy(b.searchForm),g.transitionTo("cbh.search",{location:!0,inherit:!1,relative:null,notify:!0,reload:!0}),g.go(g.current.name,g.params,{reload:!0})},a.cbh.runSearch=function(b){c.$broadcast("getMolecule"),h(function(){var c=m.fromForm(a.cbh.searchForm,a.cbh.textsearch);c.params.doScroll=b,c.params.sorts=e.sorts,c.params.showNonBlanks=e.showNonBlanks,c.params.showBlanks=e.showBlanks,a.cbh.changeSearchParams(c.params,!0)},10)},a.cbh.isCustomFieldFiltered=function(a){return angular.isDefined(e.search_custom_fields__kv_any)&&e.search_custom_fields__kv_any.indexOf(a)>-1?!0:!1},a.cbh.repaintUiselect=function(){r(),c.$broadcast("schemaFormRedraw")},a.hasSearchBeenPerformed=function(){return g.params=={}?!1:!0},a.openNewSavedSearchPopup=function(){a.newSavedSearchModel={},a.modalInstance=n.open({templateUrl:"views/templates/new-saved-search-modal.html",size:"md",resolve:{newSavedSearchModel:function(){return a.newSavedSearchModel},searchFormSchema:function(){return a.searchFormSchema},saveSearch:function(){return a.saveSearch},projectFactory:function(){return i}},controller:["$scope","$modalInstance","newSavedSearchModel","searchFormSchema","ProjectTypeFactory","projectFactory","SavedSearchFactory","saveSearch",function(a,b,c,d,e,f,g,h){a.newSavedSearchModel=c,a.searchFormSchema=d,a.saveSearch=h,a.modalInstance=b,a.errormess="",a.cancel=function(){b.dismiss("cancel")},a.doValidation=function(c){console.log("doValidation being called",c),c.$valid&&""!=a.newSavedSearchModel.alias&&!c.$pristine?(a.saveSearch(),b.dismiss("cancel")):c.$pristine&&(a.errormess="You must add a title")}}]})},a.openMySavedSearchPopup=function(){a.links=[];var c={creator_uri:o.resource_uri};b.get(l.cbh_saved_search.list_endpoint+"/get_list_elasticsearch/",{params:c}).then(function(b){a.links=b.data.objects,a.modalInstance=n.open({templateUrl:"views/templates/my-searches-modal.html",size:"md",resolve:{links:function(){return a.links}},controller:["$scope","$modalInstance","links","loggedInUser",function(a,b,c,d){a.links=c,a.loggedInUser=d,a.modalInstance=b,a.cancel=function(){b.dismiss("cancel")},a.personalOrGroup=function(a){return"personal"}}]})})},a.saveSearch=function(){console.log("still being found"),p.get({saved_search_project_type:!0},function(c){a.savedSearchType=c.objects[0];var d=new Date;a.savedSearchType.project_template.name=a.newSavedSearchModel.alias+d.getTime().toString(),a.savedSearchType.project_template.custom_field_config.name=a.newSavedSearchModel.alias+d.getTime().toString(),i.save(a.savedSearchType.project_template,function(c){var d=(c.resource_uri,{project:c.resource_uri,projectKey:c.project_key,blindedBatchId:"EMPTY_STRING",customFields:{alias:a.newSavedSearchModel.alias,url:window.location.href},uncuratedFields:{},warnings:{},properties:{},errors:{}});console.log(d);var e=q.list;e.save(d,function(a){console.log("inside save");var c={id:a.id};b.post(l.cbh_saved_search.list_endpoint+"/reindex_compound/",c)})})})},h(function(){console.log("schema redraw timeout"),c.$broadcast("schemaFormRedraw")},2e3)}]),angular.module("chembiohubAssayApp").directive("buttonInput",["$timeout",function(a){return{template:'<bootstrap-decorator>                    <div class="form-group " ng-class="" ng-init="">                        <label class="control-label " >{{label}}</label>                            <div class="form-group " >                              <div class="input-group">                                <input class="form-control" type="text" disabled ng-model="copyable"></input>                                <a href="" clip-copy="copyable" clip-click="" role="button" class="input-group-addon"><span class="glyphicon glyphicon-copy"> Copy</span></a>                            </div>                            </div>                            </div>                        </bootstrap-decorator>',restrict:"E",link:function(a,b,c){a.copyable=angular.copy(a.copyModel)},controller:["$scope",function(a){}],scope:{copyModel:"=",disabled:"=",label:"="}}}]),angular.module("chembiohubAssayApp").factory("UserFactory",["$resource","urlConfig",function(a,b){return a(b.users.list_endpoint,{username:"@username"},{})}]),angular.module("chembiohubAssayApp").factory("searchUrlParams",["$filter","$state",function(a,b){var c={};return c.setup=function(a,b){function c(c){b.molecule.molfile=a[c],a[c].indexOf("ChemDoodle")<0&&(b.smiles=a[c])}if(angular.isDefined(a.creator_uri)&&(b.creator_uri=decodeURIComponent(a.creator_uri).split(",")),angular.isDefined(a.archived)?b.archived=a.archived:b.archived="false",b.fpValue=a.fpValue,b.dateStart=a.created__gte,b.dateEnd=a.created__lte,angular.isDefined(a.project__project_key__in)?b.project__project_key__in=a.project__project_key__in.split(","):b.project__project_key__in=[],a.search_custom_fields__kv_any?b.search_custom_fields__kv_any=JSON.parse(a.search_custom_fields__kv_any):b.search_custom_fields__kv_any=[],a.related_molregno__chembl__chembl_id__in){a.related_molregno__chembl__chembl_id__in.split(",");b.related_molregno__chembl__chembl_id__in=a.related_molregno__chembl__chembl_id__in.split(",")}a.functional_group&&(b.functional_group=a.functional_group),a.multiple_batch_id?b.multiple_batch_id=a.multiple_batch_id:b.multiple_batch_id=void 0;return a.with_substructure?(b.substruc="with_substructure",c("with_substructure")):a.flexmatch?(b.substruc="flexmatch",c("flexmatch")):a.similar_to?(b.substruc="similar_to",c("flexmatch")):b.substruc="with_substructure",this.fromForm(b)},c.fromForm=function(b,c){function d(a){var b=["with_substructure","flexmatch","similar_to"];angular.forEach(b,function(b){b!=a&&(e[b]="")})}var e={};if(angular.isDefined(c)&&(e.textsearch=c),b.creator_uri?e.creator_uri=b.creator_uri.join(","):e.creator_uri=void 0,b.project__project_key__in&&(e.project__project_key__in=b.project__project_key__in.join(",")),b.multiple_batch_id?e.multiple_batch_id=b.multiple_batch_id:e.multiple_batch_id=void 0,b.related_molregno__chembl__chembl_id__in?e.related_molregno__chembl__chembl_id__in=b.related_molregno__chembl__chembl_id__in.join(","):delete e.related_molregno__chembl__chembl_id__in,b.functional_group?e.functional_group=b.functional_group:e.functional_group=void 0,b.smiles?e[b.substruc]=b.smiles:b.molecule&&""!=b.molecule.molfile?(e[b.substruc]=b.molecule.molfile,d(b.substruc)):(console.log("here"),e[b.substruc]=void 0),b.archived?e.archived=b.archived:e.archived="false",!angular.equals([],b.search_custom_fields__kv_any)&&angular.isDefined(b.search_custom_fields__kv_any)){var f="";f=JSON.stringify(b.search_custom_fields__kv_any),e.search_custom_fields__kv_any=f}else b.search_custom_fields__kv_any=[],e.search_custom_fields__kv_any="";if(b.dateStart)var g=a("date")(b.dateStart,"yyyy-MM-dd");if(b.dateEnd)var h=a("date")(b.dateEnd,"yyyy-MM-dd");e.created__gte=g,e.created__lte=h;var i=e.multiple_batch_id?"multiple_batch_id="+e.multiple_batch_id+"&":"",j=b.functional_group?"functional_group="+encodeURIComponent(b.functional_group)+"&":"",k=b.project__project_key__in?"project__project_key__in="+b.project__project_key__in.join(",")+"&":"",l=e.flexmatch?"flexmatch="+encodeURIComponent(e.flexmatch)+"&":"",m=e.with_substructure?"with_substructure="+encodeURIComponent(e.with_substructure)+"&":"",n=e.similar_to?"similar_to="+encodeURIComponent(e.similar_to)+"&":"",o=e.fpValue?"fpValue="+e.fpValue+"&":"",p=e.created__gte?"created__gte="+e.created__gte+"&":"",q=e.created__lte?"created__lte="+e.created__lte+"&":"",r=e.creator_uri?"creator_uri="+e.creator_uri+"&":"",s="archived="+e.archived,t=e.search_custom_fields__kv_any?"search_custom_fields__kv_any="+e.search_custom_fields__kv_any+"&":"",u=e.related_molregno__chembl__chembl_id__in?"related_molregno__chembl__chembl_id__in="+e.related_molregno__chembl__chembl_id__in+"&":"",v=angular.isDefined(c)?"textsearch="+c:"",w=r+i+k+j+l+u+m+n+o+p+q+v+s,x=w+t;return{searchForm:b,params:e,paramsUrl:x,paramsUrlWithoutCF:w}},c}]),angular.module("chembiohubAssayApp").factory("SearchUrlParamsV2",["$filter","$state","skinConfig","$rootScope","CBHCompoundBatch","urlConfig","chemicalSearch",function(a,b,c,d,e,f,g){function h(a){if(!a)return"";var b=[];return angular.forEach(a,function(a,c){null===a||angular.isUndefined(a)||(angular.isArray(a)?angular.forEach(a,function(a){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}):b.push(encodeURIComponent(c)+"="+encodeURIComponent(a)))}),b.join("&")}var i={params:{query:[]}};return i.generate_form=function(a,b){c.objects[0].refresh_tabular_schema();var e=c.objects[0].tabular_data_schema.copied_schema,f=[],h=[];if(a.encoded_query){var i=JSON.parse(atob(a.encoded_query));angular.forEach(i,function(a){e[a.field_path].filters=a,h.push(e[a.field_path]),f.push(a.field_path)}),c.objects[0].filters_applied=f,c.objects[0].filter_objects=h}else c.objects[0].filters_applied=[],c.objects[0].filter_objects=[];if(a.encoded_hides){var j=JSON.parse(atob(a.encoded_hides)),k=[];angular.forEach(j,function(a){e[a].hide="hide",k.push(e[a])}),c.objects[0].hides_applied=j,c.objects[0].hide_objects=k}else c.objects[0].hides_applied=[],c.objects[0].hide_objects=[];if(a.encoded_sorts){var l=JSON.parse(atob(a.encoded_sorts)),m=[],n=[];angular.forEach(l,function(a){e[a.field_path].sort_direction=a.sort_direction,m.push(e[a.field_path]),n.push(a.field_path)}),c.objects[0].sorts_applied=n,c.objects[0].sort_objects=m}else c.objects[0].sorts_applied=[],c.objects[0].sort_objects=[];
var o=[];a.pids&&(o=a.pids.split(",")),b.selected_projects=[],angular.forEach(b.projects.objects,function(a){o.indexOf(a.id.toString())>-1?(a.filtered=!0,b.selected_projects.push(a)):a.filtered=!1}),a.textsearch?b.textsearch=atob(a.textsearch):b.textsearch="",a.chemical_search_id?g.get({id:a.chemical_search_id},function(e){c.objects[0].chemicalSearch=e,c.objects[0].chemicalSearch.pids=a.pids,1==b.cameFromSavedSearch?d.$broadcast("chemicalSearch"):(d.$broadcast("chemicalFilterApplied"),d.$broadcast("searchParamsChanged"))},function(a){}):c.objects[0].chemicalSearch={pids:a.pids}},i.setBaseDownloadUrl=function(a,b){a.baseDownloadUrl=f.cbh_compound_batches_v2.list_endpoint+"?",a.baseDownloadUrl+=h(b)},i.generate_chemical_params=function(a){return a.chemical_search_id=c.objects[0].chemicalSearch.id,console.log("new id",a.chemical_search_id),c.objects[0].chemicalSearch.filter_is_applied=!0,a},i.generate_filter_params=function(a){var b=c.objects[0].tabular_data_schema.copied_schema,e=[],f=c.objects[0].filters_applied.map(function(a){var c={};return angular.forEach(b[a].filters,function(a,b){a&&(c[b]=a)}),c.field_path=b[a].data,e.push(b[a]),c});return a.encoded_query=btoa(JSON.stringify(f)),c.objects[0].filter_objects=e,d.$broadcast("searchParamsChanged"),a},i.generate_hide_params=function(a){var b=c.objects[0].tabular_data_schema.copied_schema,e=c.objects[0].hides_applied;console.log(e);var f=[];return angular.forEach(e,function(a){f.push(b[a])}),c.objects[0].hide_objects=f,a.encoded_hides=btoa(JSON.stringify(e)),d.$broadcast("searchParamsChanged"),a},i.generate_sort_params=function(a){var b=c.objects[0].tabular_data_schema.copied_schema,e=[],f=c.objects[0].sorts_applied,g=[];return angular.forEach(f,function(a){var c={field_path:a,sort_direction:b[a].sort_direction};e.push(c),g.push(b[a])}),c.objects[0].sort_objects=g,a.encoded_sorts=btoa(JSON.stringify(e)),d.$broadcast("searchParamsChanged"),a},i.get_textsearch_params=function(a,b){return a.textsearch=btoa(b),a},i.get_project_params=function(a,b){var d=b.map(function(a){return a.id});return a.pids=d.join(","),c.objects[0].chemicalSearch.pids=a.pids,a},i.generate_capped_saved_search=function(a,b){var c=[];a.encoded_query&&(c=JSON.parse(atob(a.encoded_query)));var d={limit:1,offset:0},f=["pids","archived","encoded_query"];angular.forEach(f,function(b){d[b]=a[b]});var g=e.queryv2(d).then(function(b){if(b.objects.length>0){var d=b.objects[0].id,e={query_type:"less_than",less_than:d,field_path:"id"};c.push(e)}return a.encoded_query=btoa(JSON.stringify(c)),a});return g},i}]),angular.module("chembiohubAssayApp").controller("CompoundbatchCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","CBHCompoundBatch","urlConfig","$window","$location","$anchorScroll","$filter","searchUrlParams",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(e,g){angular.forEach(b.projects,function(b,c){b.project_key==d.project__project_key__in&&b.editor&&(a.cbh.projAddingTo=a.cbh.projects.objects[c])}),a.cbh.includedProjectKeys=a.cbh.searchForm.project__project_key__in.length>0?a.cbh.searchForm.project__project_key__in:a.cbh.projects.objects.map(function(a){return a.project_key}),o=String(Date.now());var h=String(o);g.limit=a.pagination.compoundBatchesPerPage.value,g.offset=(e-1)*parseInt(a.pagination.compoundBatchesPerPage.value),g.sorts=d.sorts,g.archived=d.archived,g.showBlanks=d.showBlanks,g.textsearch=d.textsearch,g.showBlanks&&(g.showBlanks=g.showBlanks.replace("customFields","custom_fields")),g.showNonBlanks=d.showNonBlanks,g.showNonBlanks&&(g.showNonBlanks=g.showNonBlanks.replace("customFields","custom_fields")),f.query(g).then(function(b){o==h&&(a.totalCompoundBatches=b.meta.totalCount,a.compoundBatches.data=b.objects,a.compoundBatches.backup=angular.copy(b.objects),b.objects.length>0?(a.imageCallback(),a.noData=""):a.pagination.current*parseInt(a.pagination.compoundBatchesPerPage.value)>a.totalCompoundBatches+a.pagination.compoundBatchesPerPage.value?(a.pageChanged(1),a.imageCallback()):(a.imageCallback(),"cbh.search"===c.current.name||"cbh.searchv2"===c.current.name?a.noData="No Compounds Found. Why not try amending your search?":a.noData="No Compounds Found. To add compounds use the link above."),angular.isDefined(d.showBlanks)&&(a.compoundBatches.showBlanks=JSON.parse(d.showBlanks)),angular.isDefined(d.showNonBlanks)&&(a.compoundBatches.showNonBlanks=JSON.parse(d.showNonBlanks)))}),a.cbh.showSingle&&(a.toggleAddData(),a.cbh.showSingle=!1)}a.compoundBatches={data:[],redraw:0,sorts:[]},a.urlConfig=g,a.totalCompoundBatches=0,a.projects=a.cbh.projects.objects,a.$watch(function(a){return a.cbh.hideSearchForm},function(){j()});var n=l.setup(d,{molecule:{}});a.cbh.searchForm=angular.copy(n.searchForm),a.cbh.setupParams=function(b){a.cbh.baseDownloadUrl=b.paramsUrl,a.cbh.withoutCustomFieldsUrl=b.paramsUrlWithoutCF},a.cbh.setupParams(n),a.cbh.changeSearchParams=function(b,e){var f=l.fromForm(a.cbh.searchForm,a.cbh.textsearch);a.cbh.setupParams(f),e&&(a.pagination.current=1),c.params=b,d=b,c.go("cbh.search",b,{notify:!1,reload:!1,location:"replace",inherit:!0}),m(a.pagination.current,b)},a.changeView=function(){d.viewType=a.listOrGallery.choice,c.params.viewType=a.listOrGallery.choice,i.search(c.params)},a.cbh.setUpPageNumbers=function(){a.listOrGallery={choice:"list"},d.viewType&&(a.listOrGallery.choice=d.viewType),a.pagination={current:1};var b=[{label:"10/page",value:"10"},{label:"20/page",value:"20"},{label:"50/page",value:"50"},{label:"100/page",value:"100"}];if(a.itemsPerPage=angular.copy(b),a.pagination.compoundBatchesPerPage=a.itemsPerPage[2],angular.isDefined(d.sorts)&&(a.compoundBatches.sorts=JSON.parse(d.sorts)),angular.isDefined(d.showBlanks)&&(a.showBlanks=d.showBlanks),angular.isDefined(d.showNonBlanks)&&(a.showNonBlanks=d.showNonBlanks),angular.isDefined(d.compoundBatchesPerPage)){var c=k("filter")(a.itemsPerPage,d.compoundBatchesPerPage,!0);c[0]?a.pagination.compoundBatchesPerPage=c[0]:a.pagination.compoundBatchesPerPage=a.itemsPerPage[1]}angular.isDefined(d.page)&&(a.pagination.current=d.page)},a.cbh.patchRecord=function(b){a.compoundBatches.backup=angular.copy(a.compoundBatches.data),f.patch(b).then(function(b){f.reindexModifiedCompound(b.id).then(function(c){a.undoChanges=[b.id]})}),a.compoundBatches.redraw++},a.cbh.setUpPageNumbers(),a.blankForm=function(b,c){if(angular.isDefined(a.cbh.projAddingTo)){var d=angular.copy(a.cbh.projAddingTo.schemaform.form);angular.forEach(d,function(a){a.feedback=!1,a.disableSuccessState=!0}),a.myschema=angular.copy(a.cbh.projAddingTo.schemaform.schema),a.formChunks=d.chunk(Math.ceil(a.cbh.projAddingTo.schemaform.form.length/3)),a.newMol={customFields:{}},c&&(a.newMol.customFields=angular.copy(c.customFields),a.newMol.id=void 0,a.newMol.resource_uri=void 0),angular.forEach(a.formChunks,function(a){a.$pristine=!0}),b&&(a.addingData=!1)}},a.cbh.toggleEditMode=function(){a.cbh.editMode=!a.cbh.editMode,a.cbh.editMode&&(a.cbh.hideSearchForm=!0);var b=angular.copy(d);b.page=1,b.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,b.doScroll="true",b.editMode=a.cbh.editMode.toString(),a.cbh.changeSearchParams(b,!1)},a.editModeUnreachable=function(){var c=!0;return angular.forEach(b.projects,function(a,b){a.project_key==d.project__project_key__in&&a.editor&&(c=!1)}),c&&a.blankForm(!0),c},"true"==d.editMode||1==d.editMode?(a.cbh.editMode=!0,a.editModeUnreachable()&&a.cbh.toggleEditMode()):a.cbh.editMode=!1,a.addingData=!1,a.saveSingleCompound=function(b){f.saveSingleCompound(a.cbh.projAddingTo.project_key,"",a.newMol.customFields).then(function(c){f.reindexModifiedCompound(c.data.id).then(function(c){a.pageChanged(1),a.blankForm(b)})})},a.$on("cloneAnItem",function(b,c){a.cbh.editMode&&a.cbh.toggleEditMode(),a.addingData=!0,a.cbh.hideSearchForm=!0,a.blankForm(!1,c)}),a.toggleAddData=function(){a.addingData?a.addingData=!1:(a.addingData=!0,a.blankForm(),a.cbh.hideSearchForm=!0)},a.cbh.toggleArchiveFilter=function(){a.cbh.archiveFilter=!a.cbh.archiveFilter;var b=angular.copy(d);b.page=1,b.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,b.doScroll="true",b.archived=a.cbh.archiveFilter.toString(),a.cbh.changeSearchParams(b,!1)},a.changeNumberPerPage=function(b){var c=angular.copy(d);c.page=1,c.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,c.doScroll="true",a.cbh.changeSearchParams(c,!1)},a.pageChanged=function(b){var c=angular.copy(d);c.page=b,c.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,c.doScroll="true",a.cbh.changeSearchParams(c)},a.pageChanged2=function(b){var c=angular.copy(d);c.page=b,c.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,c.doScroll="false",a.cbh.changeSearchParams(c)},a.imageCallback=function(){a.compoundBatches.redraw++},a.cbh.blanksFilter=function(b,c){var e=angular.copy(d);if(e.page=1,e.showBlanks?e.showBlanks=JSON.parse(e.showBlanks):e.showBlanks=[],e.showNonBlanks?e.showNonBlanks=JSON.parse(e.showNonBlanks):e.showNonBlanks=[],"blanks"==c){var f=e.showBlanks.indexOf(b.data);-1==f?e.showBlanks.push(b.data):e.showBlanks.splice(f,1);var g=e.showNonBlanks.indexOf(b.data);g>-1&&e.showNonBlanks.splice(g,1)}else if("nonblanks"==c){var f=e.showNonBlanks.indexOf(b.data);-1==f?e.showNonBlanks.push(b.data):e.showNonBlanks.splice(f,1);var g=e.showBlanks.indexOf(b.data);g>-1&&e.showBlanks.splice(g,1)}e.showBlanks=JSON.stringify(e.showBlanks),e.showNonBlanks=JSON.stringify(e.showNonBlanks),a.cbh.changeSearchParams(e)};var o;a.nullSorts=function(){a.compoundBatches.sorts=[];var b=angular.copy(d);b.page=1,b.sorts=void 0,c.params=b,d=b,i.search(b),a.initialise()},a.cbh.addSort=function(b,c){for(var e=a.compoundBatches.sorts.length,f=!1;e--;)if(angular.isDefined(a.compoundBatches.sorts[e][b])){if(a.compoundBatches.sorts[e][b].order==c)var f=!0;a.compoundBatches.sorts.pop(e)}var g={};f||(g[b]={order:c,missing:"_last",unmapped_type:"string"},a.compoundBatches.sorts.unshift(g));var h=angular.copy(d);a.compoundBatches.sorts.length>0?h.sorts=JSON.stringify(a.compoundBatches.sorts):h.sorts=void 0,a.cbh.changeSearchParams(h,!0)},angular.isDefined(a.cbh.changesToUndo)||(a.cbh.changesToUndo=[]),a.undoChanges=function(){console.log("test"),a.currentlyLoading=!0,a.compoundBatches.data=angular.copy(a.compoundBatches.backup);var c=a.cbh.changesToUndo.map(function(b){return a.compoundBatches.data[b[0]]});f.patchList({objects:c},b.projects).then(function(b){angular.forEach(b,function(a){f.reindexModifiedCompound(a.id)}),a.compoundBatches.redraw++,a.currentlyLoading=!1,a.compoundBatches.backup=angular.copy(a.compoundBatches.data)})},a.$on("updateListView",function(){a.compoundBatches.backup=angular.copy(a.compoundBatches.data)}),a.cbh.saveChangesToCompoundDataInController=function(c,d){if(a.cbh.changesToUndo=[],angular.isDefined(c)&&c&&c.length>0){a.disableButtons=!0;var e=c.map(function(b){return a.compoundBatches.data[b[0]]});a.cbh.changesToUndo=c;var g={};g.objects=e,f.patchList(g,b.projects).then(function(a){angular.forEach(a,function(a){f.reindexModifiedCompound(a.id)})})}},a.initialise=function(){d.mb_id&&(a.current_dataset_id=d.mb_id,a.datasets[a.current_dataset_id]={multiplebatch:a.current_dataset_id}),d.warningsFilter?a.warningsFilter=d.warningsFilter:a.warningsFilter="",angular.isDefined(d.sorts)&&(a.compoundBatches.sorts=JSON.parse(d.sorts))},m(a.pagination.current,a.cbh.pf.params)}]),angular.module("chembiohubAssayApp").directive("handsoncompoundtable",["$timeout","$compile","renderers","$rootScope","$filter","$modal",function(a,b,c,d,e,f){return{template:"<div  ></div>",restrict:"E",transclude:!0,link:function(b,d,g){function h(a){var b=a.split("|");return b[1]}function i(a){var b=document.createElement("BUTTON"),c="";return a.noSort&&(c=" lightgrey"),b.innerHTML='<span class="glyphicon glyphicon-sort'+c+'"></span>',b.className="tableFilter",b}function j(a){var b=document.createElement("span");if(a.mappingOptions&&!a.copyto)b.className="pull-right alert-danger",b.style.marginRight="20px;",b.innerHTML='Unmapped <info-box lookup="unmapped_values_written" lookupitems="cbh.messages" right="true"></info-box>';else if(a.mappingOptions&&a.copyto){var c="<span></span>";1==a.automapped&&(c="<span>(auto)</span>"),b.className="pull-right alert-success",b.style.marginRight="20px;",b.innerHTML='<span class="glyphicon glyphicon-arrow-right"></span>'+a.copyto+c+'<info-box lookup="mapped_values_written" lookupitems="cbh.messages" right="true"></info-box></span>'}return b}function k(a,c){Handsontable.Dom.addEvent(a,"click",function(a){a.preventDefault(),a.stopImmediatePropagation(),b.col=angular.copy(c),b.modalInstance=f.open({templateUrl:"views/templates/compound-table-filter.html",size:"md",resolve:{col:function(){return b.col},cbh:function(){return b.cbh}},controller:["$scope","$modalInstance","col","cbh","$timeout",function(a,b,c,d,e){a.col=c,a.modalInstance=b,a.cbh=d,a.cancel=function(){b.dismiss("cancel")}}]})})}var l,m;b.cbh.toggleMappedFieldInDirective=function(a,c){if(""===a)angular.forEach(b.uncuratedHeaders,function(a){a.name==c&&(delete a.operations,a.copyto="",a.automapped=!1)});else{var d=m[a],e=d.title;angular.forEach(b.uncuratedHeaders,function(a){if(a.name==c)if(a.copyto==e)a.copyto="",delete a.operations,a.automapped=!1;else{a.copyto=e,a.automapped=!1;var b=[];if("array"==d.type)b.push({op:"split",path:"/uncurated_fields/"+c}),b.push({op:"move",path:"/custom_fields/"+e,from:"/uncurated_fields/"+c});else{var f={op:"move",path:"/custom_fields/"+e,from:"/uncurated_fields/"+c};b.push(f),"date"==d.format&&b.push({op:"convertdate",path:"/custom_fields/"+e})}a.operations=b}})}l(),b.cbh.setMappedFieldInController(e,c)},b.refreshSingleCustField=function(a,b,c){var d=a.searchformSchema.cf_form[0].options.async.url;$http.get(d+"?custom__field__startswith="+b+"&custom_field="+a.knownBy).then(function(b){a.typeahead=b.data})},l=function(){m=[];var f=!1;angular.isDefined(b.uncuratedHeaders)&&(f=!0,"xlsx"==b.cbh.fileextension&&(m=[{title:"SMILES for chemical structures",type:"chemical"}]));var g=[],l=[],n=b.cbh.projects.objects,o=!1;angular.forEach(n,function(a){(!angular.isDefined(b.cbh.includedProjectKeys)||b.cbh.includedProjectKeys.indexOf(a.project_key)>-1)&&(a.project_type.show_compounds&&(o=!0),angular.forEach(a.schemaform.form,function(b){l.indexOf(b.key)<0&&(l.push(b.key),m.push(angular.copy(a.schemaform.schema.properties[b.key])))}))});var p=[];if(f){var q=b.uncuratedHeaders.map(function(a,b,c){var d=a.copyto,e=angular.copy(m).map(function(b,e){var f=b.type;"date"==b.format&&(f="stringdate");var g="";if(a.fieldErrors[f]===!0&&(b.disabled=!0,b.fieldError=!0,b.uiClass="",g=b,b.displayError="Data in this field cannot be mapped to this datatype"),"object"==b.type&&(b.disabled=!0,b.uiClass="",g=b,b.displayError="Field does not support bulk upload - add data through the edit function."),!g){c.map(function(c){c.name!=a.name?b.title.toLowerCase()==c.copyto.toLowerCase()&&(b.disabled=!0,b.alreadyMapped=c.name,b.uiClass="",g=b):b.title.toLowerCase()==c.copyto.toLowerCase()&&(b.uiClass="glyphicon-check",g=b,d=b.title)})}return g?g:(b.uiClass="glyphicon-unchecked",b)});return{sortOrder:"none",copyto:d,mappingOptions:e,knownBy:a.name,data:"uncuratedFields."+a.name,readOnly:!0,className:"htCenter htMiddle ",renderer:"linkRenderer",automapped:a.automapped}});p=o?[{noSort:!0,knownBy:"Structure",data:"image",renderer:"coverRenderer",readOnly:!0,className:"htCenter htMiddle "},{sortOrder:"none",knownBy:"Row",data:"id",readOnly:!0,className:"htCenter htMiddle "},{noSort:!0,readOnly:!0,knownBy:"Info",data:"originalSmiles",renderer:"infoRenderer"},{sortOrder:"none",knownBy:"Action",data:"properties.action",type:"dropdown",source:["New Batch","Ignore"],className:"htCenter htMiddle "},{sortOrder:"none",knownBy:"Inchi Key",data:"standardInchiKey",readonly:!0,renderer:"linkRenderer"}].concat(q):[{sortOrder:"none",knownBy:"Row",data:"id",readOnly:!0,className:"htCenter htMiddle "},{sortOrder:"none",knownBy:"Action",data:"properties.action",type:"dropdown",source:["New Batch","Ignore"],className:"htCenter htMiddle "}].concat(q)}else b.cbh.editMode&&(p=[{noSort:!0,knownBy:"Archive/Restore",data:"properties.archived",renderer:"archivedRenderer",readOnly:!0,className:"htCenter htMiddle "},{noSort:!0,knownBy:"Clone/Add Structure",data:"",renderer:"cloneRenderer",readOnly:!0,className:"htCenter htMiddle "}]),o&&(p=p.concat([{noSort:!0,knownBy:"Structure",data:"image",renderer:"coverRenderer",readOnly:!0,className:"htCenter htMiddle "}])),p=p.concat([{noSort:!0,knownBy:"UOx ID",data:"chemblId",renderer:"modalLinkRenderer",readOnly:!0,className:" htCenter htMiddle "},{knownBy:"Project",data:"project",readOnly:!0,className:"htCenter htMiddle ",renderer:"projectRenderer"}]),p=p.concat(g),b.cbh.editMode||(p=p.concat([{noSort:!0,knownBy:"Added By",data:"createdBy",readOnly:!0,className:"htCenter htMiddle "},{noSort:!0,knownBy:"Date",data:"timestamp",readOnly:!0,className:"htCenter htMiddle "},{knownBy:"Batch ID",data:"id",readOnly:!0,className:"htCenter htMiddle "},{noSort:!0,knownBy:"Upload ID",data:"multipleBatchId",readOnly:!0,className:"htCenter htMiddle "}])),o&&(p=p.concat([]));if(angular.isDefined(b.excluded)){var r=[];angular.forEach(p,function(a){var c=!0;angular.forEach(b.excluded,function(b){b==a.data&&(c=!1)}),c&&r.push(a)}),p=r}var s=p.map(function(a){return c.getColumnLabel(a,b)}),t={data:b.compounds,colHeaders:s,columns:p,minCols:p.length,afterGetColHeader:function(a,b){var c=i(p[a]),d=j(p[a]);for(k(c,p[a]);b.firstChild.lastChild!=b.firstChild.firstChild;)b.firstChild.removeChild(b.firstChild.lastChild);b.firstChild.appendChild(c),b.firstChild.appendChild(d),b.style["white-space"]="normal"},maxRows:b.compounds.length,renderAllRows:!0,fillHandle:"vertical",height:500};f?t.afterChange=function(a,c){b.cbh.saveChangesToTemporaryDataInController(a,c)}:(t.afterChange=function(a,c){b.cbh.saveChangesToCompoundDataInController(a,c)},t.beforeAutofill=function(a,c,d){for(var e=a.col;e<=c.col;e++)if("uiselecttags"==p[e].field_type)for(var f=a.row;f<=c.end;f++);else if("Archive/Restore"==p[e].knownBy){var g=(b.cbh.projects.objects,a.row),h=(this.getSourceDataAtRow(g),this.getCell(g-1,e)),i=!1,j=h.children[0].children[0];if(console.log(j.className),"btn btn-success"==j.className)var i=!0;console.log("start",a.row);for(var f=a.row;f<=c.row;f++){var k=this.getCell(f,e),l=k.children[0],m=this.getSourceDataAtRow(f),n=m.project.split("/");n[n.length-1];console.log("getting here"),i&&"btn btn-danger"==l.children[0].className?(l.innerHTML="<button class='btn btn-success'><span class=' glyphicon glyphicon-ok'></span>&nbsp;Restore</button>",m.toArchive=!0,m.properties.archived=!0,l.click()):i||"btn btn-success"!=l.children[0].className||(l.innerHTML="<button class='btn btn-danger'><span class='glyphicon glyphicon-remove'></span>&nbsp;Archive</button>",m.toArchive=!1,m.properties.archived=!1,l.click())}}});var u=c.getRenderers(b,f);if(angular.isDefined(b.elem)){b.elem.scrollLeft(),$(window).scrollTop()}angular.forEach(t.columns,function(a){angular.isDefined(a.renderer)&&(a.renderer=u[a.renderer])});var v,w=document.createElement("DIV");for(w.className=w.className+" handsontable";d[0].firstChild;)d[0].removeChild(d[0].firstChild);d[0].appendChild(w);var v=new Handsontable(w,t),x=d[0].firstChild.id;b.hotId="#"+x;var y=$(b.hotId);y.wrap("<div id='myid' ></div>"),a(function(){b.width=0,angular.forEach(t.columns,function(a,c){a.myColWidth=v.getColWidth(c),b.width+=a.myColWidth,a.noSort||(a.sortOrder="none"),angular.forEach(b.sorts,function(b){angular.isDefined(b[a.data])&&(a.sortOrder=b[a.data].order)}),a.showBlank=!1,a.showNonBlank=!1,b.showNonBlanks&&angular.forEach(b.showNonBlanks,function(b){b==a.data&&(a.showNonBlank=!0)}),b.showBlanks&&angular.forEach(b.showBlanks,function(b){b==a.data&&(a.showBlank=!0)}),a.typeahead=[],a.searchForm=angular.copy(b.searchForm),a.searchformSchema=angular.copy(b.searchformSchema),angular.isDefined(a.searchformSchema)&&(a.searchformSchema.cf_form[0].options.custom_field=a.knownBy,a.searchForm.search_custom_fields__kv_any&&angular.forEach(a.searchForm.search_custom_fields__kv_any,function(b,c){a.searchForm.search_custom_fields__kv_any=e("filter")(a.searchForm.search_custom_fields__kv_any,function(b,c){return b.split("|")[0]==a.knownBy}),a.searchformSchema.schema.properties.search_custom_fields__kv_any.items=a.searchForm.search_custom_fields__kv_any.map(function(a){return{value:a,label:h(a)}})}))}),b.columns=t.columns,$(".btn-toggle").dropdown(),b.elem=$("#myid")}),b.hot1=v},b.$watch("redraw",function(a,b){l(),console.log("redraw being called via watch")},!0),b.$on("updateListView",function(){l()})},scope:{redraw:"=",compounds:"=",cbh:"=",sorts:"=",uncuratedHeaders:"=",columns:"=",excluded:"=",warningsFilter:"=",searchformSchema:"=",searchForm:"=",showBlanks:"=",showNonBlanks:"=",messages:"=",plugins:"="}}}]),angular.module("chembiohubAssayApp").directive("disableAnimation",["$animate",function(a){return{restrict:"A",link:function(b,c,d){d.$observe("disableAnimation",function(b){a.enabled(!b,c)})}}}]),angular.module("chembiohubAssayApp").controller("AddCompoundsCtrl",["$scope","$state","$stateParams","$cookies","$timeout","$location","$filter","projectKey","prefix","urlConfig","CBHCompoundBatch","MessageFactory","renderers","searchUrlParams","$modal","skinConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.skinConfig=p.objects[0],a.csrftoken=d[i.split("/")[0]+"csrftoken"],a.flowinit={target:j.instance_path.url_frag+"flow/upload/",headers:{"X-CSRFToken":a.csrftoken},generateUniqueIdentifier:function(a){return a.name+"-"+a.size+"-"+Date.now()}},a.projects=a.cbh.projects.objects,angular.forEach(a.projects,function(b){b.project_key==h&&(a.proj=b)}),a.toggleDataSummary={showFlag:!0},a.cbh.appName="ChemiReg",a.setLoadingMessageHeight=function(){var a=$(window).scrollTop();$("#loading-message").css("top",a+200+"px")},a.saveTemporaryCompoundData=function(){a.setLoadingMessageHeight(),a.currentlyLoading=!0,a.cbh.justAdded=!0,k.saveMultiBatchMolecules(a.datasets[a.current_dataset_id].config).then(function(c){b.transitionTo("cbh.searchv2",{encoded_query:g("encodeParamForSearch")({field_path:"multiple_batch_id",value:a.datasets[a.current_dataset_id].config.multiplebatch+""}),pids:[a.proj.id]},{location:!0,inherit:!1,relative:null,notify:!0})},function(b){a.currentlyLoading=!1})},a.cbh.statename=b.current.name,console.log(b.current.name),a.cbh.saveChangesToTemporaryDataInController=function(b,c){if(b&&b.length>0){a.disableButtons=!0;var d=b.map(function(b){return a.compoundBatches.data[b[0]]}),e=angular.copy(a.datasets[a.current_dataset_id].config);e.objects=d,k.patchTempList(e).then(function(b){a.compoundBatches.savestats=b.data.savestats})}},a.cbh.toggleWarningsFilter=function(d){var e=d;a.warningsFilter==d&&(e="");var f=angular.copy(c);f.page=1,f.warningsFilter=e,b.transitionTo(b.current.name,f,{location:!0,inherit:!1,relative:b.$current,notify:!1}),c=f,a.initialise()},a.cbh.openStatusExplanation=function(){a.modalInstance=o.open({templateUrl:"views/statuses.html",size:"md",controller:["$scope","$modalInstance","MessageFactory",function(a,b,c){a.modalInstance=b,a.legends=c.getStatuses(),a.actions=c.getUploadActions()}]})},a.cbh.setMappedFieldInController=function(b,c){a.datasets[a.current_dataset_id].config.headers=a.compoundBatches.uncuratedHeaders,a.datasets[a.current_dataset_id].config.struccol==c&&"SMILES for chemical structures"==b?(a.datasets[a.current_dataset_id].config.struccol="",a.createMultiBatch()):"SMILES for chemical structures"==b?(a.datasets[a.current_dataset_id].config.struccol=c,a.createMultiBatch()):k.saveBatchCustomFields(a.datasets[a.current_dataset_id].config)},a.cancelFile=function(d){var e={projectKey:c.projectKey};a.datasets[a.current_dataset_id].config.multiplebatch&&k.delete_index(a.datasets[a.current_dataset_id].config),a.setNull(),b.transitionTo(b.current.name,e,{location:!1,inherit:!1,relative:b.$current,notify:!0})},a.datasets={none:{config:{state:"add","new":0,blinded:0,total:0,overlaps:0,errors:0,field_errors:0,dupes:0}}},a.setNull=function(){a.current_dataset_id="none",a.setup()},a.changeView=function(){c.viewType=a.listOrGallery.choice,b.params.viewType=a.listOrGallery.choice,f.search(b.params)},a.setup=function(){a.inputData={inputstring:""},a.filedata={},a.filesUploading=!1,a.dataReady=!1,a.stateName=b.current.name,a.urlConfig=j,a.totalCompoundBatches=0,a.listOrGallery={choice:"list"},c.viewType&&(a.listOrGallery.choice=c.viewType),a.listPerPage=[{label:"10/page",value:"10"},{label:"20/page",value:"20"},{label:"50/page",value:"50"},{label:"100/page",value:"100"}],a.compoundBatches={data:[],sorts:[],excluded:[],redraw:0,columns:[]},a.itemsPerPage=angular.copy(a.listPerPage),a.pagination={current:1,compoundBatchesPerPage:a.itemsPerPage[2]}},a.nullSorts=function(){a.compoundBatches.sorts=[];var d=angular.copy(c);d.page=1,d.sorts=void 0,b.transitionTo(b.current.name,d,{location:!0,inherit:!1,relative:b.$current,notify:!1}),c=d,a.initialise()},a.cbh.renderFilterLink=m.renderFilterLink,a.cbh.fileextension="",a.cbh.addSort=function(d,e){for(var f=a.compoundBatches.sorts.length,g=!1;f--;)if(angular.isDefined(a.compoundBatches.sorts[f][d])){if(a.compoundBatches.sorts[f][d].order==e)var g=!0;a.compoundBatches.sorts.pop(f)}var h={};g||(h[d]={order:e,missing:"_last",unmapped_type:"string"},a.compoundBatches.sorts.unshift(h));var i=angular.copy(c);a.compoundBatches.sorts.length>0?i.sorts=JSON.stringify(a.compoundBatches.sorts):i.sorts=void 0,b.transitionTo(b.current.name,i,{location:!0,inherit:!1,relative:b.$current,notify:!1}),c=i,a.initialise()},a.setNull(),a.assignFile=function(b,c,d){a.current_dataset_id=b,a.cbh.fileextension=c;var f={file_name:b,multiplebatch:null,type:"file",fileextension:c,projectKey:h,struccol:"",state:"validate"};-1==["sdf","xlsx","cdx","cdxml"].indexOf(c)?(f.errors=[l.getMessage("file_format_error")],f.status="add"):a.filesInProcessing=!0,a.datasets[a.current_dataset_id]={config:f,cancellers:[]},e(a.createMultiBatch,200)},a.sketchMolfile={molecule:{}},a.molecule={molfile:""},a.createMultiBatch=function(){a.setLoadingMessageHeight(),a.currentlyLoading=!0,e(function(){a.setLoadingMessageHeight()}),k.createMultiBatch(a.datasets[a.current_dataset_id]).then(function(d){a.currentlyLoading=!1,a.filesInProcessing=!1,a.datasets[a.current_dataset_id].config=d.data,a.dataReady=!0,a.compoundBatches.uncuratedHeaders=d.data.headers,a.imageCallback(),a.compoundBatches.data=d.data.objects,a.compoundBatches.savestats=d.data.savestats,a.totalCompoundBatches=d.data.batchstats.total,b.go(b.current.name,{mb_id:a.datasets[a.current_dataset_id].config.multiplebatch,projectKey:c.projectKey},{location:!0,inherit:!1,relative:b.$current,notify:!0})},function(b){if("file"==a.datasets[a.current_dataset_id].config.type){var c=l.getMessage(b.data.error);angular.isDefined(c)&&""!==c?a.datasets[a.current_dataset_id].config.errors=[c]:a.datasets[a.current_dataset_id].config.errors=[l.getMessage("file_error")],a.skinConfig.file_errors_from_backend&&(a.datasets[a.current_dataset_id].config.errors[0]=b.data.error)}"smilesdata"==a.datasets[a.current_dataset_id].config.type&&(a.datasets[a.current_dataset_id].config.errors=[l.getMessage("ids_not_processed")]),a.datasets[a.current_dataset_id].config.status="add",a.dataReady=!1,a.currentlyLoading=!1})},a.processSmilesData=function(){a.current_dataset_id=a.inputData.inputstring;var b={multiplebatch:null,smilesdata:a.inputData.inputstring,type:"smilesdata",projectKey:h,struccol:"",state:"validate"};a.datasets[a.current_dataset_id]={config:b,cancellers:[]},a.createMultiBatch()},a.initialise=function(){if(c.viewType&&(a.listOrGallery.choice=c.viewType),c.mb_id&&(a.current_dataset_id=c.mb_id,a.datasets[a.current_dataset_id]={multiplebatch:a.current_dataset_id}),c.warningsFilter?a.warningsFilter=c.warningsFilter:a.warningsFilter="",angular.isDefined(c.compoundBatchesPerPage)){var b=g("filter")(a.itemsPerPage,c.compoundBatchesPerPage,!0);b[0]?a.pagination.compoundBatchesPerPage=b[0]:a.pagination.compoundBatchesPerPage=a.itemsPerPage[2]}else a.pagination.compoundBatchesPerPage=a.itemsPerPage[2];angular.isDefined(c.page)&&(a.pagination.current=c.page),angular.isDefined(c.sorts)&&(a.compoundBatches.sorts=JSON.parse(c.sorts)),angular.isDefined(c.mb_id)&&q(a.pagination.current)},a.cbh.includedProjectKeys=[a.proj.project_key],a.changeNumberPerPage=function(d){var e=angular.copy(c);e.page=1,e.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,e.viewType=d,e.doScroll="true",b.transitionTo(b.current.name,e,{location:!0,inherit:!1,relative:b.$current,notify:!1}),c=e,a.initialise()},a.pageChanged=function(d){var e=angular.copy(c);e.page=d,e.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,e.doScroll="true",b.transitionTo(b.current.name,e,{location:!0,inherit:!1,relative:b.$current,notify:!1}),c=e,a.initialise()};a.imageCallback=function(){e(function(){a.compoundBatches.redraw++})};var q=function(d){var e=a.pagination.compoundBatchesPerPage.value,f=(d-1)*a.pagination.compoundBatchesPerPage.value,g={bool:{must:[],should:[],must_not:[]}};if(""!=a.warningsFilter){var h="true",i=a.warningsFilter;if(a.warningsFilter.indexOf("properties")>-1&&(i=a.warningsFilter.split("|")[0],h=a.warningsFilter.split("|")[1]),"warnings.withstructure"==a.warningsFilter)g.bool.must_not.push({term:{"warnings.withoutstructure":"true"}}),g.bool.must_not.push({term:{"warnings.parseError":"true"}});else{var j={term:{}};j.term[i]=h,g.bool.must.push(j)}}else console.log(a.warningsFilter);a.compoundBatches.data=[],k.getAddCompoundsResults(c.mb_id,e,f,g,c.sorts).then(function(d){a.cbh.fileextension=d.data.fileextension,a.totalCompoundBatches=d.data.meta.totalCount,a.compoundBatches.data=d.data.objects,a.compoundBatches.uncuratedHeaders=d.data.headers,a.compoundBatches.savestats=d.data.savestats,a.current_dataset_id=c.mb_id,a.datasets[a.current_dataset_id]={config:d.data,cancellers:[]},a.searchFormSchema=angular.copy(a.cbh.projects.searchform);n.setup(c,{molecule:{}});if(a.searchForm=!1,a.dataReady=!0,d.data.objects.length>0){"gallery"==a.listOrGallery.choice?100:75;a.imageCallback()}else a.pagination.current*parseInt(a.pagination.compoundBatchesPerPage.value)>a.totalCompoundBatches?1!=a.pagination.current&&a.pageChanged(1):"cbh.search"===b.current.name||"cbh.searchv2"===b.current.name?a.noData="No Compounds Found. Why not try amending your search?":a.noData="No Compounds Found. To add compounds use the link above."})};a.initialise()}]),angular.module("chembiohubAssayApp").factory("renderers",["$timeout","$compile","$state","$rootScope","sfPath","sfSelect",function(a,b,c,d,e,f){function g(a,b){var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})}function h(a,b,c){var d="lightgrey";return a==b&&(d="blue"),'<a class="btn btn-sm btn-default" title="'+c+'" onclick="angular.element(this).scope().cbh.toggleWarningsFilter(&quot;'+b+'&quot;)" ><span class="glyphicon glyphicon-filter '+d+' " ></span></a>'}var i={getRenderers:function(a,b){var h,i=function(a,b,d,e,f,g,h){if(b=k(a,b,d,e,f,g,h),0==h.readOnly){b.className+=" gallery-item";var i=document.createElement("div");i.className+="row";var j=document.createElement("div");j.innerHTML="<button class='btn btn-xs btn-default pull-right' style='positon:top' title='Edit'><span class='glyphicon glyphicon-pencil'></span></button>",b.firstChild.className+=" col-xs-12",$(j).appendTo($(i)),$(b.firstChild).css("margin-bottom","18px").appendTo($(i)),$(i).css("margin","5px"),$(i).appendTo($(b));var l=a.getSourceDataAtRow(d);Handsontable.Dom.addEvent(j,"mousedown",function(a){a.preventDefault(),a.stopPropagation(),c.go(c.current.name+".record",{uniqId:l.id,edit:f})})}return b},j=function(a,b,c,d,e,f,g){return b.innerHTML="",b.title="This field is not configured for this project or is restricted.",b.className="htCenter htMiddle lightgreybackground",
b},k=function(a,b,c,d,e,f,h){var i=Handsontable.helper.stringify(f);if(i=g(i,""),"href"==h.field_type){var j=document.createElement("a");i.length>0&&(":"==i.substring(1,1)&&(i="file://"+i),j.innerHTML="view",j.href=i,j.target="_blank"),Handsontable.Dom.empty(b),b.className+="htCenter htMiddle ",b.appendChild(j)}else if("imghref"==h.field_type){var j=document.createElement("a");i.length>0&&(":"==i.substring(1,1)&&(i="file://"+i),j.innerHTML="view",j.href=i,j.target="_blank"),Handsontable.Dom.empty(b),b.className+="htCenter htMiddle ";var k=document.createElement("img");k.src=i,k.className="img-responsive",b.appendChild(k),b.appendChild(j),b.setAttribute("style","min-height:100px;min-width:100px;max-width:100px")}else if(0==i.indexOf("http")&&i.indexOf("//")>0){var j=document.createElement("a"),l=i.split("//")[1];j.innerHTML=l,l.length>30&&(j.innerHTML=l.substring(0,29)+"..."),j.href=i,j.target="_blank",Handsontable.Dom.empty(b),b.className+="htCenter htMiddle ",b.appendChild(j)}else b.className+=" htMiddle ","standardInchiKey"==e?(b.innerHTML=i.substring(0,10)+"...",h.readOnly=!0):b.innerHTML='<div class="">'+i+"</div>";return b},l={infoRenderer:function(a,b,c,d,e,f,g){var h=a.getSourceDataAtRow(c),i="<ul class='noindent'>",j=[["parseError","<li ><span class='alert-danger'>Data not processable</span></li>"],["smilesParseError","<li ><span class='alert-danger'>SMILES not processable: </span><br><small class='blue'>SMILESHERE</small></li>"],["inchiCreationError","<li ><span class='alert-danger'>Could not generate InChi: </span><br><small class='blue'>SMILESHERE</small></li>"],["duplicate","<li ><span class='alert-warning'>Duplicated record</span></li>"],["new","<li ><span class='alert-success'>New</span></li>"],["overlap","<li ><span class='alert-info'>Overlap</span></li>"]];return angular.forEach(j,function(a){angular.isDefined(h.warnings[a[0]])&&(i+=a[1])}),i+="</ul>",b.className+=" htMiddle ",b.innerHTML=i.replace("SMILESHERE",h.originalSmiles),b},centeredNumericRenderer:function(a,b,c,d,e,f,g){return Handsontable.renderers.TextRenderer.apply(this,arguments),g.type="numeric",g.format="0.00",b.className="htCenter htMiddle",b},safeHtmlRenderer:function(a,b,c,d,e,f,h){var i=Handsontable.helper.stringify(f);return i=g(i,"<em><b><strong><a><big>"),b.innerHTML=i,b},archivedRenderer:function(a,b,c,d,e,f,g){var i=(h.cbh.projects.objects,a.getSourceDataAtRow(c));g.readOnly=!1;var j=!1,k="<button class='btn btn-success btn-xs'><span class=' glyphicon glyphicon-ok'></span>&nbsp;Restore</button>";if(null==f||"false"==f||0==f){var k="<button class='btn btn-danger btn-xs'><span class='glyphicon glyphicon-remove'></span>&nbsp;Archive</button>";j=!0}var l=(h.cbh.projAddingTo,document.createElement("a"));return l.innerHTML=k,Handsontable.Dom.addEvent(l,"click",function(a){a.preventDefault(),i.properties.archived=j,f=j,i.projectKey=i.projectfull.project_key,h.cbh.patchRecord(i)}),Handsontable.Dom.empty(b),b.className+="htCenter htMiddle",b.appendChild(l),b.style.padding="5px",b},cloneRenderer:function(a,b,e,f,g,i,j){var k=a.getSourceDataAtRow(e);if(h.cbh.projAddingTo&&!h.cbh.editMode){var l="<button class='btn btn-primary btn-xs'><span class=' glyphicon glyphicon-duplicate'></span>&nbsp;"+k.projectfull.project_type.copy_action_name+"</button>",m=document.createElement("a");return m.innerHTML=l,Handsontable.Dom.addEvent(m,"click",function(a){a.preventDefault(),h.cbh.projAddingTo.project_type.show_compounds?c.go("cbh.projects.project.addsingle",{projectKey:h.cbh.projAddingTo.project_key,idToClone:k.id},{reload:!0}):h.$apply(function(){d.$broadcast("cloneAnItem",k)})}),Handsontable.Dom.empty(b),b.className+="htCenter htMiddle",b.appendChild(m),b.style.padding="5px",b}var l="<button disabled class='btn btn-primary btn-xs'><span class=' glyphicon glyphicon-duplicate'></span>&nbsp;"+k.projectfull.project_type.copy_action_name+"</button>",m=document.createElement("a");return m.innerHTML=l,Handsontable.Dom.empty(b),b.className+="htCenter htMiddle",m.title="Select single editable project to clone",h.cbh.editMode&&(m.title="Select single editable project and turn off edit mode to clone"),b.appendChild(m),b.className+="htCenter htMiddle",b.style.padding="5px",b},modalLinkRenderer:function(a,b,d,e,f,h,i){if(null==h)return b;var j=Handsontable.helper.stringify(h);j=g(j,"");var k=document.createElement("a");return k.innerHTML=j,Handsontable.Dom.addEvent(k,"mousedown",function(b){var e=a.getSourceDataAtRow(d);c.go(c.current.name+".record",{uniqId:e.id})}),Handsontable.Dom.empty(b),b.className+="htCenter htMiddle courier",b.appendChild(k),b},projectRenderer:function(a,b,c,d,e,f,g){var i=a.getSourceDataAtRow(c),j=i.project.split("/"),k=j[j.length-1],l=h.cbh.projects.objects;angular.forEach(l,function(a){return a.id==k?(Handsontable.Dom.empty(b),b.innerHTML=a.name,b.className+="htCenter htMiddle",b):void 0})},linkRenderer:k,customFieldRenderer:function(a,b,c,d,e,f,g){var k=a.getSourceDataAtRow(c);h.cbh.projects.objects;if(g.project_specific_schema[k.projectfull.id]){var l=g.project_specific_schema[k.projectfull.id].renderer;return l?l(a,b,c,d,e,f,g):i(a,b,c,d,e,f,g)}return j(a,b,c,d,e,f,g)},defaultCustomFieldRenderer:i,fileUploadRenderer:function(a,b,c,d,g,h,i){var j=a.getSourceDataAtRow(c),k=i.prop,l=e.normalize(k),m=f(l,j);if(angular.isDefined(m)){var n="<ul class='list-unstyled'>";n+=1==m.attachments.length?"<li class='text-success'>1 file</li>":0==m.attachments.length?"<li class='text-danger'>no files</li>":"<li class='text-success'>"+m.attachments.length+" files</li>",n+="</ul>",b.className+="htCenter htMiddle ",b.innerHTML=n}return b},bulletRenderer:function(a,b,c,d,e,f,g){var h="glyphicon glyphicon-unchecked";return"true"==f&&(h="glyphicon glyphicon-check"),b.className="htCenter htMiddle htDimmed",b.innerHTML="<h2 class='blue'><span class='"+h+"'></span></h2>",g.readOnly=!0,b},coverRenderer:function(a,b,d,e,f,g,h){if(null==g||""===g)return b.innerHTML="No Image",b.className+="htCenter htMiddle ",Handsontable.Dom.addEvent(b,"mousedown",function(b){var e=a.getSourceDataAtRow(d);c.go(c.current.name+".record",{uniqId:e.id})}),b;var i;Handsontable.helper.stringify(g);return i=document.createElement("IMG"),i.src="data:image/png;base64,"+g,i.style.cursor="pointer",i.style.width="85px",Handsontable.Dom.addEvent(i,"mousedown",function(b){var e=a.getSourceDataAtRow(d);c.go(c.current.name+".record",{uniqId:e.id})}),Handsontable.Dom.empty(b),b.className+="htCenter htMiddle ",b.appendChild(i),b}};return h=a,l},getColumnLabel:function(a,b){return"<label style='min-width:80px' >"+a.knownBy+"</label>"},renderFilterLink:function(a,b,c){return h(a,b,c)}};return i}]),angular.module("chembiohubAssayApp"),app.directive("dynamic",["$compile",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){b.$watch(d.dynamic,function(d){c.html(d),a(c.contents())(b)})}}}]),angular.module("chembiohubAssayApp").directive("compoundtableheader",function(){return{templateUrl:"views/templates/compound-table-header.html",restrict:"E",link:function(a,b,c){},scope:{compounds:"="}}}),angular.module("chembiohubAssayApp").factory("SkinningFactory",["$resource",function(a){return a(urlConfig.cbh_skinning.list_endpoint,{},{})}]),angular.module("chembiohubAssayApp").factory("AddDataFactory",["$resource","urlConfig",function(a,b){var c=a(b.instance_path.url_frag+"datastore/cbh_datapoint_classifications/:dc",{dc:"@dc"},{update:{method:"PATCH",params:{dc:"@dc"}}}),d=a(b.instance_path.url_frag+"datastore/cbh_datapoint_classifications_nested/:dc",{dc:"@dc"}),e=a(b.instance_path.url_frag+"datastore/cbh_datapoints/:dpid",{dpid:"@dpid"}),f=a(b.instance_path.url_frag+"datastore/cbh_projects_with_forms/");return{dataClassification:c,nestedDataClassification:d,level:e,pwf:f}}]),angular.module("chembiohubAssayApp").controller("AddDataCtrl",["$scope","$stateParams","$resource","AddDataFactory",function(a,b,c,d){a.cbh.appName="AssayReg";var e=this;e.getForm=function(b,e,f){console.log("dc is ",b),console.log("level is ",e);var g;angular.forEach(a.assayctrl.proj.enabled_forms,function(a){a.id==f&&(g=a[e])});var h=!1;a.dc_data={},a.clone={},a.level_datapoint={},a.context_datapoint={},a.test_model={project_data:{}};var i=d.dataClassification,j="",k=i.get({dc:b});k.$promise.then(function(b){a.dc_data=angular.copy(b),a.clone=angular.copy(b),a.clone.resource_uri=null,a.clone[e]="",a.clone.id=null,j=a.dc_data[e];var d="";if("l0"!=e){var f="l"+(parseInt(e[1])+1).toString();d=a.dc_data[f]}if(e)if(h){a.test_level_datapoint}else{var i=c(j,{});if("l0"!=e){var k=c(d,{}),l=k.get();l.$promise.then(function(b){a.context_datapoint=b})}var m=i.get();m.$promise.then(function(b){a.level_datapoint=b,a.level_datapoint.id=null,a.level_datapoint.resource_uri=null,a.custom_field_config=g,a.edit_form=[],a.edit_schema={type:"object",properties:{},required:[]},a.addition_name=a.custom_field_config.name,angular.forEach(a.custom_field_config.project_data_fields,function(b){a.edit_form.push(b.edit_form.form[0]),angular.extend(a.edit_schema.properties,b.edit_schema.properties)})})}})},e.submitForm=function(){a.level_datapoint.project_data=a.test_model.project_data,a.clone[b.lev]=a.level_datapoint,a.clone.$save()},e.clearForm=function(){a.test_model={project_data:{}}},e.getForm(b.dc,b.lev,b.data_form_id)}]),angular.module("chembiohubAssayApp").controller("EditDataCtrl",["$scope","$stateParams","$resource","AddDataFactory",function(a,b,c,d){var e=this;e.getForm=function(b,e){console.log("dc is ",b),console.log("level is ",e);var f=!1;a.dc_data={},a.clone={},a.level_datapoint={},a.test_model={project_data:{}};var g=d.dataClassification,h="",i=g.get({dc:b});i.$promise.then(function(b){if(a.dc_data=angular.copy(b),a.clone=angular.copy(b),console.log(a.clone),a.clone[e]="",h=a.dc_data[e],console.log("level_uri",h),e)if(f){a.test_level_datapoint}else{var d=c(h,{}),g=d.get();g.$promise.then(function(b){a.test_model={project_data:a.level_datapoint.project_data};var d=c(b.custom_field_config,{}),e=d.get();e.$promise.then(function(b){a.custom_field_config=b,a.edit_form=[],a.edit_schema={type:"object",properties:{},required:[]},a.addition_name=a.custom_field_config.name,angular.forEach(a.custom_field_config.project_data_fields,function(b){a.edit_form.push(b.edit_form.form[0]),angular.extend(a.edit_schema.properties,b.edit_schema.properties)})})})}})},e.submitForm=function(){a.level_datapoint.project_data=a.test_model.project_data,a.clone[b.lev]=a.level_datapoint,a.clone.$update({dc:b.dc})},e.clearForm=function(){a.test_model={project_data:{}}},e.getForm(b.dc,b.lev)}]),angular.module("chembiohubAssayApp").controller("ViewDataCtrl",["$scope","ViewDataFactory","$resource","$stateParams","$timeout",function(a,b,c,d,e){var f=this;f.dc=d.dc,c("")}]),angular.module("chembiohubAssayApp").factory("ViewDataFactory",["$resource",function(a){var b={},c={"/test/api/datastore/cbh_datapoints/2":{created:"2015-08-13T09:39:43.650658",created_by:{date_joined:"2015-02-23T10:34:11",first_name:"",id:1,is_staff:!0,is_superuser:!0,last_login:"2015-08-13T04:49:22.465231",last_name:"",resource_uri:"/test/api/users/1",username:"andy"},custom_field_config:"/test/api/datastore/cbh_custom_field_config/106",id:2,modified:"2015-08-13T09:39:43.651076",project_data:{Abstract:"Biiiiiiiiiiiiiiig abstract","Project Id":"ttest"},resource_uri:"/test/api/datastore/cbh_datapoints/2",supplementary_data:{}},"/test/api/datastore/cbh_datapoints/3":{created:"2015-08-13T09:41:43.543643",created_by:{date_joined:"2015-02-23T10:34:11",first_name:"",id:1,is_staff:!0,is_superuser:!0,last_login:"2015-08-13T04:49:22.465231",last_name:"",resource_uri:"/test/api/users/1",username:"andy"},custom_field_config:"/test/api/datastore/cbh_custom_field_config/107",id:3,modified:"2015-08-13T09:41:43.544126",project_data:{Aims:"to test our API","Assays included":"test","Sub-Project ID":"test"},resource_uri:"/test/api/datastore/cbh_datapoints/3",supplementary_data:{}},"/test/api/datastore/cbh_datapoints/4":{created:"2015-08-13T09:42:57.380200",created_by:{date_joined:"2015-02-23T10:34:11",first_name:"",id:1,is_staff:!0,is_superuser:!0,last_login:"2015-08-13T04:49:22.465231",last_name:"",resource_uri:"/test/api/users/1",username:"andy"},custom_field_config:"/test/api/datastore/cbh_custom_field_config/108",id:4,modified:"2015-08-13T09:42:57.381017",project_data:{"Assay ID":"test","Assay Type":"test","Written Protocol":"to test our API"},resource_uri:"/test/api/datastore/cbh_datapoints/4",supplementary_data:{}},"/test/api/datastore/cbh_datapoints/5":{created:"2015-08-13T09:45:10.343853",created_by:{date_joined:"2015-02-23T10:34:11",first_name:"",id:1,is_staff:!0,is_superuser:!0,last_login:"2015-08-13T04:49:22.465231",last_name:"",resource_uri:"/test/api/users/1",username:"andy"},custom_field_config:"/test/api/datastore/cbh_custom_field_config/109",id:5,modified:"2015-08-13T09:46:22.753781",project_data:{"Standard Activity Type":"IC50","Standard Activity Value":"34","Standard Unit":"nM"},resource_uri:"/test/api/datastore/cbh_datapoints/5",supplementary_data:{}},"/test/api/datastore/cbh_datapoints/6":{created:"2015-08-13T09:49:19.760949",created_by:{date_joined:"2015-02-23T10:34:11",first_name:"",id:1,is_staff:!0,is_superuser:!0,last_login:"2015-08-13T04:49:22.465231",last_name:"",resource_uri:"/test/api/users/1",username:"andy"},custom_field_config:"/test/api/datastore/cbh_custom_field_config/109",id:6,modified:"2015-08-13T09:49:19.761362",project_data:{"Standard Activity Type":"IC50","Standard Activity Value":"567","Standard Unit":"nM"},resource_uri:"/test/api/datastore/cbh_datapoints/6",supplementary_data:{}},"/test/api/datastore/cbh_datapoints/7":{created:"2015-08-13T09:49:41.438691",created_by:{date_joined:"2015-02-23T10:34:11",first_name:"",id:1,is_staff:!0,is_superuser:!0,last_login:"2015-08-13T04:49:22.465231",last_name:"",resource_uri:"/test/api/users/1",username:"andy"},custom_field_config:"/test/api/datastore/cbh_custom_field_config/109",id:7,modified:"2015-08-13T09:49:41.439112",project_data:{"Standard Activity Type":"IC50","Standard Activity Value":"56","Standard Unit":"nM"},resource_uri:"/test/api/datastore/cbh_datapoints/7",supplementary_data:{}},"/test/api/datastore/cbh_datapoints/8":{created:"2015-08-13T09:50:06.390150",created_by:{date_joined:"2015-02-23T10:34:11",first_name:"",id:1,is_staff:!0,is_superuser:!0,last_login:"2015-08-13T04:49:22.465231",last_name:"",resource_uri:"/test/api/users/1",username:"andy"},custom_field_config:"/test/api/datastore/cbh_custom_field_config/109",id:8,modified:"2015-08-13T09:50:06.390549",project_data:{"Standard Activity Type":"IC50","Standard Activity Value":"7","Standard Unit":"nM"},resource_uri:"/test/api/datastore/cbh_datapoints/8",supplementary_data:{}}},d=a("(prefix)/api/datastore/cbh_datapoint_classifications",{});return{dataClassifications:d,test_ws_data:b,test_datapoints:c}}]);var showMappingPopupController=["$scope","$modalInstance","project_fields","sheet","$timeout","$filter","dataoverviewctrl",function(a,b,c,d,e,f,g){a.dataoverviewctrl=g,a.project_fields=angular.copy(c),a.modded_project_fields=[],a.modalInstance=b,a.sheet=d,angular.forEach(a.project_fields,function(b){var c=!1;d.listOfUnmappedFields.indexOf(b.value)>-1&&(a.modded_project_fields.push(b),c=!0),(b.value==g.col_being_mapped.attachment_field_mapped_to||!c&&null==b.value)&&a.modded_project_fields.push(b)}),angular.forEach(a.modded_project_fields,function(b){b.value==g.col_being_mapped.attachment_field_mapped_to&&(a.mapping=b,a.oldRequired=angular.copy(a.mapping.required))}),a.setWarningMessage=function(){angular.forEach(a.modded_project_fields,function(b){a.dataoverviewctrl.col_being_mapped.attachment_field_unmappable_to==b.value&&(a.dataoverviewctrl.col_being_mapped.warningMessage="Attemped to map this field to "+angular.copy(b.name)+" but there are rows with unmappable data. Please correct and re-upload.",a.dataoverviewctrl.col_being_mapped.messageClass="text-danger")})},a.setWarningMessage(),a.cancel=function(){b.dismiss("cancel")},a.someMappingFunction=function(){if(!a.justChanged){if(a.mapping.value){d.listOfUnmappedFields.indexOf(a.mapping.value);d.listOfUnmappedFields.splice(d.listOfUnmappedFields.indexOf(a.mapping.value),1),a.mapping.required&&d.listOfUnmappedMandatoryFields.splice(d.listOfUnmappedMandatoryFields.indexOf(a.mapping.value),1)}g.col_being_mapped.attachment_field_mapped_to!=a.mapping.value&&null!=g.col_being_mapped.attachment_field_mapped_to&&(d.listOfUnmappedFields.push(g.col_being_mapped.attachment_field_mapped_to),a.oldRequired&&d.listOfUnmappedMandatoryFields.push(g.col_being_mapped.attachment_field_mapped_to));var b=(a.mapping.name,angular.copy(a.dataoverviewctrl.col_being_mapped));b.attachment_field_mapped_to=a.mapping.value,b.attachment_field_unmappable_to=null,b.unmappable_rows=[],a.dataoverviewctrl.col_being_mapped.unmappable_rows=[],a.dataoverviewctrl.col_being_mapped.attachment_field_unmappable_to=null,a.oldRequired=angular.copy(a.mapping.required);var c=$http.patch(b.resource_uri,b).then(function(c){if(c.data.attachment_field_unmappable_to){a.setWarningMessage(),null!=b.attachment_field_mapped_to&&(d.listOfUnmappedFields.push(angular.copy(b.attachment_field_mapped_to)),a.mapping.required&&d.listOfUnmappedMandatoryFields.push(angular.copy(b.attachment_field_mapped_to))),a.mapping=a.modded_project_fields[0],d.setNewMapping(c.data);var e=document.getElementById("field-selector");return angular.element(e).blur(),c.data}return a.dataoverviewctrl.col_being_mapped.messageClass="text-success",a.dataoverviewctrl.col_being_mapped.warningMessage="Mapping saved",d.setNewMapping(c.data),c.data},function(a){});return c}},a.clearMapping=function(b){a.mapping=a.modded_project_fields[0],a.someMappingFunction()}}],getSheetsByFile=function(a,b,c,d,e,f,g){c.iamloading=!0,c.loadingMessage="Loading File...";var h=d.cbhFlowfile;a.uploadData.fileId=b;var i=h.get({fileId:b});i.$promise.then(function(b){return-1==i.original_filename.indexOf(".xlsx")?(g.errorPopup("Incorrect file format. Please note only XLSX files are permitted."),void(c.iamloading=!1)):0==b.sheet_names.length?(g.errorPopup("No sheets found in file."),void(c.iamloading=!1)):(angular.forEach(b.sheet_names,function(b){var i={name:b,active:!1};i.listOfUnmappedFields=[],i.listOfUnmappedMandatoryFields=[],i.specifySheet=function(){if(!e&&!angular.isDefined(i.metadata)){c.iamloading=!0,c.loadingMessage="Loading Sheet...";d.cbhAttachments,h.save({flowfile:"/"+f+"/datastore/cbh_flowfiles/"+a.uploadData.fileId,data_point_classification:"/"+f+"/datastore/cbh_datapoint_classifications/"+a.id,chosen_data_form_config:a.next_level_dfc.resource_uri,sheet_name:i.name},function(a){i.active=!0,i.metadata=a,i.listOfUnmappedFields=i.getListOfUnmappedFields(a.attachment_custom_field_config.project_data_fields,a.titleMap),i.listOfUnmappedMandatoryFields=i.getListOfUnmappedMandatoryFields(a.attachment_custom_field_config.project_data_fields,a.titleMap),i.setTotalUnmapped(),c.iamloading=!1})}},i.setTotalUnmapped=function(){i.totalUnmapped=0,i.totalMappingErrors=0,angular.forEach(i.metadata.attachment_custom_field_config.project_data_fields,function(a){a.attachment_field_mapped_to&&i.totalUnmapped++,a.attachment_field_unmappable_to&&i.totalMappingErrors++})},i.setNewMapping=function(a){var b=0;angular.forEach(i.metadata.attachment_custom_field_config.project_data_fields,function(c,d){c.id==a.id&&(b=d)}),i.metadata.attachment_custom_field_config.project_data_fields[b]=a,g.col_being_mapped=a,i.setTotalUnmapped()},i.saveSheet=function(b){c.iamloading=!0,c.loadingMessage="Saving Sheet "+i.name+"...",angular.forEach(a.sheets,function(a){a.specifySheet=null}),$http.get("/"+f+"/datastore/cbh_attachments/save_temporary_data?sheetId="+b).then(function(a){c.iamloading=!1,$state.go($state.current,$stateParams,{reload:!0})})},i.getListOfUnmappedFields=function(a,b){var c=[];return angular.forEach(b,function(b){var d=!1;angular.forEach(a,function(a){a.attachment_field_mapped_to&&(a.attachment_field_mapped_to!=b.value&&b.value||(d=!0))}),d||b.value&&c.push(b.value)}),c},i.getListOfUnmappedMandatoryFields=function(a,b){var c=[];return angular.forEach(b,function(b){var d=!1;angular.forEach(a,function(a){null!=a.attachment_field_mapped_to&&(a.attachment_field_mapped_to!=b.value&&b.value||(d=!0))}),!d&&b.required&&b.value&&c.push(b.value)}),c},a.uploadData.sheets.push(i)}),void(a.uploadData.uploaded=!0))},function(a){g.errorPopup(a.data.error+". Please note only XLSX files are permitted."),c.iamloading=!1})};angular.module("chembiohubAssayApp").controller("DataOverviewCtrl",["$scope","AddDataFactory","$modal","$resource","$stateParams","$state","$timeout","$interval","prefix","urlConfig","$cookies","FlowFileFactory","DraftFactory","projectKey","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=this;p.success=function(a,b){var c=l.cbhBaseAttachment,d="";c.save({flowfile:"/"+i+"/datastore/cbh_flowfiles/"+a.uniqueIdentifier,data_point_classification:"/"+i+"/datastore/cbh_datapoint_classifications/"+p.currentlyAddingTo.id},function(c){d=c.resource_uri;var e={url:d,printName:a.name,mimeType:a.file.type};angular.isUndefined(p.currentlyAddingTo.new_next_level_model.project_data[b[0]])&&(p.currentlyAddingTo.new_next_level_model.project_data[b[0]]={attachments:[]}),p.currentlyAddingTo.new_next_level_model.project_data[b[0]].attachments.push(e)})},p.removeFile=function(a,b,c){angular.isUndefined(p.currentlyAddingTo.new_next_level_model.project_data[a[0]])&&(p.currentlyAddingTo.new_next_level_model.project_data[a[0]]={attachments:[]}),p.currentlyAddingTo.new_next_level_model.project_data[a[0]].attachments=o("filter")(p.currentlyAddingTo.new_next_level_model.project_data[a[0]].attachments,function(a,b){return a.url!==c})};var q=!1;a.$on("$destroy",function(){q=!0}),a.cbh.appName="AssayReg";var r={l1:"l1",l2:"l2"};a.iamloading=!1,a.loadingMessage="Loading...",a.modalInstance={},a.popup_data={},a.dpcForUpload={},p.currentlyAddingTo=null,a.getAnnotations=function(c){c.dfc_full=a.assayctrl.dfc_lookup[c.data_form_config],c.main_cfc=c.dfc_full[c.level_from],c.main_data=c[c.level_from],c.htmlClassName=r[c.level_from],c.setChosenDataFormConfig=function(b,d,e){return null!=p.currentlyAddingTo&&d?void p.errorPopup("You are already adding to a different dataset or by a different method. Please cancel that form before continuing."):(d&&(p.currentlyAddingTo=c),c.addingChild=d,c.next_level_dfc=a.assayctrl.dfc_lookup[b],c.next_level_cfc=c.next_level_dfc[c.next_level_dfc.last_level],angular.isDefined(e)?(e.id=null,e.resource_uri=null):e={project_data:{},custom_field_config:c.next_level_cfc.resource_uri},c.default_data=e,c.next_level_edit_form=c.next_level_dfc.get_main_form(),c.next_level_edit_schema=c.next_level_dfc.get_main_schema(),c.new_next_level_model=angular.copy(c.default_data),c.next_data_type_name=c.next_level_dfc[c.next_level_dfc.last_level].data_type.name,void(c.next_level_searchnames=c.next_level_cfc.project_data_fields.map(function(a){return c.next_level_dfc.last_level+".project_data."+a.elasticsearch_fieldname})))},c.setChosenDataFormConfigMultiple=function(b,d,e){return null!=p.currentlyAddingTo&&d?void p.errorPopup("You are already adding to a different dataset or by a different method. Please cancel that form before continuing."):(d&&(p.currentlyAddingTo=c),c.addingMultiple=d,c.next_level_dfc=a.assayctrl.dfc_lookup[b],c.next_level_cfc=c.next_level_dfc[c.next_level_dfc.last_level],angular.isDefined(e)?(e.id=null,e.resource_uri=null):e={project_data:{},custom_field_config:c.next_level_cfc.resource_uri},c.default_data=e,c.next_level_edit_form=c.next_level_dfc.get_main_form(),c.next_level_edit_schema=c.next_level_dfc.get_main_schema(),c.new_next_level_model=angular.copy(c.default_data),c.next_data_type_name=c.next_level_dfc[c.next_level_dfc.last_level].data_type.name,c.inputData={inputstring:""},c.filedata={},c.filesUploading=!1,c.dataReady=!1,c.initUpload=function(){c.uploadData={uploaded:!1,fileId:"",resource_uri:"",sheets:[]}},c.initUpload(),c.cancelFile=function(){c.setChosenDataFormConfigMultiple(b,!1,e),p.currentlyAddingTo=null},c.getSheetsForFile=function(b){getSheetsByFile(c,b,a,l,q,i,p)},void(c.next_level_searchnames=c.next_level_cfc.project_data_fields.map(function(a){return c.next_level_dfc.last_level+".project_data."+a.elasticsearch_fieldname})))},c.cancel=function(){c.dfc_full.permitted_children.length>0&&c.setChosenDataFormConfig(c.dfc_full.permitted_children[0]),c.addingChild=!1,p.currentlyAddingTo=null},c.dfc_full.permitted_children.length>0&&(c.setChosenDataFormConfig(c.dfc_full.permitted_children[0],!1),c.addingChild=!1),c.addDataToForm=function(a){c.addingChild=!0,c.setForm(a)},c.addChild=function(){p.setLoadingMessageHeight(),p.currentlyLoading=!0;var a=b.dataClassification,d=a.get({dc:c.id});d.$promise.then(function(a){a.children=[],a.id=null,a.resource_uri=null,a.parent_id=c.id,a[c.next_level]=c.new_next_level_model,a.data_form_config=c.next_level_dfc.resource_uri,a.$save(function(a){f.go(f.current,e,{reload:!0})})})},c.updateChild=function(a){p.setLoadingMessageHeight(),p.currentlyLoading=!0;var d=b.dataClassification,g=d.get({dc:a});g.$promise.then(function(b){b[c.next_level]=c.new_next_level_model,b.$update({dc:a},function(a){f.go(f.current,e,{reload:!0})})})},c.saveDraft=function(a){console.log("Saving draft");var b=m.save_draft,c=b.get({content:a});c.$promise.then(function(a){console.log("dpc draft saved",a)})},c.next_level_dfc.human_added?c.childrenTemplate="views/templates/overview-children-table.html":c.childrenTemplate="views/templates/overview-children.html",a.dpcForUpload=c},a.iterate_children=function(b){angular.forEach(b.children,function(c,d){angular.isDefined(c.id)&&(c.parentObj=b,a.getAnnotations(c),a.iterate_children(c))})},a.no_l0=!1,p.no_l0_dfc=!1,p.fetchData=function(){b.nestedDataClassification.get({project_key:a.assayctrl.proj.project_key},function(b){b.objects.length>=1?(a.no_l0=!1,p.no_l0_dfc=!1,p.l0_object=b.objects[0],a.getAnnotations(p.l0_object),a.iterate_children(p.l0_object)):(a.no_l0=!0,a.assayctrl.l0_dfc?p.l0_object=angular.copy(a.assayctrl.l0_dfc.template_data_point_classification):p.no_l0_dfc=!0)})},p.openDetail=function(b){a.popup_data=angular.copy(b),a.modalInstance=c.open({templateUrl:"views/modal-template.html",size:"lg",resolve:{popup_data:function(){return a.popup_data}},controller:["$scope","$modalInstance","popup_data","$timeout",function(a,b,c,d){a.popup_data=c,a.modalInstance=b,a.expanded="",a.cancel=function(){b.dismiss("cancel")},a.toggleExpand=function(b){a.expanded==b?a.expanded="":a.expanded=b},a.fetchImage=function(a){return a}}]})},p.errorPopup=function(b){a.popup_data=angular.copy(b),a.modalInstance=c.open({templateUrl:"views/templates/modal-error-template.html",size:"sm",resolve:{popup_data:function(){return a.popup_data}},controller:["$scope","$modalInstance","popup_data","$timeout",function(a,b,c,d){a.popup_data=c,a.modalInstance=b,a.cancel=function(){b.dismiss("cancel")}}]})},p.showMappingPopup=function(b,d,e){a.project_fields=b,p.col_being_mapped=d,a.sheet=e,a.modalInstance=c.open({templateUrl:"views/templates/map-file-modal.html",size:"sm",resolve:{project_fields:function(){return a.project_fields},sheet:function(){return a.sheet},dataoverviewctrl:function(){return p}},controller:showMappingPopupController})},p.openEditDetail=function(d){a.popup_data=angular.copy(d),a.youAreInModal=!0,a.modalInstance=c.open({templateUrl:"views/modal-edit-template.html",size:"lg",resolve:{popup_data:function(){return a.popup_data},youAreInModal:function(){return a.youAreInModal},success:function(){return a.success},removeFile:function(){return a.removeFile}},controller:["$scope","$modalInstance","popup_data","$timeout","youAreInModal","success","removeFile",function(a,c,d,g,h,j,k){a.popup_data=d,a.youAreInModal=h,a.success=j,a.removeFile=k,a.dataoverviewctrl=p,a.popup_data.this_level_edit_form=[],a.popup_data.this_level_edit_schema={type:"object",properties:{},required:[]},angular.forEach(d.main_cfc.project_data_fields,function(b){var c=angular.copy(b.edit_form.form[0]);c.htmlClass="col-xs-12",a.popup_data.this_level_edit_form.push(c),angular.extend(a.popup_data.this_level_edit_schema.properties,angular.copy(b.edit_schema.properties))}),a.success=function(b,c){var d=l.cbhBaseAttachment,e="";d.save({flowfile:"/"+i+"/datastore/cbh_flowfiles/"+b.uniqueIdentifier,data_point_classification:"/"+i+"/datastore/cbh_datapoint_classifications/"+a.popup_data.id},function(d){e=d.resource_uri;var f={url:e,printName:b.name,mimeType:b.file.type};angular.isUndefined(a.popup_data.main_data.project_data[c[0]])&&(a.popup_data.main_data.project_data[c[0]]={attachments:[]}),a.popup_data.main_data.project_data[c[0]].attachments.push(f)})},a.removeFile=function(b,c,d){angular.isUndefined(a.popup_data.main_data.project_data[b[0]])&&(console.log("setting to null"),a.popup_data.main_data.project_data[b[0]]={attachments:[]}),a.popup_data.main_data.project_data[b[0]].attachments=o("filter")(a.popup_data.main_data.project_data[b[0]].attachments,function(a,b){return a.url!==d})},a.modalInstance=c,a.cancel=function(){c.dismiss("cancel")},a.saveEdits=function(){p.setLoadingMessageHeight(),p.currentlyLoading=!0;var d=b.dataClassification,g=d.get({dc:a.popup_data.id});g.$promise.then(function(b){b[a.popup_data.level_from]=a.popup_data.main_data,b.$update({dc:a.popup_data.id},function(a){c.dismiss("saved"),f.go(f.current,e,{reload:!0})})},function(a){})}}]})},a.success=p.success,a.removeFile=p.removeFile,a.csrftoken=k[i.split("/")[0]+"csrftoken"],a.flowinit={target:j.instance_path.url_frag+"flow/upload/",headers:{"X-CSRFToken":a.csrftoken}},p.flowinit=a.flowinit,p.fetchData(),p.setLoadingMessageHeight=function(){var a=$(window).scrollTop();$("#loading-message").css("top",a+200+"px")},p.save_dpc=function(a){p.setLoadingMessageHeight(),p.currentlyLoading=!0;var c=b.dataClassification;c.save(a,function(a){f.go(f.current,e,{reload:!0})},function(a){})},p.tableLoaded=function(a){g(function(){p.initDblScroll(a)},2e3)},p.initDblScroll=function(a){$("#table-"+a).doubleScroll()}}]),angular.module("chembiohubAssayApp").controller("SearchAssaysCtrl",["$scope","$filter","$modal","urlConfig","$stateParams","$state","$location","userList",function(a,b,c,d,e,f,g,h){function i(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}a.cbh.appName="AssayReg",a.users=h,a.userData={useruris:[]},a.cbh.textsearch=e.textsearch,a.$watch(function(a){return a.cbh.textsearch},function(a){e.textsearch=a,f.params.textsearch=a,g.search("textsearch",a)}),a.selections={l0:[],l1:[],l2:[]},e.l0&&(a.selections.l0=decodeURIComponent(e.l0).split(",")),e.l1&&(a.selections.l1=decodeURIComponent(e.l1).split(",")),e.l2&&(a.selections.l2=decodeURIComponent(e.l2).split(",")),e.useruris&&(a.userData.useruris=decodeURIComponent(e.useruris).split(",")),a.dates={start:"",end:"",startES:"",endES:""},a.modalInstance={},a.popup_data={},a.indexVMOnInit=[],a.$watch(function(a){return a.selections.l0},function(a,b){i(a,b)||(e.l0=a,f.params.l0=a,g.search("l0",a.join()))},!0),a.$watch(function(a){return a.selections.l1},function(a,b){i(a,b)||(e.l1=a,f.params.l1=a,g.search("l1",a.join()))},!0),a.$watch(function(a){return a.selections.l2},function(a,b){i(a,b)||(e.l2=a,f.params.l2=a,g.search("l2",a.join()))},!0),a.$watch(function(a){return a.userData.useruris},function(a,b){i(a,b)||(e.useruris=a,f.params.useruris=a,g.search("useruris",a.join()))},!0),a.searchFieldsCount=0,a.advancedSearchFields=[],a.addCustomField=function(){var b=a.searchFieldsCount+1;a.advancedSearchFields.push({name:"",value:"",id:b,newItemNo:b}),a.searchFieldsCount++},a.removeCustomField=function(b){var c=a.advancedSearchFields.indexOf(b);a.advancedSearchFields.splice(c,1)},a.selectedUris=function(b){return a.selections[b]},a.isSelectedInUrl=function(b,c){return angular.forEach(a.selections[b],function(a){return console.log(b),a==c?!0:void 0}),!1},a.clearSelections=function(b){a.selections[b]=[]},a.clearUserSelections=function(){
a.userData.useruris=[]},a.dateHandler=function(c){var d=a.dates[c];if(""!=d){var h=new Date(d);a.dates[c+"ES"]=b("date")(h,"yyyy-MM-dd")}else a.dates[c+"ES"]="";e[c]=d,f.params[c]=d,g.search(c,d)},angular.forEach(["start","end"],function(b){e[b]&&(a.dates[b]=e[b],a.dateHandler(b))}),a.resetForm=function(){f.go("cbh.search_assays",{l0:void 0,l1:void 0,l2:void 0,start:void 0,textsearch:void 0,end:void 0})},a.showChemblPopup=function(b){a.popup_data=b,a.modalInstance=c.open({templateUrl:"views/modal-template.html",size:"lg",resolve:{popup_data:function(){return a.popup_data}},controller:["$scope","$modalInstance","popup_data","$timeout",function(a,b,c,d){a.popup_data=c,a.popup_data.main_cfc="chembl",a.modalInstance=b,a.cancel=function(){b.dismiss("cancel")}}]})},a.showDetailPopup=function(b,d){$http.get(b).then(function(b){a.popup_data={},a.popup_data.main_cfc=b.data,a.popup_data.main_data={},a.popup_data.main_data.project_data=d,a.modalInstance=c.open({templateUrl:"views/modal-template.html",size:"lg",resolve:{popup_data:function(){return a.popup_data}},controller:["$scope","$modalInstance","popup_data","$timeout",function(a,b,c,d){a.popup_data=c,a.modalInstance=b,a.cancel=function(){b.dismiss("cancel")}}]})})},a.isHighlightPresent=function(a,b){return angular.forEach(a,function(a,c){return 0==c.indexOf(b)?a:void 0}),!1}}]),angular.module("chembiohubAssayApp").factory("FlowFileFactory",["$resource","urlConfig",function(a,b){var c=a(b.instance_path.url_frag+"datastore/cbh_flowfiles/:fileId",{fileId:"@fileId"}),d=a(b.instance_path.url_frag+"datastore/cbh_attachments",{flowfile:b.instance_path.url_frag+"datastore/cbh_flowfiles/@flowfile",data_point_classification:"@data_point_classification",chosen_data_form_config:"@chosen_data_form_config",sheet_name:"@sheetname"}),e=a(b.instance_path.url_frag+"datastore/cbh_base_attachments",{flowfile:b.instance_path.url_frag+"datastore/cbh_flowfiles/@flowfile",data_point_classification:"@data_point_classification"}),f=a(b.instance_path.url_frag+"datastore/cbh_attachments/save_temporary_data/",{sheetId:"@sheetId"}),g=a(b.instance_path.url_frag+"cbh_flowfiles/:identifier",{identifier:"@identifier"});return{cbhFlowfile:c,cbhAttachments:d,cbhSaveAttachment:f,cbhBaseAttachment:e,cbhChemFlowFile:g}}]),angular.module("chembiohubAssayApp").factory("InvitationFactory",["$resource","urlConfig",function(a,b){var c=a(b.invitations.list_endpoint,NaN);return{invite:c}}]),angular.module("chembiohubAssayApp").controller("AddSingleCompoundCtrl",["$scope","$rootScope","$timeout","$filter","$state","$stateParams","CBHCompoundBatch","ProjectFactory","MessageFactory","mol","projectList","FlowFileFactory",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=f.projectKey;a.clonedMol=angular.copy(j),a.mol=angular.copy(j),a.mol.molecule=a.mol.ctab,a.mol.id=null,a.clonedMol.id?a.idToClone=a.clonedMol.id:a.idToClone=null,a.success=function(b,c){var d=l.cbhChemFlowFile;d.get({identifier:b.uniqueIdentifier},function(d){var e=d.download_uri,f={url:e,printName:b.name,mimeType:b.file.type};a.mol.customFields[c[0]].attachments.push(f)})},a.removeFile=function(b,c,e){a.mol.customFields[b[0]].attachments=d("filter")(a.mol.customFields[b[0]].attachments,function(a,b){return a.url!==e})},a.sizeCheck=function(a,b){return console.log("file size",a.size),a.size>2e7?(a.flowObj.removeFile(a),alert("This system has a file size limit of 20Mb per file. Please try with a smaller file."),!1):void 0},a.editMode=!1,a.cbh.statename=e.current.name,a.revert=function(){a.mol=angular.copy(a.clonedMol),a.mol.molecule=a.mol.ctab,a.mol.id=null,a.idToClone||(a.mol.molecule="",a.mol.ctab=""),b.$broadcast("setMolecule"),a.errormess="",a.dataReady=!1,a.dataset=void 0},a.errormess="",a.doArchiveItem=!1,a.dataReady=!1,a.compoundBatches={data:[],sorts:[],excluded:[],redraw:0,columns:[]};var n=d("orderBy"),o=m;a.projectWithCustomFieldData,angular.forEach(k.objects,function(b){b.project_key===o&&(a.projectWithCustomFieldData=b,a.projectObj=b)}),a.$on("openedTaggingDropdown",function(c,d){var e={};e.pids=a.projectObj.id,e.autocomplete_field_path="custom_fields."+d.key,e.autocomplete=d.autocomplete,g.queryv2(e).then(function(a){b.$broadcast("autoCompleteTaggingData",a)})});var p=a.projectWithCustomFieldData.schemaform.form;Math.ceil(p.length/2);a.myform=angular.copy(p),angular.forEach(a.myform,function(a){a.feedback="{ 'glyphicon': true, 'glyphicon-asterisk': form.required && !hasSuccess() && !hasError() ,'glyphicon-ok': hasSuccess(), 'glyphicon-remove': hasError() }",a.disableSuccessState=!0}),a.$on("moleculeChanged",function(){a.dataReady=!1,a.dataset=void 0}),a.createMultiBatch=function(){a.currentlyLoading=!0,g.createMultiBatch(a.dataset).then(function(b){a.currentlyLoading=!1,a.filesInProcessing=!1,a.dataset.config=b.data,a.dataReady=!0,a.compoundBatches.data=b.data.objects,a.compoundBatches.savestats=b.data.savestats},function(b){a.dataset.config.errors=[i.getMessage("data_not_processed")],a.dataset.config.status="add",a.dataReady=!1,a.currentlyLoading=!1})},a.validateDrawn=function(){var b={multiplebatch:null,sketch:a.mol.molecule,type:"sketch",customFields:a.mol.customFields,supplementaryFields:a.mol.supplementaryFields,projectKey:m,struccol:"",state:"validate"};a.dataset={config:b,cancellers:[]},a.createMultiBatch(),a.$broadcast("schemaFormValidate")},a.validateOtherFormData=function(b){a.errormess="",a.$broadcast("schemaFormValidate"),b.$valid&&!b.$pristine?a.saveTemporaryCompoundData():b.$pristine?a.errormess="You must add some data before you can submit your form.":a.errormess="You have required fields missing or incorrect data - please correct these and try again."},a.saveTemporaryCompoundData=function(){a.currentlyLoading=!0,a.dataset.config.customFields=a.mol.customFields;var b=function(){a.cbh.justAdded=!0,e.transitionTo("cbh.searchv2",{encoded_query:d("encodeParamForSearch")({field_path:"multiple_batch_id",value:a.dataset.config.multiplebatch+""}),pids:[a.projectObj.id]},{location:!0,inherit:!1,relative:null,notify:!0})};g.saveMultiBatchMolecules(a.dataset.config).then(function(c){a.cbh.hideSearchForm=!0,a.idToClone&&a.doArchiveItem?(a.clonedMol.properties.archived="true",a.clonedMol.projectKey=a.projectWithCustomFieldData.project_key,g.patch(a.clonedMol).then(function(a){g.reindexModifiedCompound(a.id).then(function(a){b()})},function(b){a.currentlyLoading=!1})):b()},function(b){a.currentlyLoading=!1})},a.addSupplementaryField=function(){a.mol.supplementaryFields.length>0?(a.mol.supplementaryFields=n(a.mol.supplementaryFields,"id"),angular.forEach(a.mol.supplementaryFields,function(b,c){if(c==a.mol.supplementaryFields.length-1){var d=b.id+1;a.mol.supplementaryFields.push({id:d,name:"",value:""})}})):a.mol.supplementaryFields.push({id:0,name:"",value:""})},a.removeSupplemetaryField=function(b){var c=d("filter")(a.mol.supplementaryFields,{id:b},!0);a.mol.supplementaryFields.splice(a.mol.supplementaryFields.indexOf(c[0]),1)},a.myschema=angular.copy(a.projectWithCustomFieldData.schemaform.schema)}]),angular.module("chembiohubAssayApp").factory("ProjectTypeFactory",["$resource","urlConfig",function(a,b){return a(b.cbh_project_types.list_endpoint+"/:projectTypeId",{projectTypeId:"@projectTypeId"},{update:{method:"PATCH"}})}]),angular.module("chembiohubAssayApp").factory("DraftFactory",["$resource","urlConfig",function(a,b){var c=a(b.instance_path.url_frag+"datastore/cbh_datapoint_classifications/save_draft/",{content:"@content"}),d=a(b.instance_path.url_frag+"datastore/cbh_datapoint_classifications/get_draft/",{draft_key:"@draft_key"}),e=a(b.instance_path.url_frag+"datastore/cbh_datapoint_classifications/get_draft_list/");return{save_draft:c,get_draft:d,list:e}}]),angular.module("chembiohubAssayApp").controller("ProjectlistCtrl",["$rootScope","$state","$stateParams","$scope","AddDataFactory","$modal","$timeout","ProjectFactory","ProjectTypeFactory","Projectpermissions","userList","urlConfig","loggedInUser","ProjectPermissionAllRoles",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){d.default_project_type=void 0,d.links=[];var o=function(){i.get({saved_search_project_type:!1},function(a){var b=!1;d.projectTypes=a.objects.map(function(a){return a.set_as_default&&(d.default_project_type=a,b=!0),{name:a.name,value:a}}),g(function(){b||(d.default_project_type=a.objects[0])})})};o(),d.openProjectWindow=function(a){d.projectId=a,d.modalInstance=f.open({templateUrl:"views/modal-edit-project.html",size:"lg",resolve:{projectId:function(){return d.projectId},default_project_type:function(){return d.default_project_type},projectTypes:function(){return d.projectTypes}},controller:"ProjectfieldsCtrl"})},d.openEditPermissions=function(a){d.projectId=a.id,d.proj=a,d.modalInstance=f.open({templateUrl:"views/modal-project-permissions.html",size:"md",resolve:{proj:function(){return d.proj},permissions:function(){return n.get_for_project(d.projectId)}},controller:"ProjectpermissionsCtrl"})},d.cbh.appName="Platform",a.headline=d.cbh.skinning.project_alias+" List",a.subheading="A list of all of the projects you have access to.",a.help_lookup="",a.projectKey=d.cbh.skinning.project_alias+"s",a.projName=d.cbh.skinning.project_alias+"s",a.glyphicon="folder-open",d.isDefault=!0,d.toggleDataSummary={showFlag:!1},d.toggleSingleForm={showFlag:!1},d.cbh.searchForUserWithProjectKey=function(a){e.nestedDataClassification.get({project_key:a},function(a){a.objects.length>=1?b.go("cbh.search_assays",{useruris:[d.cbh.logged_in_user.resource_uri],l0:[a.objects[0].l0.resource_uri]}):b.go("cbh.search_assays",{useruris:[d.cbh.logged_in_user.resource_uri]})})},d.search={name:""}}]),angular.module("chembiohubAssayApp").controller("CbhCtrl",["$scope","$rootScope","$state","$location","$modal","urlConfig","loggedInUser","projectList","prefix","$compile","MessageFactory","skinConfig","InvitationFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=this;n.isIE=detectIE(),n.appName="Platform",n.logged_in_user=g,n.projects=h,n.skinning=l.objects[0],n.prefix=f.instance_path.base,n.api_base=f.admin.list_endpoint,n.searchPage=function(){c.go("cbh.search",{},{reload:!0})},n.textsearch="",a.projects=h.objects,b.projects=h.objects,a.projects.map(function(b){b.is_default||(a.isDefault=!1)}),angular.element(document).ready(function(){angular.element("info-box",function(){})}),a.isLoggedIn=function(){var a=!1;return n.logged_in_user.id>0&&(a=!0),a},b.getUrlBase=function(){return f.instance_path.url_frag},a.getProjectObj=function(b){angular.forEach(a.projects,function(a){return b==a.project_key?a:void 0})},n.messages=k.getMessages(),n.createCustomFieldTransport=function(a,b,c){var d,e="",f=[];if(angular.forEach(a,function(a){angular.isObject(a)&&(a=angular.fromJson(angular.toJson(a))),f.push(a)}),angular.isDefined(a)&&angular.isDefined(b)){if(a.length>b.length){if(e="add","obj"==c)var d=_.filter(f,function(a){return!_.findWhere(b,a)});else if("string"==c)var d=_.difference(f,b)}else if(b.length>a.length)if(e="remove","obj"==c)var d=_.filter(b,function(a){return!_.findWhere(f,a)});else if("string"==c)var d=_.difference(b,f);return{newValue:d[0],addOrRemove:e}}},n.openFilterPopup=function(b){console.log("col",b),a.col=angular.copy(b),a.modalInstance=e.open({templateUrl:"views/templates/compound-table-filter.html",size:"md",resolve:{col:function(){return a.col}},controller:["$scope","$modalInstance","col","$timeout",function(a,b,c,d){a.col=c,a.modalInstance=b,a.cancel=function(){b.dismiss("cancel")}}]})},n.errorPopup=function(b){a.popup_data=angular.copy(b),a.modalInstance=e.open({templateUrl:"views/templates/modal-error-template.html",size:"sm",resolve:{popup_data:function(){return a.popup_data}},controller:["$scope","$modalInstance","popup_data","$timeout",function(a,b,c,d){a.popup_data=c,a.modalInstance=b,a.cancel=function(){b.dismiss("cancel")}}]})},n.invitationPopup=function(){a.modalInstance=e.open({templateUrl:"views/templates/modal-invitation-template.html",size:"md",controller:["$scope","$modalInstance","InvitationFactory",function(a,b,c){a.clearForm=function(){a.invite={firstName:"",lastName:"",email:"",projects_selected:[],remind:!1},a.validationMessage=""},a.modalInstance=b,a.clearForm(),a.setWatcher=function(){a.watch=a.$watch("invite.email",function(b,c){b!=c&&(a.invite.remind=!1)})},a.setWatcher(),a.projects=[],angular.forEach(n.projects.objects,function(b){b.editor&&a.projects.push(b)}),a.cancel=function(){a.validationMessage="",b.dismiss("cancel")},a.sendInvite=function(){a.validationMessage="",""==a.invite.email?a.validationMessage="Please enter an email address so we can send the invitation.":0==a.invite.projects_selected.length?a.validationMessage="Please select at least one project to add this user to.":c.invite.save(a.invite,function(b){a.watch(),a.invite.email="",a.invite.remind=!1,a.validationMessage=b.message,$timeout(function(){a.setWatcher()},100)},function(b){409==b.status?(a.validationMessage=b.data.error,a.invite.remind=!0):(a.validationMessage="There was a problem sending your invitation, please contact the ChemBio Hub team.",b.data&&b.data.error&&(a.validationMessage=b.data.error))})}}]})},n.currentPageClass=function(a){return c.includes(a)?"current-page":""}}]),angular.module("chembiohubAssayApp").controller("ProjectfieldsCtrl",["$scope","$modalInstance","$rootScope","ProjectFactory","projectId","default_project_type","projectTypes","skinConfig",function(a,b,c,d,e,f,g,h){a.isIE=detectIE();var i=function(b){var c=!1,d=a.proj;return angular.isDefined(d)&&(angular.forEach(b.slice(0,-1),function(a){d=d[a]}),angular.isDefined(d)&&d.readonly_on_create&&(c=!0)),c},j=function(b){var c=!1,d=a.proj;return angular.isDefined(d)&&(angular.forEach(b.slice(0,-1),function(a){d=d[a]}),angular.isDefined(d)&&d.id&&(c=!0)),c?c:i(b)},k=h.objects[0].field_type_choices,l=[{value:"open",name:"Open"},{value:"restricted",name:"Restricted to editors"}],m=function(){a.projectForm=[{key:"name",htmlClass:"col-sm-4",disableSuccessState:!0,title:"Project Name",required:!0,feedback:!1,onChange:function(b,c){a.proj.custom_field_config.name=a.proj.name+"__config"}},{key:"project_type",title:"Project Type",type:"radiobuttons",titleMap:g,htmlClass:"col-sm-4",onChange:"updatedProjectType()",disableSuccessState:!0,feedback:!1},{key:"project_counter_start",htmlClass:"col-sm-4",disableSuccessState:!0,title:"Project Counter Starts At",required:!0,feedback:!1},{key:"custom_field_config.project_data_fields",title:"Project Data Fields",type:"array",description:"Fields that will be displayed for this project. Drag a field to change the order it is displayed in. The order of existing fields can be changed but they cannot be removed or renamed.",items:[{type:"section",htmlClass:"row",items:[{key:"custom_field_config.project_data_fields[].name",htmlClass:"col-sm-2",disableSuccessState:!0,feedback:!1,title:"Name",required:!0,isReadOnly:j},{title:"Required",type:"select",disableSuccessState:!0,isReadOnly:j,key:"custom_field_config.project_data_fields[].required","default":!1,titleMap:[{value:!0,name:"Yes"},{value:!1,name:"No"}],htmlClass:"col-sm-2"},{title:"Field Type",key:"custom_field_config.project_data_fields[].field_type",titleMap:k,disableSuccessState:!0,type:"select",htmlClass:"col-sm-2",isReadOnly:j},{title:"Description",key:"custom_field_config.project_data_fields[].description",htmlClass:"col-sm-2",disableSuccessState:!0,feedback:!1},{title:"Visibility",key:"custom_field_config.project_data_fields[].open_or_restricted",titleMap:l,disableSuccessState:!0,type:"select",htmlClass:"col-sm-3"}]},{type:"section",htmlClass:"row",items:[{htmlClass:"col-sm-6",key:"custom_field_config.project_data_fields[].default",title:"Default Value",disableSuccessState:!0,feedback:!1,isReadOnly:j,condition:"model.custom_field_config.project_data_fields[arrayIndex].required"},{htmlClass:"col-sm-6",key:"custom_field_config.project_data_fields[].allowed_values",disableSuccessState:!0,feedback:!1,title:"Allowed values (comma-separated)",isReadOnly:i,condition:"(model.custom_field_config.project_data_fields[arrayIndex].field_type == 'uiselect' || model.custom_field_config.project_data_fields[arrayIndex].field_type == 'uiselecttags' || model.custom_field_config.project_data_fields[arrayIndex].field_type == 'uiselecttag' || model.custom_field_config.project_data_fields[arrayIndex].field_type == 'radios')"}]}],htmlClass:"col-sm-12"}],a.projectSchema={type:"object",properties:{name:{title:"Project Name",type:"string",pattern:"^[a-zA-Z0-9_ /&]*$",validationMessage:{202:"Only letters, spaces, numbers, dashes, slashes, & signs and underscores in project names"}},project_type:{title:"Project Type",type:"object","enum":g.map(function(a){return a.value}),"default":f},project_counter_start:{title:"Project Counter Starts At",type:"integer","default":1},custom_field_config:{type:"object",properties:{project_data_fields:{type:"array",items:{type:"object",properties:{name:{type:"string","default":"",pattern:"^[^./\"',]*$",validationMessage:{202:"Dots, commas, quotes and slashes not permitted in field names"}},description:{type:"string"},required:{type:"boolean","default":!1},field_type:{type:"string","default":"char","enum":k.map(function(a){return a.value})},open_or_restricted:{type:"string","enum":l.map(function(a){return a.value}),"default":"open"},allowed_values:{type:"string","default":""},"default":{type:"string","default":""}}}}}}}}};a.modalInstance=b,a.updatedProjectType=function(){-1==e&&(a.proj.custom_field_config=angular.copy(a.proj.project_type.project_template.custom_field_config))},a.setProjectType=function(){g.forEach(function(b){b.value.id==a.proj.project_type.id&&(a.proj.project_type=b.value)})},-1==e?(a.operation="add",a.proj={project_type:f},a.updatedProjectType(),m()):d.get({projectId:e},function(b){a.operation="update",a.proj=b,a.setProjectType(),m()}),a.copyProjectDefinition=function(b){d.get({projectId:b},function(b){a.proj.project_type=b.project_type,a.setProjectType(),1==a.proj.custom_field_config.project_data_fields.length&&(""===a.proj.custom_field_config.project_data_fields[0].name||angular.isUndefined(a.proj.custom_field_config.project_data_fields[0].name))&&(a.proj.custom_field_config.project_data_fields=[]),angular.forEach(b.custom_field_config.project_data_fields,function(b){b.id=void 0,b.resource_uri=void 0,b.pk=void 0,a.proj.custom_field_config.project_data_fields.push(b)})})},a.cancel=function(){b.dismiss("cancel")},a.errormess="";var n=function(){var b={},c=[];angular.forEach(a.proj.custom_field_config.project_data_fields,function(a,d){angular.isUndefined(a.name)&&(a.name=""),a.name&&(angular.isUndefined(b[a.name])?b[a.name]=[d]:(b[a.name].push(d),c.push(a.name)))}),c.length>0&&(a.errormess="Duplicate names found:   "+c.join(", "))};a.saveChanges=function(c){if(a.$broadcast("schemaFormValidate"),a.errormess="",c.$valid){var e=function(a){b.dismiss("cancel"),location.reload(!0)};n(),a.errormess?console.log(c):(a.operation="add")?d.save(a.proj,e):d.update({projectId:a.proj.id},a.proj,e)}else a.errormess="Please correct the errors above in order to save this project."}}]),angular.module("chembiohubAssayApp").controller("ProjectpermissionsCtrl",["$scope","$q","$filter","$modalInstance","$rootScope","Projectpermissions","proj","permissions","userList","ProjectPermissionAllRoles",function(a,b,c,d,e,f,g,h,i,j){a.projectPermissions=h,a.allUsers=c("orderBy")(angular.copy(i),"display_name"),a.proj=g,a.saveChanges=function(){var b={objects:a.projectPermissions.roles.map(function(b){return a.projectPermissions[b]})};f.update({},b,function(b){location.reload(!0),a.cancel()})},a.cancel=function(){d.dismiss("cancel")},a.copyProjectPermissions=function(b){j.get_for_project(b,a.projectPermissions)}}]),angular.module("chembiohubAssayApp").factory("Projectpermissions",["$resource","urlConfig",function(a,b){return a(b.cbh_permissions.list_endpoint+"/:codename",{codename:"@codename"},{update:{method:"PATCH"}})}]),angular.module("chembiohubAssayApp").factory("ProjectPermissionAllRoles",["$timeout","Projectpermissions",function(a,b){return{get_for_project:function(c,d){var e={roles:["owner","editor","viewer"]};return angular.forEach(e.roles,function(f){e[f]=b.get({codename:c+"__"+f},function(b){if(angular.isDefined(d)){var c=0;angular.forEach(b.users,function(a){-1==d[f].users.indexOf(a)&&(d[f].users.push(a),c++)});var e;switch(c){case 0:e="No users were copied as "+f+"s.";break;case 1:if(-1!=["a","e","i","o","u"].indexOf(f.slice(0,1))){e="1 user was copied as an "+f+".";break}e="1 user was copied as a "+f+".";break;default:e=c+" users were copied as "+f+"s."}d[f+"_message"]=e,a(function(){d[f+"_message"]=""},1e4)}}),e[f+"_user_tagfunction"]=function(a){return{username:a,external:!0,first_name:"",last_name:"",email:a,inviting:!0,resource_uri:a}}}),e}}}]),angular.module("chembiohubAssayApp").factory("SavedSearchFactory",["$resource","urlConfig",function(a,b){var c=a(b.cbh_saved_search.list_endpoint,{},{});return{list:c}}]),angular.module("chembiohubAssayApp").controller("PlatemapCtrl",["$scope","$rootScope","urlConfig","$filter","loggedInUser","$stateParams","$state","projectKey","projectList","CBHCompoundBatch",function(a,b,c,d,e,f,g,h,i,j){angular.forEach(i.objects,function(b){b.project_key===h&&(a.projectObj=b)}),a.newPlateForm={},a.schemaFormHolder={},a.searchFormSchema=angular.copy(a.cbh.projects.searchform);angular.copy(a.projectObj.schemaform.form);a.projectObj.schemaform.schema.required=["Name","Plate Size","Plate Type"],angular.forEach(a.projectObj.schemaform.form,function(a){a.feedback="{ 'glyphicon': true, 'glyphicon-asterisk': form.required && !hasSuccess() && !hasError() ,'glyphicon-ok': hasSuccess(), 'glyphicon-remove': hasError() }",a.disableSuccessState=!0}),a.pagination={current:1},a.batchesPerPage=5,a.schemaFormHolder.well_form=[{key:"barcode",knownBy:"barcode",htmlClass:"col-sm-4",disableSuccessState:!0,title:"Barcode ID",required:!0,feedback:!1},{key:"units",knownBy:"units",title:"Units",htmlClass:"col-sm-4",disableSuccessState:!0,feedback:!1},{key:"conc",knownBy:"conc",title:"Concentration",htmlClass:"col-sm-4",disableSuccessState:!0,feedback:!1},{title:"Pick from list",key:"uuid",knownBy:"uuid",htmlClass:"col-sm-6",onChange:"updated(modelValue,form)",disableSuccessState:!0,feedback:!0,type:"filtereddropdown",options:{tagging:!0,fetchDataEventName:"openedSearchDropdown",dataArrivesEventName:"autoCompleteData",multiple:!1,staticItems:[]}}],a.schemaFormHolder.well_schema={type:"object",properties:{barcode:{title:"Barcode ID",type:"string",pattern:"^[a-zA-Z0-9_ /&]*$",validationMessage:{202:"Only letters, spaces, numbers, dashes, slashes, & signs and underscores in project names"}},units:{title:"Units",type:"string"},conc:{title:"Concentration",type:"string",pattern:"^[a-zA-Z0-9_ /&]*$",disableSuccessState:!0,feedback:!1},uuid:{type:"filtereddropdown",items:{type:"string"},format:"filtereddropdown","default":[],options:{tagging:!0,fetchDataEventName:"openedSearchDropdown",dataArrivesEventName:"autoCompleteData",multiple:!1,staticItems:[]}}},required:[]},a.clearForm=function(b){a.newPlateForm={},b.$setPristine(),a.showPlate=!1},a.showPlate=!1,a.setupNewPlateFromForm=function(b){a.errormess="",b.$valid&&""!=a.newPlateForm.Name&&""!=a.newPlateForm["Plate Size"]&&""!=a.newPlateForm["Plate Type"]&&!b.$pristine?(a.showPlate=!0,a.errormess=""):b.$pristine?a.errormess="You must add some details":b.$error?(""==a.newPlateForm.Name&&(a.errormess=a.errormess+"Name, "),a.newPlateForm["Plate Size"]||(a.errormess=a.errormess+"Plate Size, "),""==a.newPlateForm["Plate Type"]&&(a.errormess=a.errormess+"Plate Type "),a.errormess=a.errormess+"cannot be empty."):a.errormess="Some other error"},a.saveWholePlate=function(){var b={project:{pk:a.projectObj.id},blinded_batch_id:"EMPTY_STRING",custom_fields:{Description:a.newPlateForm.Description,Name:a.newPlateForm.Name,"Plate Size":a.newPlateForm["Plate Size"],"Plate Type":a.newPlateForm["Plate Type"],wells:a.newPlateForm.wells},uncurated_fields:{},warnings:{},properties:{},errors:{}};j.saveSingleCompound(b).then(function(b){a.plateSaved=!0,g.go("cbh.projects.project.listplates",{projectKey:h})})},a.cbh.changeSearchParams=function(a,b){g.params=a,f=a,g.go(g.current,a,{notify:!1,reload:!1,location:"replace",inherit:!0})},a.loadPlateMaps=function(){var b=({pids:a.projectObj.id},angular.copy(f));a.cbh.changeSearchParams(b),b=angular.copy(f),b.page||(b.page=1),b.limit=a.batchesPerPage,b.offset=5*(b.page-1),b.pids=a.projectObj.id,j.queryv2(b).then(function(b){a.totalCount=b.meta.total_count,a.plates=b.objects,f.plate&&a.loadPlateSpecifiedInUrl()})},a.editingPlate={},a.showEditingForm=!1,a.editingPlateId=0,a.loadPlateSpecifiedInUrl=function(){a.loadPlateForEditing(parseInt(f.plate))},a.loadPlateForEditing=function(b){a.plateSaved=!1;var c=d("filter")(a.plates,{id:b},!0);a.editingPlate=c[0].custom_fields,a.editingPlateId=b,a.showEditingForm=!0;var e=angular.fromJson(a.editingPlate.wells);a.editingPlate.wells={},a.editingPlate.wells=angular.copy(e)},a.patchWholePlate=function(){var b=d("filter")(a.plates,{id:a.editingPlateId},!0);b[0].custom_fields=a.editingPlate,j.patch(b[0]).then(function(b){a.plateSaved=!0})},a.pageChanged=function(b){a.plateSaved=!1;var c=angular.copy(f);c.page=b,c.compoundBatchesPerPage=a.batchesPerPage,f=c,a.loadPlateMaps()}}]),angular.module("chembiohubAssayApp").factory("PlateMapFactory",["$resource","urlConfig",function(a,b){var c=a(b.cbh_plate_map.list_endpoint+"/:id",{id:"@id"},{update:{method:"PATCH"}}),d=a(b.cbh_plate_map.list_endpoint+"/get_list_elasticsearch/",{creator_uri:"@creator_uri"},{}),e=a(b.cbh_plate_map.list_endpoint+"/reindex_compound",{},{});return{list:c,list_es:d,reindex:e}}]),angular.module("chembiohubAssayApp").directive("platemap",["$filter","CBHCompoundBatch","$stateParams",function(a,b,c){return{templateUrl:"views/templates/plate-map-template.html",restrict:"E",transclude:!0,scope:{plateForm:"=plate",schemaFormHolder:"=sfh",cbh:"=",savePlateFunction:"&",plateSaved:"="},controller:["$scope","$rootScope","$filter","CBHCompoundBatch","$stateParams",function(a,b,c,d,e){a.initialisePlate=function(){var b=parseInt(a.plateForm["Plate Size"]);96==b?(a.rows=["A","B","C","D","E","F","G","H"],a.cols=["1","2","3","4","5","6","7","8","9","10","11","12"]):48==b&&(a.rows=["A","B","C","D"],a.cols=["1","2","3","4","5","6"]),a.plateForm.wells||(a.plateForm.wells={},angular.forEach(a.rows,function(b){angular.forEach(a.cols,function(c){var d=b+c;a.plateForm.wells[d]={row:b,col:c,hasData:!1,uuid:[]}})}))},a.initialisePlate(),a.wellForm={},a.selectedWell={},a.selectedWellLocation="",a.plateSaved=!1,a.searchFormSchema=a.schemaFormHolder,a.showWellForm=function(c){a.plateSaved=!1,a.selectedWell=c,a.wellForm=angular.copy(c),b.$broadcast("schemaFormRedraw")},a.clearWell=function(c){var d=angular.copy(a.selectedWell.row),e=angular.copy(a.selectedWell.col);a.plateForm.wells[a.selectedWellLocation]={row:d,col:e,hasData:!1,uuid:[],justCleared:!0},b.$broadcast("schemaFormRedraw"),c.$setPristine()},a.isWellSelected=function(b,c){return a.selectedWell.row+a.selectedWell.col==b?(a.selectedWellLocation=b,a.wellForm=c.wells[a.selectedWellLocation],!0):!1},a.wellHasData=function(a,b){return b.wells[a].hasData},a.saveWell=function(b){angular.extend(a.plateForm.wells[a.selectedWellLocation],a.wellForm),a.plateForm.wells[a.selectedWellLocation].justCleared||(a.plateForm.wells[a.selectedWellLocation].hasData=!0),a.plateForm.wells[a.selectedWellLocation].justCleared=!1,b.$setPristine()},a.doSavePlate=function(b){b.$dirty&&(angular.extend(a.plateForm.wells[a.selectedWellLocation],a.wellForm),a.plateForm.wells[a.selectedWellLocation].justCleared||(a.plateForm.wells[a.selectedWellLocation].hasData=!0),a.plateForm.wells[a.selectedWellLocation].justCleared=!1),a.savePlateFunction()},a.$on("openedSearchDropdown",function(a,c){var f=angular.copy(e);f.autocomplete_field_path="uuid",f.autocomplete=c.autocomplete,d.queryv2(f).then(function(a){b.$broadcast("autoCompleteData",a)})}),a.showWellForm(a.plateForm.wells.A1),a.$watch("plateForm",function(){a.initialisePlate(),a.showWellForm(a.plateForm.wells.A1)})}]}}]),angular.module("chembiohubAssayApp").controller("Searchv2Ctrl",["$scope","$http","$rootScope","$filter","$stateParams","$location","$state","$timeout","projectFactory","gridconfig","CBHCompoundBatch","urlConfig","SearchUrlParamsV2","$modal","loggedInUser","ProjectTypeFactory","SavedSearchFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.cbh.appName="ChemiReg",a.searchFormSchema=angular.copy(a.cbh.projects.searchform),a.cbh.statename=g.current.name,a.projectObj={},a.cancel=function(){g.params={},e={};var b=searchUrlParams.setup({},{molecule:{}});a.cbh.searchForm=angular.copy(b.searchForm),g.transitionTo("cbh.searchv2",{location:!0,inherit:!1,relative:null,notify:!0,reload:!0}),g.go(g.current.name,g.params,{reload:!0})},a.hasSearchBeenPerformed=function(){return g.params=={}?!1:!0},a.openNewSavedSearchPopup=function(){a.newSavedSearchModel={},a.modalInstance=n.open({templateUrl:"views/templates/new-saved-search-modal.html",size:"md",resolve:{newSavedSearchModel:function(){return a.newSavedSearchModel},saveSearch:function(){return a.saveSearch},projectFactory:function(){return i}},controller:["$scope","$modalInstance","newSavedSearchModel","ProjectTypeFactory","projectFactory","SavedSearchFactory","saveSearch","skinConfig",function(a,b,c,d,e,f,g,h){a.newSavedSearchModel=c,a.savedSearchSchemaForm=h.objects[0].savedsearch_schemaform,a.saveSearch=g,a.modalInstance=b,a.errormess="",a.cancel=function(){b.dismiss("cancel")},a.doValidation=function(c){console.log("doValidation being called",c),c.$valid&&""!=a.newSavedSearchModel.alias&&!c.$pristine?(a.saveSearch(),b.dismiss("cancel")):c.$pristine&&(a.errormess="You must add a title")}}]})},a.openMySavedSearchPopup=function(){a.links=[];var c=d("encodeParamForSearch")({field_path:"created_by",value:o.display_name}),e={encoded_query:c};b.get(l.cbh_saved_search.list_endpoint+"/",{params:e}).then(function(b){a.links=b.data.objects,a.modalInstance=n.open({templateUrl:"views/templates/my-searches-modal.html",size:"md",resolve:{links:function(){return a.links},doFreshSearch:function(){return a.doFreshSearch}},controller:["$scope","$modalInstance","links","loggedInUser","doFreshSearch",function(a,b,c,d,e){a.links=c,a.loggedInUser=d,a.modalInstance=b,a.doFreshSearch=e,a.cancel=function(){b.dismiss("cancel")},a.personalOrGroup=function(a){return"personal"}}]})})},a.$on("chemicalSearchReady",function(){1==a.cbh.cameFromSavedSearch&&(a.cbh.cameFromSavedSearch=!1,c.$broadcast("chemicalFilterApplied"),h(function(){c.$broadcast("searchParamsChanged")},50))}),a.doFreshSearch=function(b){a.cbh.cameFromSavedSearch=!0},a.saveSearch=function(){p.get({saved_search_project_type:!0},function(b){a.savedSearchType=b.objects[0],console.log(a.savedSearchType);var c=new Date;a.savedSearchType.project_template.name=a.newSavedSearchModel.alias+c.getTime().toString(),a.savedSearchType.project_template.custom_field_config.name=a.newSavedSearchModel.alias+c.getTime().toString(),m.generate_capped_saved_search(e,a.cbh.selected_projects).then(function(b){var c="";e.chemical_search_id&&(c=e.chemical_search_id);var d=g.href(g.current.name,b);i.save(a.savedSearchType.project_template,function(b,c){var e=(b.resource_uri,{project:{pk:b.id},blinded_batch_id:"EMPTY_ID",custom_fields:{alias:a.newSavedSearchModel.alias,url:window.location.href,capped_url:d,chem_search:c}}),f=q.list;f.save(e,function(a){})})})})},a.cbh.column={},a.$on("columnSelection",function(b,c){a.cbh.column=c})}]),angular.module("chembiohubAssayApp").controller("Compoundbatchv2Ctrl",["$scope","$rootScope","$state","$stateParams","$timeout","CBHCompoundBatch","urlConfig","$window","$location","$anchorScroll","$filter","SearchUrlParamsV2","skinConfig","FlowFileFactory","chemicalSearch",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(b,c){l.setBaseDownloadUrl(a.cbh,d),a.resetCompoundList(),1==a.cbh.selected_projects.length?a.cbh.selected_projects[0].editor&&(a.cbh.projAddingTo=a.cbh.selected_projects[0]):a.cbh.projAddingTo=void 0;
var e=document.querySelector(".hot-loading"),g=angular.element(e);g.addClass("now-showing"),q=String(Date.now());var h=String(q);c.limit=a.pagination.compoundBatchesPerPage.value,c.offset=(b-1)*parseInt(a.pagination.compoundBatchesPerPage.value),a.noData="",f.queryv2(c).then(function(b){q==h&&(a.totalCompoundBatches=b.meta.total_count,a.compoundBatches.data=b.objects,a.compoundBatches.backup=angular.copy(b.objects),b.objects.length>0?(a.imageCallback(),a.noData=""):a.pagination.current*parseInt(a.pagination.compoundBatchesPerPage.value)>a.totalCompoundBatches+a.pagination.compoundBatchesPerPage.value?(a.pageChanged(1),a.imageCallback()):(a.imageCallback(),a.noData="No "+m.objects[0].result_alias+" found.",a.editModeUnreachable()||(a.noData+=" To add "+m.objects[0].result_alias+" click the Add Single or Add Multiple links below.")),angular.isDefined(d.showBlanks)&&(a.compoundBatches.showBlanks=JSON.parse(d.showBlanks)),angular.isDefined(d.showNonBlanks)&&(a.compoundBatches.showNonBlanks=JSON.parse(d.showNonBlanks)))},function(b){a.resetCompoundList(),a.noData="Sorry, there was an error with that query. No data found.",a.imageCallback()}),a.cbh.showSingle&&(a.toggleAddData(),a.cbh.showSingle=!1)}a.cbh.resetSearch=function(){c.go(c.current.name,{},{reload:!0,inherit:!1})},a.resetCompoundList=function(){a.totalCompoundBatches=0;var b=c.current.name.replace(".record","");a.cbh.tabular_data_schema=m.objects[0].get_filtered_table_schema(b,a.cbh.selected_projects),a.compoundBatches={data:[],redraw:0,sorts:[]}},a.$on("chemicalSearch",function(a){var c=m.objects[0].chemicalSearch;c.id=void 0,o.save(c,function(a){console.log(a),m.objects[0].chemicalSearch=a,b.$broadcast("chemicalSearchReady")})}),a.$on("removeStructureSearch",function(){angular.copy(m.objects[0].chemicalSearch.query_type);m.objects[0].chemicalSearch.molfile="",m.objects[0].chemicalSearch.filter_is_applied=!1,m.objects[0].chemicalSearch.inprogress=!1,m.objects[0].chemicalSearch.smiles="",m.objects[0].chemicalSearch.id=void 0,m.objects[0].chemicalSearch.image=void 0;var c=d;c.chemical_search_id=void 0,a.cbh.changeSearchParams(c,!0),a.$broadcast("chemicalSearchReady"),b.$broadcast("setMolecule")}),a.$on("chemicalFilterApplied",function(b,c){var e=l.generate_chemical_params(d);a.cbh.changeSearchParams(e,!0),a.cbh.justAdded=!1}),a.$on("openedSearchDropdown",function(c,e){var g=angular.copy(d),h=null;angular.forEach(a.cbh.tabular_data_schema,function(a){a.showFilters&&(h=a)}),g.autocomplete_field_path=h.data,g.autocomplete=e.autocomplete,f.queryv2(g).then(function(a){b.$broadcast("autoCompleteData",a)})}),a.cbh.sendToSearch=function(c){e(function(){angular.forEach(a.cbh.tabular_data_schema,function(a){a.showFilters=!1}),c.showFilters=!0,a.cbh.column=c,b.$broadcast("columnSelection",a.cbh.column),a.cbh.changeSearchParams(d,!0)})},a.$on("cleanupFilters",function(a,b){angular.forEach(m.objects[0].query_schemaform["default"].schema.properties,function(a,c){"query_type"!=c&&c?b.col.filters[c]=angular.copy(a["default"]):b.reset_query_type&&"query_type"==c&&(b.col.filters.query_type=angular.copy(a["default"]))})}),a.$on("filtersUpdated",function(b,c){var e=m.objects[0].filters_applied.indexOf(c.field_path),f=!1;e>-1&&(m.objects[0].filters_applied.splice(e,1),f=!0),c.addNew&&(m.objects[0].filters_applied.push(c.field_path),f=!0);var g=l.generate_filter_params(d);a.cbh.changeSearchParams(g,!0),a.cbh.justAdded=!1}),a.$on("removeAllHides",function(b,c){m.objects[0].hides_applied=[];var e=l.generate_hide_params(d);a.cbh.changeSearchParams(e,!0)}),a.$on("removeHide",function(b,c){var e=m.objects[0].hides_applied.indexOf(c.field_path);e>-1&&m.objects[0].hides_applied.splice(e,1);var f=l.generate_hide_params(d);a.cbh.changeSearchParams(f,!0)}),a.$on("addHide",function(b,c){var e=m.objects[0].hides_applied.indexOf(c.field_path);e>-1&&m.objects[0].hides_applied.splice(e,1),m.objects[0].hides_applied.push(c.field_path);var f=l.generate_hide_params(d);a.cbh.changeSearchParams(f,!0)}),a.$on("addSort",function(b,c){var e=m.objects[0].sorts_applied.indexOf(c.field_path);e>-1&&m.objects[0].sorts_applied.splice(e,1),m.objects[0].sorts_applied.push(c.field_path);var f=l.generate_sort_params(d);a.cbh.changeSearchParams(f,!0)}),a.$on("removeSort",function(b,c){var e=m.objects[0].sorts_applied.indexOf(c.field_path);e>-1&&m.objects[0].sorts_applied.splice(e,1);var f=l.generate_sort_params(d);a.cbh.changeSearchParams(f,!0)}),a.urlConfig=g,a.totalCompoundBatches=0,a.projects=a.cbh.projects.objects,a.cbh.column={},a.cbh.watcher=a.$watch(function(a){return a.cbh.textsearch},function(b,c){if(b!=c){var e=l.get_textsearch_params(d,b);a.cbh.changeSearchParams(e,!0)}},!0),a.cbh.selectAllProjects=function(){a.cbh.selected_projects=[],angular.forEach(a.cbh.projects.objects,function(b){a.cbh.selected_projects.push(b)}),angular.forEach(a.cbh.projects.objects,function(a){a.filtered=!0});var b=l.get_project_params(d,a.cbh.selected_projects);a.cbh.changeSearchParams(b,!0),a.cbh.justAdded=!1},a.cbh.deSelectAllProjects=function(){a.cbh.selected_projects=[],angular.forEach(a.cbh.projects.objects,function(a){a.filtered=!1});var b=l.get_project_params(d,a.cbh.selected_projects);a.cbh.changeSearchParams(b,!0),a.cbh.justAdded=!1},a.cbh.toggleProjectFiltered=function(b){var c=!0;angular.forEach(a.cbh.selected_projects,function(a,d,e){b.id==a.id&&(e.splice(d,1),c=!1,b.filtered=!1)}),c&&(a.cbh.selected_projects.push(b),b.filtered=!0);var e=l.get_project_params(d,a.cbh.selected_projects);a.cbh.changeSearchParams(e,!0),a.cbh.justAdded=!1},a.cbh.changeSearchParams=function(b,e){e&&(a.pagination.current=1),c.params=b,d=b,c.go(c.current.name,b,{notify:!1,reload:!1,location:"replace",inherit:!0}),p(a.pagination.current,b)},a.changeView=function(){d.viewType=a.listOrGallery.choice,c.params.viewType=a.listOrGallery.choice,i.search(c.params)},a.cbh.setUpPageNumbers=function(){a.listOrGallery={choice:"list"},d.viewType&&(a.listOrGallery.choice=d.viewType),a.pagination={current:1};var b=[{label:"10/page",value:"10"},{label:"20/page",value:"20"},{label:"50/page",value:"50"},{label:"100/page",value:"100"}];if(a.itemsPerPage=angular.copy(b),a.pagination.compoundBatchesPerPage=a.itemsPerPage[2],angular.isDefined(d.compoundBatchesPerPage)){var c=k("filter")(a.itemsPerPage,d.compoundBatchesPerPage,!0);c[0]?a.pagination.compoundBatchesPerPage=c[0]:a.pagination.compoundBatchesPerPage=a.itemsPerPage[1]}angular.isDefined(d.page)&&(a.pagination.current=d.page)},a.cbh.patchRecord=function(b){a.compoundBatches.backup=angular.copy(a.compoundBatches.data),f.patch(b).then(function(c){angular.forEach(a.compoundBatches.data,function(d){d.id==b.id&&(a.changesToUndo=[[c.id]])})}),a.compoundBatches.redraw++},a.cbh.setUpPageNumbers(),a.cbh.toggleEditMode=function(){a.cbh.editMode=!a.cbh.editMode;var b=angular.copy(d);b.page=1,b.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,b.doScroll="true",b.editMode=a.cbh.editMode.toString(),a.cbh.changeSearchParams(b,!1)},a.addingData=!1,a.errormess="",a.doSingleCompoundValidation=function(b){a.errormess="",a.$broadcast("schemaFormValidate"),b.$valid&&!b.$pristine?a.saveSingleCompound():b.$pristine?a.errormess="You must add some data before you can submit your form.":a.errormess="You have required fields missing or incorrect data - please correct these and try again."},a.saveSingleCompound=function(){f.saveSingleCompound(a.newMol).then(function(b){a.blankForm(a.cbh.toggleAddingOff),a.pageChanged(1)})},a.$on("removeForm",function(){console.log("rem")}),a.$on("cloneAnItem",function(b,c){a.toggleAddData(c)}),a.toggleAddData=function(b){a.cbh.editMode&&a.cbh.toggleEditMode(),a.addingData?a.addingData=!1:(a.addingData=!0,a.blankForm(!1,b))},a.$on("openedTaggingDropdown",function(c,d){var e={};e.pids=a.cbh.projAddingTo.id,e.autocomplete_field_path="custom_fields."+d.key,e.autocomplete=d.autocomplete,f.queryv2(e).then(function(a){b.$broadcast("autoCompleteTaggingData",a)})}),a.blankForm=function(b,c){if(angular.isDefined(a.cbh.projAddingTo)){var d=angular.copy(a.cbh.projAddingTo.schemaform.form);angular.forEach(d,function(a){a.feedback="{ 'glyphicon': true, 'glyphicon-asterisk': form.required && !hasSuccess() && !hasError() ,'glyphicon-ok': hasSuccess(), 'glyphicon-remove': hasError() }",a.disableSuccessState=!0}),a.myschema=angular.copy(a.cbh.projAddingTo.schemaform.schema),a.formChunks=d.chunk(Math.ceil(a.cbh.projAddingTo.schemaform.form.length/3)),a.newMol={custom_fields:{},project:{pk:a.cbh.projAddingTo.id}},c&&(a.newMol.custom_fields=angular.copy(c.custom_fields),a.newMol.id=void 0,a.newMol.resource_uri=void 0),angular.forEach(a.formChunks,function(a){a.$pristine=!0}),b&&(a.addingData=!1),a.errormess=""}},a.changeNumberPerPage=function(b){var c=angular.copy(d);c.page=1,c.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,c.doScroll="true",a.cbh.changeSearchParams(c,!1)},a.pageChanged=function(b){var c=angular.copy(d);c.page=b,c.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,c.doScroll="true",a.cbh.changeSearchParams(c)},a.pageChanged2=function(b){var c=angular.copy(d);c.page=b,c.compoundBatchesPerPage=a.pagination.compoundBatchesPerPage.value,c.doScroll="false",a.cbh.changeSearchParams(c)},a.imageCallback=function(){a.compoundBatches.redraw++};var q;a.undoChanges=function(){a.compoundBatches.data=angular.copy(a.compoundBatches.backup);var c=a.cbh.changesToUndo.map(function(b){return a.compoundBatches.data[b[0]]});console.log(c),f.patchList({objects:c},b.projects).then(function(b){a.compoundBatches.redraw++,a.compoundBatches.backup=angular.copy(a.compoundBatches.data)})},a.$on("updateListView",function(){a.compoundBatches.backup=angular.copy(a.compoundBatches.data)}),a.cbh.saveChangesToCompoundDataInController=function(c,d){if(a.cbh.changesToUndo=[],angular.isDefined(c)&&c&&c.length>0){a.disableButtons=!0;var e=c.map(function(b){return a.compoundBatches.data[b[0]]});a.cbh.changesToUndo=c;var g={};g.objects=e,f.patchList(g,b.projects).then(function(a){})}},a.initialise=function(){d.mb_id&&(a.current_dataset_id=d.mb_id,a.datasets[a.current_dataset_id]={multiplebatch:a.current_dataset_id}),d.warningsFilter?a.warningsFilter=d.warningsFilter:a.warningsFilter="",angular.isDefined(d.sorts)&&(a.compoundBatches.sorts=JSON.parse(d.sorts))},a.editModeUnreachable=function(){return(1!=d.archived||angular.isUndefined(d.archived))&&1==a.cbh.selected_projects.length&&a.cbh.selected_projects[0].editor?!1:!0},a.cbh.setupParams=function(){l.generate_form(d,a.cbh);p(a.pagination.current,d),e(function(){a.$apply(function(){b.$broadcast("searchParamsChanged")})}),"true"==d.editMode||1==d.editMode?(a.cbh.editMode=!0,a.editModeUnreachable()&&a.cbh.toggleEditMode()):a.cbh.editMode=!1},a.cbh.setupParams(),a.success=function(b,c){var d=n.cbhChemFlowFile;d.get({identifier:b.uniqueIdentifier},function(d){var e=d.download_uri,f={url:e,printName:b.name,mimeType:b.file.type};a.newMol.custom_fields[c[0]].attachments.push(f)})},a.removeFile=function(b,c,d){a.newMol.custom_fields[b[0]].attachments=k("filter")(a.newMol.custom_fields[b[0]].attachments,function(a,b){return a.url!==d})},a.sizeCheck=function(a,b){return console.log("file size",a.size),a.size>2e7?(a.flowObj.removeFile(a),alert("This system has a file size limit of 20Mb per file. Please try with a smaller file."),!1):void 0},angular.element(h).bind("resize",function(){-1==c.current.name.indexOf("record")&&a.$apply(function(){b.$broadcast("filtersUpdated",{})})})}]),angular.module("chembiohubAssayApp").directive("searchFilter",[function(){return{template:'<div  ng-include="getTemplateUrl()"></div>',restrict:"E",transclude:!0,scope:{cbh:"="},controller:["$scope","$rootScope","skinConfig","$timeout",function(a,b,c,d){a.$on("columnSelection",function(e,f){a.col=f,a.getTemplateUrl=function(){return"chemical"==a.col.searchFormType?"views/templates/search-filter-templatev2_chemical.html":"views/templates/search-filter-templatev2.html"},a.col.showFilters=!0,a.col.filters?a.col.filters.field_path=f.data:a.col.filters={field_path:f.data,pick_from_list:[]},a.chemicalUpdated=function(c,e){console.log("molecule changed picked up"),a.chemicalfilters.inprogress=!0,console.log("calling up"),d(function(){b.$broadcast("chemicalSearch")})},a.fetching=!1,a.$on("moleculeChanged",function(){console.log("molecule changed picked up"),a.chemicalfilters.inprogress=!0,a.fetching||(a.fetching=!0,d(function(){a.fetching=!1,b.$broadcast("chemicalSearch")},50))}),a.$on("chemicalSearchReady",function(b){a.chemicalfilters=c.objects[0].chemicalSearch}),"chemical"==f.searchFormType?(a.queryAsfForm=angular.copy(c.objects[0].chem_query_schemaform["default"].form),a.queryAsfSchema=angular.copy(c.objects[0].chem_query_schemaform["default"].schema),a.chemicalfilters=c.objects[0].chemicalSearch):(a.queryAsfForm=angular.copy(c.objects[0].query_schemaform["default"].form),a.queryAsfSchema=angular.copy(c.objects[0].query_schemaform["default"].schema)),a.sortAsfForm=angular.copy(c.objects[0].sort_schemaform["default"].form),a.sortAsfSchema=angular.copy(c.objects[0].sort_schemaform["default"].schema),a.hideAsfForm=angular.copy(c.objects[0].hide_schemaform["default"].form),a.hideAsfSchema=angular.copy(c.objects[0].hide_schemaform["default"].schema),a.col.blanksQuery=!1,a.$broadcast("schemaFormRedraw")}),a.updated=function(c,e){"pick_from_list"==e.key[0]?0==c.length?(b.$broadcast("cleanupFilters",{col:a.col,reset_query_type:!1}),a.sendFilterUpdate(!1)):a.sendFilterUpdate(!0):d(function(){document.getElementById("validatorId").click()})},a.clearFilters=function(){b.$broadcast("cleanupFilters",{col:a.col,reset_query_type:!0}),a.sendFilterUpdate(!1)},a.closeMenu=function(){a.col.showFilters=!1,b.$broadcast("updateListView")},a.queryTypeChanged=function(c,d){b.$broadcast("cleanupFilters",{col:a.col,reset_query_type:!1});var e=c.indexOf("blanks")>-1;a.sendFilterUpdate(e),a.$broadcast("schemaFormRedraw")},a.hideChanged=function(c,d){c==a.hideAsfSchema.properties[d.key]["default"]?b.$broadcast("removeHide",{field_path:a.col.data}):(b.$broadcast("addHide",{field_path:a.col.data}),a.closeMenu())},a.sortChanged=function(c,d){c==a.sortAsfSchema.properties[d.key]["default"]?b.$broadcast("removeSort",{field_path:a.col.data}):b.$broadcast("addSort",{field_path:a.col.data,direction:c})},a.sendFilterUpdate=function(c){b.$broadcast("filtersUpdated",{addNew:c,field_path:a.col.data,col:a.col})},a.submit=function(b){return a.$broadcast("schemaFormValidate"),d(function(){b.$valid?a.sendFilterUpdate(!0):a.sendFilterUpdate(!1)}),!1},a.chemicalsubmit=function(){b.$broadcast("chemicalFilterApplied")},a.removeStructureSearch=function(){b.$broadcast("removeStructureSearch")}}]}}]),angular.module("chembiohubAssayApp").directive("searchBreadcrumbs",function(){return{templateUrl:"views/templates/search-breadcrumb-template.html",restrict:"E",transclude:!0,scope:{cbh:"="},controller:["$scope","$rootScope","$filter","skinConfig",function(a,b,c,d){a.$on("searchParamsChanged",function(){a.filter_objects=d.objects[0].filter_objects,a.queryAsfForm=angular.copy(d.objects[0].query_schemaform["default"].form),angular.forEach(a.filter_objects,function(b){a.setfilterAsString(b)}),a.hide_objects=d.objects[0].hide_objects,a.sort_objects=d.objects[0].sort_objects}),a.filterTypeName=function(b){var c="";return angular.forEach(a.queryAsfForm[0].titleMap,function(a){a.value==b.filters.query_type&&(c=a.name)}),c},a.setfilterAsString=function(b){b.filters.greater_than&&b.filters.less_than?b.display_filter="Between "+b.filters.greater_than+" and "+b.filters.less_than:(b.display_filter=a.filterTypeName(b),"pick_from_list"==b.filters.query_type?b.filters[b.filters.query_type].length<4?b.display_filter+=": "+b.filters[b.filters.query_type]:b.display_filter+=": "+b.filters[b.filters.query_type].length+" items selected":b.filters[b.filters.query_type]&&(b.display_filter+=": "+b.filters[b.filters.query_type]))},a.closeSortBreadcrumb=function(a){a.sort_direction="No Sort",b.$broadcast("removeSort",{field_path:a.data})},a.unHideAll=function(){angular.forEach(a.hide_objects,function(a){a.hide="show"}),b.$broadcast("removeAllHides")},a.toggleHide=function(a){"hide"==a.hide?(a.hide="show",b.$broadcast("removeHide",{field_path:a.data})):(a.hide="hide",b.$broadcast("addHide",{field_path:a.data}))},a.closeHideBreadcrumb=function(a){a.hide="show",b.$broadcast("removeHide",{field_path:a.data})},a.closeFilterBreadcrumb=function(a){a.display_filter="",b.$broadcast("cleanupFilters",{col:a,reset_query_type:!0}),b.$broadcast("filtersUpdated",{addNew:!1,field_path:a.data,col:a})},a.removeStructureSearch=function(){b.$broadcast("removeStructureSearch")},a.$on("removeStructureSearch",function(){a.chemicalfilter=void 0}),a.filterClicked=function(a){b.$broadcast("columnSelection",a)},a.chemicalfilter=void 0,a.$on("chemicalFilterApplied",function(){a.chemicalfilter=angular.copy(d.objects[0].chemicalSearch),angular.forEach(a.cbh.tabular_data_schema,function(b){"Structure"==b.knownBy&&(a.structureCol=b)});var b=d.objects[0].chem_query_schemaform["default"].form[0].items[0].titleMap;angular.forEach(b,function(b){b.value==a.chemicalfilter.query_type&&(a.queryName=b.name)})})}]}}),angular.module("chembiohubAssayApp").directive("handsoncompoundtablev2",["$timeout","$compile","renderers","$rootScope","$filter","$modal","$window",function(a,b,c,d,e,f,g){return{template:"<div  ></div>",restrict:"E",transclude:!0,controller:["$scope",function(a){}],link:function(b,d,e){function f(a){var b=document.createElement("a"),c="";return a.noSort?(c=" lightgrey",b.innerHTML="search∙hide"):b.innerHTML="search∙sort∙hide",b.className=" btn btn-default tableFilter",b.style.padding="2px",b}function g(a){var b=document.createElement("span");if(a.mappingOptions&&!a.copyto)b.className="pull-right alert-danger",b.style.marginRight="20px;",b.innerHTML='Unmapped <info-box lookup="unmapped_values_written" lookupitems="cbh.messages" right="true"></info-box>';else if(a.mappingOptions&&a.copyto){var c="<span></span>";1==a.automapped&&(c="<span>(auto)</span>"),b.className="pull-right alert-success",b.style.marginRight="20px;",b.innerHTML='<span class="glyphicon glyphicon-arrow-right"></span>'+a.copyto+c+'<info-box lookup="mapped_values_written" lookupitems="cbh.messages" right="true"></info-box></span>'}return b}function h(c,d,e){d.TH=e,Handsontable.Dom.addEvent(c,"click",function(c){b.cbh.sendToSearch(d),angular.forEach($(e).siblings(),function(b){a(function(){b.style.background="",b.style.color=""})}),e.style.background="linear-gradient(lightcyan, #eee)",e.style.color="#002147",c.preventDefault(),c.stopImmediatePropagation()}),d.showFilters&&a(function(){angular.forEach($(e).siblings(),function(a){a.style.background="",a.style.color=""}),e.style.background="linear-gradient(lightcyan, #eee)",e.style.color="#002147"})}var i,j;i=function(){var e=c.getRenderers(b,k),i=[];angular.forEach(b.cbh.tabular_data_schema,function(a){angular.isDefined(a.renderer_named)&&angular.isDefined(e[a.renderer_named])&&(a.renderer=e[a.renderer_named]),angular.isDefined(a.project_specific_schema)&&angular.forEach(a.project_specific_schema,function(a,b){angular.isDefined(e[a.renderer_named])&&(a.renderer=e[a.renderer_named])}),a.editable&&(b.cbh.editMode||k)?a.readOnly=!1:a.readOnly=!0,"hide"!=a.hide&&("Clone"==a.knownBy&&b.cbh.editMode||i.push(a))}),j=[];var k=!1;angular.isDefined(b.uncuratedHeaders)&&(k=!0,"xlsx"==b.cbh.fileextension&&(j=[{title:"SMILES for chemical structures",type:"chemical"}]));var l=(b.cbh.projects.objects,i.map(function(a){return c.getColumnLabel(a,b)})),m={data:b.compounds,colHeaders:l,columns:i,minCols:i.length,afterGetColHeader:function(a,b){var c=f(i[a]),d=g(i[a]);for(h(c,i[a],b);b.firstChild.lastChild!=b.firstChild.firstChild;)b.firstChild.removeChild(b.firstChild.lastChild);var e=document.createElement("br");b.firstChild.appendChild(e),b.firstChild.appendChild(c),b.firstChild.appendChild(d),b.style["white-space"]="normal"},maxRows:b.compounds.length,renderAllRows:!0,fillHandle:"vertical",height:600};k?m.afterChange=function(a,c){b.cbh.saveChangesToTemporaryDataInController(a,c)}:(m.afterChange=function(a,c){b.cbh.saveChangesToCompoundDataInController(a,c)},m.beforeAutofill=function(a,c,d){for(var e=a.col;e<=c.col;e++)if("uiselecttags"==i[e].field_type)for(var f=a.row;f<=c.end;f++);else if("Archive/Restore"==i[e].knownBy){var g=(b.cbh.projects.objects,a.row),h=(this.getSourceDataAtRow(g),this.getCell(g-1,e)),j=!1,k=h.children[0].children[0];if("btn btn-success"==k.className)var j=!0;for(var f=a.row;f<=c.row;f++){var l=this.getCell(f,e),m=l.children[0],n=this.getSourceDataAtRow(f),o=n.project.split("/");o[o.length-1];j&&"btn btn-danger"==m.children[0].className?(m.innerHTML="<button class='btn btn-success btn-xs'><span class=' glyphicon glyphicon-ok'></span>&nbsp;Restore</button>",n.toArchive=!0,n.properties.archived=!0,m.click()):j||"btn btn-success"!=m.children[0].className||(m.innerHTML="<button class='btn btn-danger btn-xs'><span class='glyphicon glyphicon-remove'></span>&nbsp;Archive</button>",n.toArchive=!1,n.properties.archived=!1,m.click())}}});var n,o=document.createElement("DIV");for(o.className=o.className+" handsontable";d[0].firstChild;)d[0].removeChild(d[0].firstChild);d[0].appendChild(o);var n=new Handsontable(o,m),p=d[0].firstChild.id;b.hotId="#"+p;var q=$(b.hotId);q.wrap("<div id='myid' ></div>"),$(".btn-toggle").dropdown(),b.elem=$("#myid"),b.hot1=n,a(function(){var a=document.querySelector(".hot-loading"),b=angular.element(a);b.removeClass("now-showing")})},b.$watch("redraw",function(a,b){i()},!0),b.$on("updateListView",function(){i()})},scope:{redraw:"=",compounds:"=",cbh:"=",uncuratedHeaders:"=",columns:"=",messages:"=",plugins:"="}}}]),angular.module("chembiohubAssayApp").controller("SinglemolCtrl",["$scope","$rootScope","$modalInstance","$timeout","CBHCompoundBatch","ProjectFactory","$cookies","FlowFileFactory","$filter","$stateParams","urlConfig","$state","$window","projectList",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){console.log("stateParams In Controller",j);var o={};a.mol={};var p,q;$http.get(k.cbh_compound_batches_v2.list_endpoint+"/"+j.uniqId+"/").then(function(b){o=angular.copy(b.data),a.isNewCompoundsInterface=!1,a.mol=angular.copy(o);var e=o.projectfull.id;a.projectWithCustomFieldData,angular.forEach(n.objects,function(b){b.id==e&&(a.projectWithCustomFieldData=b,a.projectObj=b)}),a.singleForm=!1;var f=!1;if(f&&angular.forEach(a.projectWithCustomFieldData.schemaform.form,function(b){b.key===f.split(".")[1]&&(a.singleForm=[angular.copy(b)])}),p=a.projectWithCustomFieldData.schemaform.form,q=Math.ceil(p.length/2),j.edit){var g=j.edit.substring(14,j.edit.length);angular.forEach(p,function(b){b.key==g&&(a.firstForm=[angular.copy(b)],a.secondForm=[],a.myform2=angular.copy(a.firstForm),a.init(),a.myschema=angular.copy(a.projectWithCustomFieldData.schemaform.schema),a.modalInstance=c)}),a.editMode=!0}else a.editMode=!1,a.firstForm=angular.copy(p).splice(0,q),a.secondForm=angular.copy(p).splice(q),a.myform2=angular.copy(p),a.init(),a.myschema=angular.copy(a.projectWithCustomFieldData.schemaform.schema),a.modalInstance=c;d(function(){a.$apply()})}),a.success=function(b,c){console.log("success being called");var d=h.cbhChemFlowFile;d.get({identifier:b.uniqueIdentifier},function(d){var e=d.download_uri,f={url:e,printName:b.name,mimeType:b.file.type};a.mol.custom_fields[c[0]].attachments.push(f)})},a.removeFile=function(b,c,d){a.mol.custom_fields[b[0]].attachments=i("filter")(a.mol.custom_fields[b[0]].attachments,function(a,b){return a.url!==d})},a.sizeCheck=function(a,b){return console.log("file size",a.size),a.size>2e7?(a.flowObj.removeFile(a),alert("This system has a file size limit of 20Mb per file. Please try with a smaller file."),!1):void 0},a.openClone=function(){a.mol.projectfull.project_type.show_compounds?(console.log("newcompounds"),l.go("cbh.projects.project.addsingle",{projectKey:a.mol.projectfull.project_key,idToClone:a.mol.id},{reload:!0})):(b.$broadcast("cloneAnItem",o),c.dismiss("cancel"))},a.enterEditMode=function(b){1==b?a.editMode=!0:a.editMode=!1,a.mol=angular.copy(o),a.$apply()},a.init=function(){a.keyValues=a.myform2.map(function(b){var c=b;angular.isDefined(b.key)&&(c=b.key);var d="";angular.isDefined(a.mol.custom_fields[c])&&(d=a.mol.custom_fields[c]),d.constructor===Array&&(d=d.join(", "));var e=!1,f=[];return b["default"]&&(e=!0,f=b["default"].attachments),{key:c,value:d,isFileField:e,attachments:f}}),a.firstList=a.keyValues.splice(0,q),a.secondList=a.keyValues,a.$broadcast("schemaFormRedraw")},a.removeAlert=function(){a.update_success=!1},a.isUpdated=!1,a.closeInstance=!1,a.updateBatch=function(){e.patch(a.mol).then(function(c){a.update_success=!0,a.editMode=!1,a.init(),d(a.removeAlert,5e3),a.isUpdated=!0,1==a.closeInstance&&(a.modalInstance.dismiss("cancel"),b.$broadcast("filtersUpdated",{}))})},a.cancel=function(){a.mol={},a.$broadcast("schemaFormRedraw"),a.modalInstance.dismiss("cancel"),a.isUpdated?b.$broadcast("filtersUpdated",{}):console.log("not updated")},a.errormess="",a.validateFormData=function(b){console.log("doValidation being called",b),a.errormess="",a.$broadcast("schemaFormValidate"),b.$valid&&!b.$pristine?a.updateBatch():b.$pristine?a.errormess="You must add some data before you can submit your form.":a.errormess="You have required fields missing or incorrect data - please correct these and try again."}}]),angular.module("chembiohubAssayApp").filter("encodeParamForSearch",function(){return function(a){var b=[{pick_from_list:[a.value],field_path:a.field_path,query_type:"pick_from_list"}];return btoa(JSON.stringify(b))}}),angular.module("chembiohubAssayApp").filter("htmlToPlaintext",function(){return function(a){return a?String(a).replace(/<[^>]+>/gm,""):""}}),angular.module("chembiohubAssayApp").factory("chemicalSearch",["$resource","urlConfig",function(a,b){return a(b.cbh_chemical_search.list_endpoint+"/:id",{id:"@id"})}]),angular.module("chembiohubAssayApp").run(["$templateCache",function(a){"use strict";a.put("index.html",'<!DOCTYPE html><html lang=en><head><script></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=""><meta name=author content=""><link rel=icon href=/favicon.ico type=image/x-icon><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=alternate type=application/rss+xml title="{{ site.name }}" href=/feed.xml><title>ChemBio Hub Platform</title><link rel=stylesheet href="bower_components/angular-grid/ng-grid.css"><link rel=stylesheet href="bower_components/bootstrap-vertical-tabs/bootstrap.vertical-tabs.css"><link rel=stylesheet href="bower_components/pickadate/lib/themes/default.css"><link rel=stylesheet href="bower_components/pickadate/lib/themes/default.date.css"><link rel=stylesheet href="bower_components/pickadate/lib/themes/default.time.css"><link rel=stylesheet href="bower_components/angular-ui-select/dist/select.css"><link rel=stylesheet href="bower_components/pikaday/css/pikaday.css"><link rel=stylesheet href="bower_components/handsontable/dist/handsontable.css"><link rel=stylesheet href="bower_components/bootstrap/dist/css/bootstrap.css"><link rel=stylesheet href="bower_components/chembiohub-theme/css/main.css"><link rel=stylesheet href=bower_components/chembiohub-theme/css/cbh-template-header.css><link rel=stylesheet href=bower_components/chembiohub-theme/css/font.css><link rel=stylesheet href=styles/chemireg-specific.css><link rel=stylesheet href=https://hub.chemdoodle.com/cwc/6.0.0//ChemDoodleWeb.css><link rel=stylesheet href=https://hub.chemdoodle.com/cwc/6.0.0/uis/jquery-ui-1.10.3.custom.css><link href=bower_components/angular-xeditable/dist/css/xeditable.css rel=stylesheet><script src=https://hub.chemdoodle.com/cwc/6.0.0/ChemDoodleWeb.js></script><script src=https://hub.chemdoodle.com/cwc/6.0.0/uis/ChemDoodleWeb-uis.js></script></head><body id=bodytest><div id=show-everything-here ui-view><div style=height:3rem></div><img style="display: block; margin-left:auto; margin-right:auto" src=images/loader.957018df.gif></div><script>(function(i,s,o,g,r,a,m){i[\'GoogleAnalyticsObject\']=r;i[r]=i[r]||function(){\n       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n'+"       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n\n       ga('create', 'UA-XXXXX-X');\n       ga('send', 'pageview');</script><script src=bower_components/raven-js/dist/raven.js></script><script>Raven.config('http://fc809c4af52d4022abea608aa81f3136@163.1.63.22/3', {\n      logger: 'javascript',\n      whitelistUrls: [\n        \"chembiohub\\.ox\\.ac\\.uk\"\n     ]\n    }).install();</script><script src=bower_components/jquery/dist/jquery.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/affix.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/alert.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/button.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/carousel.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/collapse.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/dropdown.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/tab.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/transition.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/scrollspy.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/modal.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/tooltip.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/popover.js></script><script src=bower_components/underscore/underscore-min.js></script><script src=bower_components/es5-shim/es5-shim.js></script><script src=bower_components/angular/angular.js></script><script src=bower_components/dndLists/index.js></script><script src=bower_components/angular-schema-form-ui-select/angular-underscore.js></script><script src=bower_components/json3/lib/json3.js></script><script src=bower_components/bootstrap-sass-official/assets/javascripts/bootstrap.js></script><script src=bower_components/angular-animate/angular-animate.js></script><script src=bower_components/angular-aria/angular-aria.js></script><script src=bower_components/angular-cookies/angular-cookies.js></script><script src=bower_components/angular-messages/angular-messages.js></script><script src=bower_components/angular-resource/angular-resource.js></script><script src=bower_components/angular-route/angular-route.js></script><script src=bower_components/angular-sanitize/angular-sanitize.js></script><script src=bower_components/angular-touch/angular-touch.js></script><script src=bower_components/jquery-ui/jquery-ui.js></script><script src=bower_components/d3/d3.js></script><script src=bower_components/angular-bootstrap/ui-bootstrap-tpls.js></script><script src=bower_components/FileSaver/FileSaver.js></script><script src=bower_components/bootstrap/dist/js/bootstrap.js></script><script src=bower_components/angular-bootstrap-checkbox/angular-bootstrap-checkbox.js></script><script src=bower_components/ngScrollTo/ng-scrollto.js></script><script src=bower_components/angular-ui-router/release/angular-ui-router.js></script><script src=bower_components/angular-grid/build/ng-grid.js></script><script src=bower_components/ng-flow/dist/ng-flow.js></script><script src=bower_components/zeroclipboard/dist/ZeroClipboard.js></script><script src=bower_components/angular-translate/angular-translate.js></script><script src=bower_components/ng-clip/src/ngClip.js></script><script src=bower_components/zeroclipboard/dist/ZeroClipboard.min.js></script><script src=bower_components/angular-ui-select/dist/select.js></script><script type=text/javascript src=bower_components/ace-builds/src-min-noconflict/ace.js></script><script src=bower_components/tv4/tv4.js></script><script src=bower_components/objectpath/lib/ObjectPath.js></script><script src=bower_components/angular-schema-form/dist/schema-form.js></script><script src=bower_components/angular-schema-form-ui-select/ui-sortable.js></script><script src=bower_components/schema-form-file-upload/schema-form-file-upload.min.js></script><script src=bower_components/doubleScroll/index.js></script><script src=//cdn.ckeditor.com/4.5.6/standard/ckeditor.js></script><script src=bower_components/underscore/underscore.js></script><script src=bower_components/angular-schema-form/dist/bootstrap-decorator.js></script><script src=bower_components/pickadate/lib/picker.js></script><script src=bower_components/pickadate/lib/picker.date.js></script><script src=bower_components/pickadate/lib/picker.time.js></script><script src=bower_components/angular-schema-form-datepicker/bootstrap-datepicker.min.js></script><script src=bower_components/angular-schema-form-ui-select/bootstrap-ui-select.min.js></script><script src=bower_components/moment/moment.js></script><script src=bower_components/pikaday/pikaday.js></script><script src=bower_components/handsontable/dist/handsontable.js></script><script src=bower_components/angular-ui-ace/ui-ace.js></script><script src=bower_components/elastic.js/dist/elastic.js></script><script src=bower_components/elasticui/dist/elasticui.min.js></script><script src=bower_components/chemdoodle-angular/chemdoodle_angular.js></script><script src=bower_components/gifffer/build/gifffer.min.js></script><script src=bower_components/angular-strap/dist/angular-strap.js></script><script src=bower_components/angular-strap/dist/angular-strap.tpl.js></script><script src=bower_components/angular-utils-pagination/dirPagination.js></script><script src=bower_components/flow.js/dist/flow.js></script><script src=bower_components/ng-flow/dist/ng-flow-standalone.min.js></script><script src=bower_components/angular-info-box/infobox.js></script><script src=bower_components/angular-schema-form-ckeditor/bootstrap-ckeditor.min.js></script><script src=bower_components/angular-raven/angular-raven.js></script><script src=bower_components/angular-xeditable/dist/js/xeditable.js></script><script src=scripts/cbh_angular_schema_form_extension.js></script><script src=scripts/init.js></script><script src=scripts/config.js></script><script src=scripts/app.js></script><script src=scripts/controllers/about.js></script><script src=scripts/utils.js></script><script src=scripts/services/chembl.js></script><script src=scripts/services/chemfilevalidation.js></script><script src=scripts/directives/chemsvg.js></script><script src=scripts/directives/processstep.js></script><script src=scripts/filters/titlecase.js></script><script src=scripts/directives/appprogress.js></script><script src=scripts/services/loginservice.js></script><script src=scripts/filters/notempty.js></script><script src=scripts/filters/totrusted.js></script><script src=scripts/filters/removeSpaces.js></script><script src=scripts/services/httpproject.js></script><script src=scripts/directives/projectlist.js></script><script src=scripts/services/projectfactory.js></script><script src=scripts/controllers/project.js></script><script src=scripts/services/messagefactory.js></script><script src=scripts/services/cbhcompoundbatch.js></script><script src=scripts/controllers/batches.js></script><script src=scripts/services/compoundlistsetup.js></script><script src=scripts/controllers/search.js></script><script src=scripts/directives/buttoninput.js></script><script src=scripts/services/userfactory.js></script><script src=scripts/services/searchurlparams.js></script><script src=scripts/services/searchurlparamsv2.js></script><script src=scripts/controllers/compoundbatch.js></script><script src=scripts/directives/handsoncompoundtable.js></script><script src=scripts/directives/diableanimation.js></script><script src=scripts/controllers/addcompounds.js></script><script src=scripts/services/renderers.js></script><script src=scripts/directives/dynamic.js></script><script src=scripts/directives/compoundtableheader.js></script><script src=scripts/services/skinning.js></script><script src=scripts/services/adddata.js></script><script src=scripts/controllers/adddata.js></script><script src=scripts/controllers/editdata.js></script><script src=scripts/controllers/viewdata.js></script><script src=scripts/services/viewdatafactory.js></script><script src=scripts/controllers/dataoverview.js></script><script src=scripts/controllers/searchassays.js></script><script src=scripts/services/flowfilefactory.js></script><script src=scripts/services/customfieldconfig.js></script><script src=scripts/services/invitationfactory.js></script><script src=scripts/controllers/addsinglecompound.js></script><script src=scripts/services/projecttypefactory.js></script><script src=scripts/services/draft.js></script><script src=scripts/controllers/projectlist.js></script><script src=scripts/controllers/cbh.js></script><script src=scripts/controllers/projectfields.js></script><script src=scripts/controllers/projectpermissions.js></script><script src=scripts/services/projectpermissions.js></script><script src=scripts/services/projectpermissionallroles.js></script><script src=scripts/services/savedsearchfactory.js></script><script src=scripts/controllers/platemap.js></script><script src=scripts/services/platemapfactory.js></script><script src=scripts/directives/platemap.js></script><script src=scripts/controllers/searchv2.js></script><script src=scripts/controllers/compoundbatchv2.js></script><script src=scripts/directives/searchfilter.js></script><script src=scripts/directives/searchbreadcrumbs.js></script><script src=scripts/directives/handsoncompoundtablev2.js></script><script src=scripts/controllers/singlemol.js></script><script src=scripts/filters/encodeparamforsearch.js></script><script src=scripts/filters/htmltoplaintext.js></script><script src=scripts/services/chemicalsearch.js></script></body></html>"),
a.put("views/templates/base.html",'<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=""><meta name=author content=""><link rel=icon href=/favicon.ico type=image/x-icon><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><title>ChemBioHub</title><link href=css/bootstrap.min.css rel=stylesheet><link href=css/main.css rel=stylesheet><link href=css/font.css rel=stylesheet><link href=templates/sass/cbh-template-header.css rel=stylesheet><link href="http://fonts.googleapis.com/css?family=Lato:300,400,900" rel=stylesheet><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>\n      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--></head><body><div class=container></div><script src=https://code.jquery.com/jquery-1.10.2.min.js></script><script type=text/javascript src=vendorjs/FeedEk.js></script><script src=http://chembiohub.ox.ac.uk/static/js/bootstrap.min.js></script><script>/*(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=\n            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;\n            e=o.createElement(i);r=o.getElementsByTagName(i)[0];\n            e.src=\'//www.google-analytics.com/analytics.js\';\n'+"            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));\nga('create','UA-55063522-1');ga('send','pageview');*/</script><script>$('a[href*=#]:not([href=#])').click(function() {\n    if (location.pathname.replace(/^\\//,'') == this.pathname.replace(/^\\//,'') \n        || location.hostname == this.hostname) {\n\n        var target = $(this.hash);\n        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');\n           if (target.length) {\n             $('html,body').animate({\n                 scrollTop: target.offset().top\n            }, 1000);\n            return false;\n        }\n    }\n});\n\n$('#blog-widget').FeedEk({\n    FeedUrl : 'https://chembiohub.ox.ac.uk/blog/feed.xml',\n  MaxCount : 3,\n    ShowDesc : true,\n    ShowPubDate:true,\n    DescCharacterLimit:300,\n    TitleLinkTarget:'_blank'\n  });\n\n$('#forum-widget').FeedEk({\n    FeedUrl : 'http://chembiohub.ox.ac.uk/askbot/feeds/rss/',\n  MaxCount : 5,\n    ShowDesc : true,\n    ShowPubDate:true,\n    DescCharacterLimit:100,\n    TitleLinkTarget:'_blank'\n  });</script><script type=text/javascript src=vendorjs/jquery.githubRepoWidget.min.js></script></body></html>"),a.put("views/templates/chemdoodle-form-template.html","<div class=col-lg-12><chemdoodlewrapper molfile=$$value$$ elementid=\"'chemdoodle'\"><canvas id=chemdoodle></canvas></chemdoodlewrapper></div>"),a.put("views/templates/chemsvg.html",'<img ng-if=src style=width:80% ng-show=src ng-src=data:image/png;base64,{{src}}><img ng-if="!src && properties.imageSrc" style=width:80% ng-src={{properties.imageSrc}}><a href=# ng-if="cdxml && src" clip-copy=cdxml clip-click=e.preventDefault() role=button class="btn btn-xs btn-primary pull-right">Copy CDXML</a>'),a.put("views/templates/compound-grid.html","<div class=row><div id=grid1 ng-grid=gridconfig.configObject.gridOptions class=myGrid></div></div>"),a.put("views/templates/compound-list.html",'<div class=row><div class=col-xs-12><h2 class="blue pull-left"><span class="glyphicon glyphicon-th-list"></span> Compound List</h2><info-box lookup=image_more_details lookupitems=cbh.messages></info-box><h2><div class="dropdown pull-right"><a role=button class="btn btn-default" ng-click=openHeadersLegend()><span class="glyphicon glyphicon-question-sign"></span> What do the headings mean?</a> <button id=downloadBtnCmpd class="btn btn-primary btn-toggle" type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="glyphicon glyphicon-download"></span> <span class="hidden-xs hidden-sm">Download</span> <span class=caret></span></button><ul class=dropdown-menu role=menu aria-labelledby=downloadBtnCmpd><li><a ng-href="{{  urlConfig.cbh_compound_batches.list_endpoint }}/?projectKey={{projectKey}}&project__project_key={{projectKey}}&{{ gridconfig.configObject.paramsUrl }}format=xls&limit=10000">Export all to Excel</a></li><li><a ng-href="{{  urlConfig.cbh_compound_batches.list_endpoint }}/?projectKey={{projectKey}}&project__project_key={{projectKey}}&{{ gridconfig.configObject.paramsUrl }}format=sdf&limit=10000">Export all to SD</a></li></ul></div></h2></div></div><div class=spacer></div><div ng-include="\'views/templates/paginator_template.html\'"></div><div class=spacer></div><script>$(\'.btn-toggle\').dropdown()</script>'),a.put("views/templates/compound-table-filter.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class="modal-title blue">{{col.knownBy}} - filters and sorts</h3></div><div class=modal-body><div class=row><div class=col-sm-4 ng-if=!col.noSort><div aria-hidden=false><ul class="list-unstyled pull-left" role=menu><li class=text-center><strong class=nexa>Sort column:</strong></li><li class=divider><hr></li><li><a class=relative ng-click="cbh.addSort(col.data, \'asc\'); cancel();"><strong class=nexa><span class="glyphicon glyphicon-sort-by-alphabet"></span> &nbsp;A-Z <span class=glyphicon ng-class="(col.sortOrder==\'asc\') ? \'glyphicon-check\':\'glyphicon-unchecked\'"></span></strong></a></li><li><a class=relative ng-click="cbh.addSort(col.data, \'desc\'); cancel();"><strong class=nexa><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span> &nbsp;Z-A <span class=glyphicon ng-class="(col.sortOrder==\'desc\') ? \'glyphicon-check\':\'glyphicon-unchecked\'"></span></strong></a></li></ul></div></div><div class=col-sm-8 ng-if="(col.mappingOptions.length > 0)"><div class=pull-left aria-hidden=false><ul class=list-unstyled role=menu aria-labelledby=userBtn><li class=text-center><strong class=nexa>Map column to:</strong></li><li class=divider><hr></li><li ng-repeat="opt in col.mappingOptions"><a class=relative ng-if=opt.uiClass ng-click="$event.stopPropagation(); cbh.toggleMappedFieldInDirective($index,col.knownBy);cancel();"><strong class=nexa><span ng-bind-html=opt.icon></span> &nbsp;{{opt.title}}</strong> <span ng-if=opt.uiClass class="glyphicon pull-right" ng-class=opt.uiClass></span></a> <a disabled ng-if=!opt.uiClass title={{opt.displayError}} ng-click=$event.stopPropagation();><strong class="nexa lightgrey"><span ng-bind-html=opt.icon></span> &nbsp;{{opt.title}}</strong></a></li></ul></div></div></div></div><div class=modal-footer><button class="btn btn-danger" type=button ng-click=cancel()>Close</button></div>'),a.put("views/templates/custom_fields.html",'<div class="col-xs-12 col-md-6"><div class=form-group sf-schema=::myschema sf-form=::firstForm sf-model=molecule.metadata.projectFields></div></div><div class="col-xs-12 col-md-6"><div class=form-group sf-schema=::myschema sf-form=::secondForm sf-model=molecule.metadata.projectFields></div></div>'),a.put("views/templates/download-buttons.html",'<info-box lookup=project_data_field_download lookupitems=cbh.messages left=true></info-box><button id=downloadBtnProj class="btn btn-primary btn-toggle" type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="glyphicon glyphicon-download"></span> <span class="hidden-xs hidden-sm">Export</span> <span class=caret></span></button><ul class=dropdown-menu role=menu aria-labelledby=downloadBtnProj><li><a ng-href="{{cbh.baseDownloadUrl}}&format=xlsx">Export all to Excel</a></li><li><a ng-href="{{cbh.baseDownloadUrl}}&format=sdf">Export all to SD</a></li></ul>'),a.put("views/templates/download-results.html",'<a href="{{indexVM.results.resource_uri}}/?from=0&size=10000&format=xlsx" role=button class="btn btn-primary" aria-description="Download these results in Excel format" title="Download these results in Excel format"><span class="glyphicon glyphicon-download-alt"></span><span class="hidden-xs hidden-sm">Download</span></a>'),a.put("views/templates/files-uploaded-view.html","<div class=row style=margin-top:15px><ul class=list-inline><li ng-repeat=\"attachment in uploads\" style=display:inline-table><div class=\"text-center col-xs-12 thumb-container\"><img ng-if=\"attachment.mimeType.indexOf('image') != -1\" width=100 ng-src=\"{{attachment.url}}\"> <img ng-if=\"attachment.mimeType.indexOf('spreadsheetml') != -1 || attachment.mimeType.indexOf('excel') != -1\" width=100 ng-src=\"images/xlsx-placeholder.8cc1d17c.png\"> <img ng-if=\"attachment.mimeType.indexOf('wordprocessingml') != -1 || attachment.mimeType.indexOf('msword') != -1\" width=100 ng-src=\"images/docx-placeholder.61f1fc6c.png\"> <img ng-if=\"attachment.mimeType.indexOf('pdf') != -1\" width=100 ng-src=\"images/pdf-placeholder.f797271a.png\"> <img ng-if=\"attachment.mimeType.indexOf('pdf') == -1 && attachment.mimeType.indexOf('image') == -1 && attachment.mimeType.indexOf('spreadsheetml') == -1 && attachment.mimeType.indexOf('excel') == -1 && attachment.mimeType.indexOf('wordprocessingml') == -1 && attachment.mimeType.indexOf('msword') == -1\" width=100 ng-src=\"images/file-placeholder.bcb75331.png\"><div class=thumb-overlay><p><a ng-if=\"upload.mimeType.indexOf('image') == -1\" href={{upload.url}}><small>download</small></a></p></div></div></li></ul></div>"),a.put("views/templates/filtered-dropdown-form-template.html",'<div ng-controller=filtereddropdownController class="form-group schema-form-{{form.type}} {{form.htmlClass}}" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false }"><label class="control-label {{form.labelHtmlClass}}" ng-class="{\'sr-only\': !showTitle()}" for={{form.key.slice(-1)[0]}}>{{form.title}}</label><div class=dropdown><button ng-click="opened(form.key, \'\')" type=button data-toggle=dropdown class="btn btn-default btn-lg"><span ng-if="!model[form.key[form.key.length -1]] || model[form.key[form.key.length -1]].length == 0">Please select</span> <span ng-show="form.options.multiple && (model[form.key[form.key.length -1]].length < 4 && model[form.key[form.key.length -1]].length > 0)">{{model[form.key[form.key.length -1]].length}} item<span ng-show="model[form.key[form.key.length -1]].length !=1">s</span> selected... <span ng-repeat="item in model[form.key[form.key.length -1]] track by $index">{{item}}<span ng-if="$index!=2 && model[form.key[form.key.length -1]].length !=1">,</span></span></span> <span ng-show="form.options.multiple && model[form.key[form.key.length -1]].length > 3">{{model[form.key[form.key.length -1]].length}} items selected</span> <span ng-show="!form.options.multiple && model[form.key[form.key.length -1]].length > 0">{{model[form.key[form.key.length -1]]}}</span> <span class=caret></span></button> <input type=hidden name=someData schema-validate=form value="{{model[form.key[form.key.length -1]]}}" ng-model="model[form.key[form.key.length -1]]"><ul class=dropdown-menu style=min-width:300px;max-width:300px style="padding-top:5px; padding-bottom:5px; border-bottom:0"><li ng-show="items.length == 0 && loading == true" class="col-xs-12 pick-list-item">Loading...</li><li ng-show="numberItemsMissing==0" class="col-xs-12 pick-list-item">Click on an item to select</li><li class=col-xs-12 ng-if="numberItemsMissing > 1">Not all items shown - search</li><li><div class=col-xs-12><input placeholder="{{form.options.tagging ? \'Find a tag or create one\' : \'Find a tag\'}}" ng-model=autoComp></div></li></ul><ul class=dropdown-menu style="margin-top:55px;min-width:300px;max-width:300px; max-height:300px; overflow-y:auto;  border-top:0"><li ng-show="items.length == 0 && !form.options.tagging" class=col-xs-12>No items found</li><li ng-if="form.options.tagging && autoCompNotInList" ng-class="model[form.key[0]].indexOf(item.key) > -1 ? \'active\' : \'\'"><a ng-click="toggleItem(autoCompNotInList, true); $event.stopPropagation();"><span ng-if=form.options.multiple class=glyphicon ng-class="model[form.key[0]].indexOf(autoCompNotInList.key) > -1 ? \'glyphicon-check\' : \'glyphicon-unchecked\'"></span> <span>{{autoCompNotInList.key}} (create new)</span></a></li><li ng-if=form.options.tagging ng-class="checkItem(item.key, model[form.key[0]]) > -1 ? \'active\' : \'\'" ng-repeat="item in newTagsObjects"><a ng-click="toggleItem(item, true); $event.stopPropagation();"><span ng-if=form.options.multiple class=glyphicon ng-class="checkItem(item.key, model[form.key[0]]) > -1 ? \'glyphicon-check\' : \'glyphicon-unchecked\'"></span> <span>{{item.key}} (new)</span></a></li><li ng-class="checkItem(item.key, model[form.key[0]]) > -1 ? \'active\' : \'\'" ng-repeat="item in items"><a ng-click="toggleItem(item); $event.stopPropagation();"><span ng-if=form.options.multiple class=glyphicon ng-class="checkItem(item.key, model[form.key[0]]) > -1 ? \'glyphicon-check\' : \'glyphicon-unchecked\'"></span> <span>{{item.key}} ({{item.doc_count}})</span></a></li></ul></div><span ng-if="form.feedback !== false" class=form-control-feedback ng-class="evalInScope(form.feedback) || {\'glyphicon\': true, \'glyphicon-ok\': form.disableSuccessState !== true && hasSuccess(), \'glyphicon-remove\': form.disableErrorState !== true && hasError() }" aria-hidden=true></span> <span ng-if="hasError() || hasSuccess()" id="{{form.key.slice(-1)[0] + \'Status\'}}" class=sr-only>{{ hasSuccess() ? \'(success)\' : \'(error)\' }}</span><div class=help-block sf-message=form.description></div></div>'),a.put("views/templates/footer.html",'<div id=footer class=footer><div class=container><div class=row><a id=contact></a><div class="col-md-4 col-sm-6 col-xs-12" id=postal-address><div class=row><div class=col-xs-1><span class="glyphicon glyphicon-home"></span></div><div class=col-xs-10><span>ChemBio Hub Project<br>Old Road Campus Research Building<br>Roosevelt Drive<br>Oxford<br>OX3 7DQ<br>UK<br></span></div></div><div class=row><div class=col-xs-1><span class="glyphicon glyphicon-earphone"></span></div><div class=col-xs-10><span>01865 617577</span></div></div></div><div class="col-md-3 col-sm-6 col-xs-12"><div class=row><a href=http://twitter.com/oxchembiohub onclick="return !window.open(this.href)"><img src=/assets/img/social-icons/twitter.png class=social-icon alt="twitter logo" title="twitter logo"> Follow @OxChemBioHub</a><br><a href=mailto:info@chembiohub.ox.ac.uk><img src=/assets/img/social-icons/mail-icon.png class=social-icon alt="email logo" title="email logo"> Email ChemBio Hub</a><br><a href=http://plus.google.com/106725711668905271458 onclick="return !window.open(this.href)"><img src=/assets/img/social-icons/google+.png class=social-icon alt="google+ logo" title="google+ logo">Follow +OxChemBioHub</a></div></div><button class="btn pull-right scrollToTop btn-lg">Back to top <span class="glyphicon glyphicon-upload"></span></button></div><div class="row center"><div class="hidden-xs funding"><div class=row>We gratefully acknowledge the support of the following organisations:</div><div class=row><img src=/assets/img/funders/ndm.png title="Nuffield Department of Medicine Medical Sciences Division" alt="Nuffield Department of Medicine Medical Sciences Division"> <img src=/assets/img/funders/welcome.png title="Supported by Wellcome Trust" alt="Supported by Wellcome Trust"> <img src=/assets/img/funders/hefce.png title="Higher Education Funding Council For England" alt="Higher Education Funding Council For England"> <img src=/assets/img/funders/johnfell.png title="John Fell Fund" alt="John Fell Fund"></div></div><div onclick="window.location=\'/about#funding\'" class=visible-xs>Thank you to our funding partners</div></div><div class="row center copyright">Copyright University of Oxford 2014</div></div></div><script type=text/javascript src=/assets/js/bootstrap.min.js></script><script type=text/javascript src=/assets/js/vendorjs/bootstrapValidator.min.js></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=\n            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;\n            e=o.createElement(i);r=o.getElementsByTagName(i)[0];\n            e.src=\'//www.google-analytics.com/analytics.js\';\n            r.parentNode.insertBefore(e,r)}(window,document,\'script\',\'ga\'));\nga(\'create\',\'UA-55063522-1\');ga(\'send\',\'pageview\');\n\n\n/* Track outbound links in Google Analytics */\n(function($) {\n \n  "use strict";\n \n  // current page host\n  var baseURI = window.location.host;\n \n  // click event on body\n  $("body").on("click", function(e) {\n \n    // abandon if link already aborted or analytics is not available\n    if (e.isDefaultPrevented() || typeof ga !== "function") return;\n \n    // abandon if no active link or link within domain\n    var link = $(e.target).closest("a");\n    if (link.length != 1 || baseURI == link[0].host) return;\n\n    // cancel event and record outbound link\n    e.preventDefault();\n    var href = link[0].href;\n    ga(\'send\', {\n'+"      'hitType': 'event',\n      'eventCategory': 'outbound',\n      'eventAction': 'link',\n      'eventLabel': href,\n      'hitCallback': loadPage\n    });\n \n    // redirect after one second if recording takes too long\n    setTimeout(loadPage, 1000);\n \n    // redirect to outbound page\n    function loadPage() {\n      document.location = href;\n    }\n \n  });\n \n})(jQuery); \n\n$(document).ready(function() {\n    $('.scrollToTop').click(function(){\n        $('html, body').animate({scrollTop : 0},800);\n        return false;\n    });\n});</script><script type=text/javascript src=/assets/js/vendorjs/jquery.contenthover.min.js></script>"),a.put("views/templates/header.html",'<nav class="navbar navbar-default" role=navigation style="border-bottom:10px solid #72777f; padding-top:0"><div class=container style="display: flex; justify-content: flex-end"><div class=row style="justify-content: inherit;width: 100%;display: flex; align-items:stretch; line-height:1"><div class=col id=slogan class=text-right eui-index="\'cbh_queries\'" eui-enabled=true><ul class="list-inline pull-right text-center"><li class="text-center clickable" style="color:white; margin-right:10px" ng-class="cbh.currentPageClass(\'cbh.projects.list\')"><a ui-sref=cbh.projects.list style=color:white><img src=images/header-projects.849e120c.png><br><strong class=nexa><small>projects</small></strong></a></li><li ng-if=cbh.logged_in_user.can_view_chemreg class="text-center clickable" style=color:white ng-class="cbh.currentPageClass(\'cbh.searchv2\')"><a ui-sref=cbh.searchv2 style=color:white><img src=images/search-compounds.fe12797f.png><br><strong class=nexa><small>search</small></strong></a></li><li class="text-center clickable" style=color:white ng-class="cbh.currentPageClass(\'cbh.help\')"><a ui-sref=cbh.help style=color:white><img src=images/header-help.3624e686.png><br><strong class=nexa><small>help</small></strong></a></li></ul></div><div class=col><a id=projectsBtn class=mt-8 data-toggle=dropdown aria-haspopup=true aria-expanded=false><div class=dropdown ng-show=isLoggedIn() style="background-color:rgb(68,104,125); padding:16px"><strong class="text-center nexa" style="padding-top:5px; color:white"><img src=https://chembiohub.ox.ac.uk/hub/bower_components/chembiohub-theme/img/CBH_2_2_LowRes.png style=height:45px>{{cbh.appName}}</strong>&nbsp;<span class=caret style=color:white></span><ul class="dropdown-menu ng-animate" role=menu aria-labelledby=projectsBtn style=width:210px><li role=presentation style="background-color:#ddd; padding:0 8px"><span class="glyphicon glyphicon-user"></span> <strong class=nexa><span>{{cbh.logged_in_user.first_name || cbh.logged_in_user.username}}</span></strong></li><li role=presentation ng-if=cbh.logged_in_user.is_superuser style="padding: 0 8px"><a ng-href={{cbh.api_base}}/admin><span class="glyphicon glyphicon-cog"></span> <strong class=nexa>Admin Panel</strong></a></li><li role=presentation style="padding: 0 8px"><a ng-click=cbh.invitationPopup()><span class="glyphicon glyphicon-comment"></span> <strong class=nexa>Send an Invitation</strong></a></li><li role=presentation style="padding:0 8px"><a href=http://goo.gl/forms/y6e4achfUE onclick="return !window.open(this.href)"><span class="glyphicon glyphicon-exclamation-sign"></span> <strong class=nexa>Report an issue</strong></a></li><li role=presentation style="padding:0 8px"><a href="{{ getUrlBase() }}logout"><span class="glyphicon glyphicon-off"></span> <strong class=nexa>Log Out</strong></a></li></ul></div></a></div></div></div></nav><script>$(\'.btn-toggle\').dropdown()</script>'),a.put("views/templates/map-file-buttons.html",'<div class=row><div class=pull-right><a role=button class="btn btn-danger" ng-click=startAgain($flow.files) ui-sref=cbh.projects.project.demo.intro>Cancel</a> <a ng-disabled="(dragmodels.lists.headers.length + dropmodels.lists.length) == 0" ng-click=resetMappingForm()><button ng-disabled="(dragmodels.lists.headers.length + dropmodels.lists.length) == 0" class="btn btn-primary" style=margin-right:5px>Reset drag and drop area</button></a> <a ng-disabled="(dragmodels.lists.headers.length + dropmodels.lists.length) == 0"><button ng-disabled="(dragmodels.lists.headers.length + dropmodels.lists.length) == 0" class="btn btn-primary" ng-disabled=justSaved ng-click=mapCustomFieldsToMols(true) ng-show=isFileExcel() ng-disabled="(isStrucColUnspecified()  + (dragmodels.lists.headers.length + dropmodels.lists.length) == 0 )|| justSaved">Save all Molecules to AssayReg</button> <button ng-disabled="(dragmodels.lists.headers.length + dropmodels.lists.length) == 0" class="btn btn-primary" ng-disabled=justSaved ng-click=mapCustomFieldsToMols(true) ng-hide=isFileExcel() ng-disabled="(dragmodels.lists.headers.length + dropmodels.lists.length) == 0 || justSaved">Save all Molecules to AssayReg</button></a></div></div><div class="row spacer"></div>'),a.put("views/templates/map-file-modal.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class="modal-title blue">Map {{dataoverviewctrl.col_being_mapped.elasticsearch_fieldname | removeSpaces }} to column:</h3></div><div class=modal-body><div class=row><div class=col-xs-12><div aria-hidden=false><select id=field-selector ng-options="field.name for field in modded_project_fields" ng-model=mapping ng-required=dataoverviewctrl.col_being_mapped.required class=form-control ng-change=someMappingFunction(); style=width:100% ng-class="\'text-success\'"></select><a ng-show=dataoverviewctrl.col_being_mapped.attachment_field_mapped_to ng-click=clearMapping(dataoverviewctrl.col_being_mapped.required) class=pull-right>Unmap this field</a><br><a ng-show="dataoverviewctrl.col_being_mapped.unmappable_rows.length > 0" ng-click=clearMapping(dataoverviewctrl.col_being_mapped.required) class=pull-right>Ignore this field for now</a><br><div class=pull-right>Why is this list limited?<info-box freetext="The dropdown list shows fields which don\'t currently have a mapping. If you want to re-map a column, you need to click Clear Selection on the column that currently has that mapping to free it up." right=true></info-box></div></div></div></div><div class=row ng-if="dataoverviewctrl.col_being_mapped.unmappable_rows.length > 0"><div class=col-xs-12 eui-index="\'cbh_attachments__{{sheet.metadata.id}}\'" eui-enabled=true><small class=text-danger>{{dataoverviewctrl.col_being_mapped.warningMessage}}</small><table class="table table-responsive" eui-query=ejs.IdsQuery(dataoverviewctrl.col_being_mapped.unmappable_rows) eui-sort="ejs.Sort(\'id\').order(\'asc\')" eui-enabled=true><thead><tr><th>Excel Row Number</th><th>Data Value</th></tr></thead><tbody><tr ng-repeat="hit in indexVM.results.hits.hits"><td>{{hit._id}}</td><td>{{hit._source.attachment_data.project_data[dataoverviewctrl.col_being_mapped.elasticsearch_fieldname]}}</td></tr></tbody></table><div class=text-center ng-show="indexVM.pageCount > 1"><ul class=pager><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=1">&lt;&lt;</a></li><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=indexVM.page - 1">&lt;</a></li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.page + 1">&gt;</a></li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.pageCount">&gt;&gt;</a></li></ul><p><small>{{indexVM.results.hits.total}} results - Page {{indexVM.page}} of {{indexVM.pageCount}}</small></p></div></div></div></div><div class=modal-footer><button class="btn btn-danger" type=button ng-click=cancel()>Close</button></div>'),a.put("views/templates/modal-error-template.html",'<div class=modal-header><h3 class="modal-title blue">File Error:</h3></div><div class=modal-body><div class=row><div class=col-xs-12><strong class=nexa>{{popup_data}}</strong></div></div></div><div class=modal-footer><button class="btn btn-danger" type=button ng-click=cancel()>Close</button></div>'),a.put("views/templates/modal-invitation-template.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class="modal-title blue">Invite someone to AssayReg</h3></div><div class=modal-body><div class=row><div class=col-xs-12><p class=nexa>To invite someone to AssayReg, add their email address, first and last names and select projects they will have access to.</p><p class=text-danger><small>{{validationMessage}}</small></p><div class=form-group><label for=id_projects class="control-label requiredField">Select Projects</label><ui-select multiple ng-model=invite.projects_selected theme=bootstrap><ui-select-match placeholder="&#9660;&nbsp;Select Projects">{{$item.name}}</ui-select-match><ui-select-choices repeat="project in projects"><div ng-bind-html=project.name></div></ui-select-choices></ui-select></div><div class=form-group><label for=id_email class="control-label requiredField">Email address</label><div class=controls><input id=id_email name=email type=email ng-model=invite.email class=form-control></div></div><div class=form-group><label for=id_firstname class="control-label requiredField">First Name (optional)</label><div class=controls><input id=id_firstname name=firstname ng-model=invite.firstName class=form-control></div></div><div class=form-group><label for=id_lastname class="control-label requiredField">Last Name (optional)</label><div class=controls><input id=id_lastname name=lastname ng-model=invite.lastName class=form-control></div></div><div class="form-group pull-right"><button class="btn btn-primary" ng-click=sendInvite()><span class="glyphicon glyphicon-envelope"></span> Send Invite {{(invite.remind ? \' Reminder\': \'\')}}</button></div></div></div></div><div class=modal-footer><button class="btn btn-danger" type=button ng-click=clearForm()>Clear Form</button> <button class="btn btn-danger" type=button ng-click=cancel()>Cancel</button></div>'),a.put("views/templates/my-searches-list.html",'<div class=row ng-repeat="link in links"><div class=col-xs-12><p class=nexa ng-class="link.custom_fields.to_remove == true ? \'strikethrough\' : \'\'"><strong><a ng-click=textBtnForm{{$index}}.$show() ng-hide=textBtnForm{{$index}}.$visible><span class="glyphicon glyphicon-pencil" title=edit ng-if="loggedInUser.username == link.custom_fields.owner_key && link.custom_fields.to_remove == false"></span></a> <span class="glyphicon glyphicon-search"></span>&nbsp; <span editable-text=link.custom_fields.alias e-form=textBtnForm{{$index}} ng-if="link.custom_fields.alias != \'\'">{{ link.custom_fields.alias }}</span><span ng-if="link.custom_fields.custom_fields == \'\' || !link.custom_fields.alias" class=disabled>(no title)</span>&nbsp;</strong><small>view details</small><br><small><span class="glyphicon glyphicon-repeat"></span> <a href="{{ link.custom_fields.url }}">Use this search again</a><br><a href="{{ link.custom_fields.capped_url }}"><span class="glyphicon glyphicon-time"></span>&nbsp;see original results from {{ link.created | date }}</a></small><br></p><hr></div></div><div class=row ng-if="links.length == 0"><div class=col-xs-12>You don\'t have any saved searches</div></div>'),a.put("views/templates/my-searches-modal.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class=modal-title>My Saved Searches</h3></div><div class=modal-body><div class=row ng-repeat="link in links"><div class=col-xs-9><p class=nexa ng-class="link.custom_fields.to_remove == true ? \'strikethrough\' : \'\'"><strong><a ng-click=textBtnForm{{$index}}.$show() ng-hide=textBtnForm{{$index}}.$visible><span class="glyphicon glyphicon-pencil" title=edit ng-if="loggedInUser.username == link.custom_fields.owner_key && link.custom_fields.to_remove == false"></span></a>&nbsp; <span editable-text=link.custom_fields.alias e-form=textBtnForm{{$index}}>{{ link.custom_fields.alias }}</span>&nbsp; <span><a href="{{ link.custom_fields.url }}" ng-click=doFreshSearch();cancel();>Use this search</a></span></strong><br><small><a href="{{ link.custom_fields.capped_url }}" ng-click=cancel()><span class="glyphicon glyphicon-time"></span>&nbsp;see original results from {{ link.created | date }}</a></small></p></div><div class="col-xs-3 text-right"></div></div><div class=row ng-if="links.length == 0">You don\'t have any saved searches</div></div><div class=modal-footer><button class="btn btn-danger" type=button ng-click=cancel()>Close</button></div>'),a.put("views/templates/new-saved-search-modal.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class=modal-title>Save This Search</h3></div><div class=modal-body><div class=row><div class=col-xs-12><form novalidate name=myForm id=myForm role=form style="width:95%; display: table; margin: 0 auto" ng-submit=doValidation(myForm)><div class=form-group sf-schema=savedSearchSchemaForm.schema sf-form=savedSearchSchemaForm.form sf-model=newSavedSearchModel></div><div ng-if=isIE class=pull-right><button type=button class="btn btn-danger" ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span> Close and Discard Changes</button> <button type=submit value=Submit class="btn btn-primary" form=myForm><span class="glyphicon glyphicon-share"></span>Save Changes and Close</button></div></form></div><div ng-if=errormess class=col-xs-12><div class="col-xs-12 has-error"><div class=help-block>{{errormess}}</div></div></div></div></div><div class=modal-footer><div ng-if=!isIE><button type=button class="btn btn-danger" ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span> Close and Discard Changes</button> <button type=submit value=Submit class="btn btn-primary" form=myForm><span class="glyphicon glyphicon-share"></span>Save Changes and Close</button></div></div>'),a.put("views/templates/overview-children-table.html",'<div class="col-xs-12 l3" style="border: 1px solid #444; border-radius:5px; margin-bottom:20px; padding-left:10px;padding-right:10px"><div class=row eui-index="\'cbh_queries\'" eui-filter="ejs.BoolFilter().must(ejs.TermFilter(\'data_form_config.raw\' ,dpclassif.next_level_dfc.resource_uri )).must(ejs.TermFilter(\'level_from\', dpclassif.next_level)).must(ejs.TermFilter(\'l0_permitted_projects.raw\', assayctrl.proj.resource_uri)).must(ejs.TermFilter(\'parent_id\' ,dpclassif.id ))" eui-sort="ejs.Sort(\'modified\').order(\'desc\')" eui-enabled=true style="margin:5px 5px 0"><div class=col-xs-12 style="border-radius:5px; padding:10px"><div class=pull-left><strong class=nexa><span style="color:#eee; background-color:#002147; padding:5px; border-radius:5px">{{dpclassif.next_level_cfc.data_type.plural}}</span></strong> <span class="glyphicon glyphicon-calendar"></span> <small><em>last modified on {{dpclassif.main_data.modified | date}}</em></small></div><div class=pull-right><span><input eui-query="ejs.MultiMatchQuery([dpclassif.next_level + \'.project_data_all\'] , querystring).type(\'phrase_prefix\')" ng-model=querystring eui-enabled=querystring eui-highlight="ejs.Highlight(\'*\').preTags(\'<span class=\\\'highlighted\\\'>\').postTags(\'</span>\')"></span> <span ng-include="\'views/templates/download-results.html\'"></span></div></div><div class=col-xs-12><div class=table-responsive style=background-color:white id=table-{{dpclassif.main_data.id}}><table class="table table-striped" ng-init=dataoverviewctrl.tableLoaded(dpclassif.main_data.id)><thead><tr><th><small>Actions</small></th><th ng-show=assayctrl.proj.project_type.show_compounds><small>Structure</small></th><th ng-repeat="bottomlevelfield in dpclassif.next_level_cfc.project_data_fields"><small>{{bottomlevelfield.name}}</small></th></tr></thead><tbody><tr ng-repeat="childItem in indexVM.results.hits.hits"><td><a ng-click="dpclassif.setChosenDataFormConfig(dpclassif.next_level_dfc.resource_uri, true, childItem._source[dpclassif.next_level])"><span class="hidden-xs hidden-sm" title=Duplicate>Duplicate</span></a></td><td ng-show=assayctrl.proj.project_type.show_compounds><img ng-if=childItem._source.imgSrc ng-src=data:image/png;base64,{{childItem._source.imgSrc}}><img ng-if=!childItem._source.imgSrc src=images/no-structure.b5318bc4.png></td><td style="line-height:0.9 !important" ng-repeat="field in dpclassif.next_level_cfc.project_data_fields"><small ng-show="childItem.highlight[dpclassif.next_level + \'.project_data.\' + field.elasticsearch_fieldname]"><span ng-bind-html="childItem.highlight[dpclassif.next_level + \'.project_data.\' + field.elasticsearch_fieldname][0]"></span></small> <small ng-hide="childItem.highlight[dpclassif.next_level + \'.project_data.\' + field.elasticsearch_fieldname]">{{childItem._source[dpclassif.next_level].project_data[field.elasticsearch_fieldname]}}</small><div ng-if="field.edit_schema.properties[form.elasticsearch_fieldname].format == \'file_upload\'" ng-init="uploads = childItem._source[dpclassif.next_level].project_data[field.elasticsearch_fieldname].attachments; clickFunction = toggleExpand; imageFunction = fetchImage;" ng-include="\'views/templates/files-uploaded-view.html\'"></div></td></tr><tr ng-if="indexVM.results.hits.hits.length == 0" class=text-center><td colspan="{{(1+ dpclassif.next_level_cfc.project_data_fields.length)}}" class=text-center>No results</td></tr></tbody></table><div class=text-center><ul class=pager><li>{{indexVM.results.hits.total}} results</li><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=1">First</a></li><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=indexVM.page - 1">Previous</a></li><li>Page {{indexVM.page}} of {{indexVM.pageCount}}</li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.page + 1">Next</a></li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.pageCount">Last</a></li><li><select ng-model=indexVM.pageSize><option ng-repeat="item in [5, 10, 20]">{{item}}</option></select>per page</li></ul></div></div></div></div></div>'),
a.put("views/templates/overview-children.html",'<div ng-repeat="dpclassif in dpclassif.children" ng-include="\'views/templates/overview-include.html\'"></div>'),a.put("views/templates/overview-drilldown.html","<div class=row><div ng-include=\"'views/templates/overview-include.html'\"></div></div>"),a.put("views/templates/overview-include.html",'<div class="col-xs-12 {{dpclassif.htmlClassName}}" style="border-radius:5px; margin-bottom:20px; padding:5px"><div class=row style="margin:5px 5px 0"><div class=col-xs-12 style="border-radius:5px;  padding:10px"><div class=pull-right><div class=btn-group><button id={{dpclassif.id}} data-toggle=dropdown dropdown-toggle class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-plus-sign"></span> <span class="hidden-xs hidden-sm" title="Add {{dpclassif.next_level_cfc.data_type.name}}">Add Single {{dpclassif.next_data_type_name}}</span><span class=caret></span></button><ul style="margin-top: -8px" class="dropdown-menu pull-right" role=menu aria-labelledby={{dpclassif.id}}><li ng-repeat="newdfc in dpclassif.dfc_full.full_permitted_children" role=menuitem><a ng-click="dpclassif.setChosenDataFormConfig(newdfc.resource_uri, true); ">Using {{newdfc[newdfc.last_level].name}} template</a></li></ul></div><div class=btn-group><button id={{dpclassif.id}}_multiple data-toggle=dropdown dropdown-toggle class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-plus-sign"></span> <span class="hidden-xs hidden-sm" title="Add {{dpclassif.next_level_cfc.data_type.name}}">Upload Multiple {{dpclassif.next_level_cfc.data_type.plural}} <span class=caret></span></span></button><ul style="margin-top: -8px" class="dropdown-menu pull-right" role=menu aria-labelledby={{dpclassif.id}}_multiple><li ng-repeat="newdfc in dpclassif.dfc_full.full_permitted_children" role=menuitem><a ng-click="dpclassif.setChosenDataFormConfigMultiple(newdfc.resource_uri, true); ">Using {{newdfc[newdfc.last_level].name}} template</a></li><li class=divider></li><li ng-repeat="newdfc in dpclassif.dfc_full.full_permitted_children" role=menuitem><a ng-href="{{(newdfc[newdfc.last_level].resource_uri + \'/?format=xlsx\')}}">Download {{newdfc[newdfc.last_level].name}} template</a></li></ul></div></div><div class=row><div class=pull-left><strong class=nexa><span style="color:#eee; background-color:#002147; padding:5px; border-radius:5px">{{dpclassif.main_cfc.data_type.name}}</span> {{dpclassif.main_data.project_data.Title}}</strong> <span class="glyphicon glyphicon-calendar"></span> <small><em>last modified on {{dpclassif.main_data.modified | date}}</em></small></div><div class="button-group pull-left" style=margin-left:10px><div class=btn-group><button type=button class="btn btn-sm btn-primary dropdown-toggle" style=z-index:1 data-toggle=dropdown aria-haspopup=true aria-expanded=false>{{dpclassif.main_cfc.data_type.name}} Actions...<span class=caret></span></button><ul class=dropdown-menu><li><a ng-click=dataoverviewctrl.openDetail(dpclassif)><span class="glyphicon glyphicon-list"></span> <span class="hidden-xs hidden-sm" title="View Details">View Details</span></a></li><li><a ng-click="dpclassif.parentObj.setChosenDataFormConfig(dpclassif.data_form_config, true, dpclassif.main_data)"><span class="glyphicon glyphicon-copy"></span> <span class="hidden-xs hidden-sm" title="Duplicate {{dpclassif.main_cfc.data_type.name}}">Duplicate</span></a></li><li><a ng-click=dataoverviewctrl.openEditDetail(dpclassif)><span class="glyphicon glyphicon-pencil"></span> <span class="hidden-xs hidden-sm" title="Edit {{dpclassif.main_cfc.data_type.name}}">Edit</span></a></li></ul></div></div></div><div ng-show=dpclassif.addingChild><div class="row mt"><div class=col-xs-12><strong class=nexa><span style="color:#eee; background-color:#002147; padding:5px; border-radius:5px">Adding {{dpclassif.next_level_cfc.data_type.name}}</span></strong></div></div><div class="row mt"><div class=col-xs-12><div class=form-group sf-schema=dpclassif.next_level_edit_schema sf-form=dpclassif.next_level_edit_form sf-model=dpclassif.new_next_level_model.project_data></div></div></div><div class="row mt"><div class=col-xs-12><div class="form-group pull-right"><button type=button class="btn btn-danger" ng-click=dpclassif.cancel()><span class="glyphicon glyphicon-remove-circle"></span> Cancel</button> <button type=submit class="btn btn-primary" ng-click=dpclassif.addChild()><span class="glyphicon glyphicon-share"></span> Submit</button></div></div></div></div><div ng-show=dpclassif.addingMultiple><div ng-include="\'views/assayupload.html\'"></div></div></div><div ng-include=dpclassif.childrenTemplate></div></div></div>'),a.put("views/templates/paginator_template.html",'<div ng-show=showFooter class=ngFooterPanel ng-class="{\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}" ng-style=footerStyle()><div class=ngTotalSelectContainer><div class=ngFooterTotalItems ng-class="{\'ngNoMultiSelect\': !multiSelect}"><span class=ngLabel>{{i18n.ngTotalItemsLabel}} {{maxRows()}}</span><span ng-show="filterText.length > 0" class=ngLabel>({{i18n.ngShowingItemsLabel}} {{totalFilteredItemsLength()}})</span></div><div class=ngFooterSelectedItems ng-show=multiSelect><span class=ngLabel>{{i18n.ngSelectedItemsLabel}} {{selectedItems.length}}</span></div></div><div class=ngPagerContainer style="float: right; margin-top: 10px" ng-show=enablePaging ng-class="{\'ngNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px" class=ngRowCountPicker><span style="float: left; margin-top: 3px" class=ngLabel>{{i18n.ngPageSizeLabel}}</span><select style="float: left;height: 27px; width: 100px" ng-model=pagingOptions.pageSize><option ng-repeat="size in pagingOptions.pageSizes">{{size}}</option></select></div><div style="float:left; margin-right: 10px; line-height:25px" class=ngPagerControl style="float: left; min-width: 135px"><button type=button class=ngPagerButton ng-click=pageToFirst() ng-disabled=cantPageBackward() title={{i18n.ngPagerFirstTitle}}><div class=ngPagerFirstTriangle><div class=ngPagerFirstBar></div></div></button> <button type=button class=ngPagerButton ng-click=pageBackward() ng-disabled=cantPageBackward() title={{i18n.ngPagerPrevTitle}}><div class="ngPagerFirstTriangle ngPagerPrevTriangle"></div></button> <input class=ngPagerCurrent min=1 max={{currentMaxPages}} type=number style="width:50px; height: 24px; margin-top: 1px; padding: 0 4px" ng-model="pagingOptions.currentPage"> <span class=ngGridMaxPagesNumber ng-show="maxPages() > 0">/ {{maxPages()}}</span> <button type=button class=ngPagerButton ng-click=pageForward() ng-disabled=cantPageForward() title={{i18n.ngPagerNextTitle}}><div class="ngPagerLastTriangle ngPagerNextTriangle"></div></button> <button type=button class=ngPagerButton ng-click=pageToLast() ng-disabled=cantPageToLast() title={{i18n.ngPagerLastTitle}}><div class=ngPagerLastTriangle><div class=ngPagerLastBar></div></div></button></div></div></div>'),a.put("views/templates/pagingbar.html",'<div class=row><div ng-show="cbh.statename == \'cbh.projects.project.addcompounds\'" class="col-md-6 col-lg-7"><button ng-disabled="compoundBatches.sorts.length ==0" ng-click=nullSorts() class="btn btn-default">Remove Sorts</button> <button ng-show="stateName == \'cbh.projects.project.addcompounds\'" ng-disabled="warningsFilter==\'\'" ng-click="cbh.toggleWarningsFilter(\'\')" class="btn btn-default">Remove Filters</button> <a ng-click=cbh.openStatusExplanation() role=button class="btn btn-default"><span class="glyphicon glyphicon-question-sign"></span> What do the different statuses mean?</a><select style="width:110px; display:inline-block" ng-options="item.label for item in itemsPerPage track by item.value" ng-model=pagination.compoundBatchesPerPage ng-change=changeNumberPerPage(listOrGallery.choice) class=form-control></select></div><div class="col-md-6 col-lg-7" ng-if="cbh.statename!=\'cbh.projects.project.addcompounds\'"><div class=form-group><div class=col-sm-12 style="padding:0 3px"><div class=btn-group><button id=hideOptions type=button data-toggle=dropdown class="btn btn-default"><span class="glyphicon glyphicon-sort"></span><span class="glyphicon glyphicon-filter"></span>Fields&nbsp;<span class=caret></span></button><ul class=dropdown-menu aria-labelledby=projectOptions><li class=col-xs-12>Filter, sort or hide</li><li><div class=col-xs-12><input placeholder="Search by name" ng-model=hidefilter></div></li><li ng-repeat="col in cbh.tabular_data_schema | filter:{knownBy : hidefilter}:strict"><a ng-click=cbh.sendToSearch(col)>{{col.knownBy}}</a></li></ul><label class="btn btn-default" ng-class="{ active: listOrGallery.choice === \'list\' }"><input type=radio ng-model=listOrGallery.choice value=list id=list-btn name=listOrGallery style=display:none ng-change=changeView()><span class="glyphicon glyphicon-list-alt"></span><span class="hidden-xs hidden-sm hidden-md"></span></label><label class="btn btn-default" ng-class="{ active: listOrGallery.choice === \'gallery\' }"><input type=radio ng-model=listOrGallery.choice value=gallery id=gallery-btn name=listOrGallery style=display:none ng-change=changeView()><span class="glyphicon glyphicon-picture"></span><span class="hidden-xs hidden-sm hidden-md"></span></label><span ng-if="cbh.statename==\'cbh.searchv2\'"><label ng-if="!addingData && !editModeUnreachable()" class="btn btn-default" ng-class="{ active: cbh.editMode === true }"><input type=radio ng-click=cbh.toggleEditMode() id=list-btn style=display:none><span class="glyphicon glyphicon-pencil"></span><span class="hidden-xs hidden-sm hidden-md">Edit</span></label><label ng-if="addingData || editModeUnreachable()" class="btn btn-default" disabled title={{cbh.messages.edit_mode_unavailable_projects}}><span class="glyphicon glyphicon-pencil"></span><span class="hidden-xs hidden-sm hidden-md">Edit</span></label><label ng-if="!cbh.editMode && !editModeUnreachable() && cbh.projAddingTo.project_type.show_compounds == false" class="btn btn-default" ng-class="{ active: addingData === true }"><input type=radio ng-click=toggleAddData() id=list-btn style=display:none><span class="glyphicon glyphicon-plus"></span><span class="hidden-xs hidden-sm hidden-md">Add Single</span></label><label ui-sref="cbh.projects.project.addsingle({projectKey: cbh.projAddingTo.project_key})" ng-if="!cbh.editMode && !editModeUnreachable() && cbh.projAddingTo.project_type.show_compounds == true" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span><span class="hidden-xs hidden-sm hidden-md">Add Single</span></label><label ng-if="editModeUnreachable() || cbh.editMode" class="btn btn-default" disabled title={{cbh.messages.edit_mode_unavailable_projects}}><span class="glyphicon glyphicon-plus"></span><span class="hidden-xs hidden-sm hidden-md">Add Single</span></label><label ng-if="cbh.editMode || editModeUnreachable()" class="btn btn-default" disabled title={{cbh.messages.edit_mode_unavailable_projects}}><span class="glyphicon glyphicon-plus"></span><span class="glyphicon glyphicon-list-alt"></span><span class="hidden-xs hidden-sm hidden-md">Add Multiple</span></label><label ng-if="!cbh.editMode && !editModeUnreachable()" class="btn btn-default" ui-sref="cbh.projects.project.addcompounds({projectKey: cbh.projAddingTo.project_key})"><span class="glyphicon glyphicon-plus"></span><span class="glyphicon glyphicon-list-alt"></span><span class="hidden-xs hidden-sm hidden-md">Add Multiple</span></label></span><info-box ng-if="cbh.statename==\'cbh.searchv2\'" style="margin-top:-5px; margin-right:5px" right=true lookup=edit_mode lookupitems=cbh.messages></info-box><select style="width:100px; display:inline-block" ng-options="item.label for item in itemsPerPage track by item.value" ng-model=pagination.compoundBatchesPerPage ng-change=changeNumberPerPage(listOrGallery.choice) class=form-control></select></div></div></div></div><div class="col-lg-5 col-md-6"><div class=col-xs-7 style=padding-left:0px><dir-pagination-controls on-page-change=pageChanged(newPageNumber) max-size=5></dir-pagination-controls></div><div ng-if=cbh.baseDownloadUrl ng-if="cbh.statename!=\'cbh.projects.project.addcompounds\'" class=col-xs-5><div class={{dropclass}}><div ng-include="\'views/templates/download-buttons.html\'"></div></div></div></div></div>'),a.put("views/templates/plate-map-template.html",'<h2 class=blue>{{plateForm["Name"]}}</h2><div class=col-lg-7><div class=row><div id=plate><div class="col-headers row"><ul class=list-inline><li class="platewell header">&nbsp;</li><li class="platewell header" ng-repeat="col in cols">{{col}}</li></ul></div><div class=row ng-repeat="row in rows"><ul class=list-inline><li class="platewell header">{{row}}</li><li class=platewell ng-repeat="col in cols"><div ng-click="showWellForm(plateForm.wells[row + col])" id="{{row + col}}" ng-class="{\'selection\' : isWellSelected(row + col, plateForm), \'contains-info\': wellHasData(row + col, plateForm)}">&nbsp;</div></li></ul></div><div class=row></div></div></div></div><div class=col-lg-5><div ng-show=wellForm.row><h2 class=blue>{{wellForm.row}}{{wellForm.col}}</h2><form novalidate name=singleWellForm role=form style="width:95%; display: table; margin: 0 auto"><div class=row sf-schema=schemaFormHolder.well_schema sf-form=schemaFormHolder.well_form sf-model="plateForm.wells[wellForm.row + wellForm.col]"></div><div class=row><div class="col pull-right"><span ng-if=savingWell><img src=images/ajax-loader.bc7fa9e4.gif></span>&nbsp; <button class="btn btn-success" ng-click=saveWell(singleWellForm)>Save Well</button> <button class="btn btn-danger" ng-click=clearWell(singleWellForm)>Clear Well</button></div></div><div class="row pull-right mt"><div class=col-xs-12><span ng-if=plateSaved class=alert-success>Plate saved</span>&nbsp; <button class="btn btn-success" ng-click=doSavePlate(singleWellForm)>Save Plate</button></div></div></form></div></div>'),a.put("views/templates/project-list.html",'<div class="row grey-to-white {{!project.project_type.show_compounds ? \'nonchem\' : \'\'}}" ng-repeat="project in projects | filter:search:strict" style="margin-bottom:15px; margin-left:10px; border-radius:10px; align-items:center; display:flex; flex-flow: wrap row"><div class="proj-section proj-list-header {{!project.project_type.show_compounds ? \'nonchem\' : \'\'}}" style=height:100%><h2 class=blue style="display:inline-block; padding-bottom:0; margin-bottom: 0">{{project.name }}</h2></div><div class="proj-section add"><div><ul class="list-unstyled text-center" style=margin-bottom:0><li><img src=images/add.59082a6c.svg class="svg {{!project.project_type.show_compounds ? \'nonchem\' : \'\'}}"></li><li><strong class=nexa><span>add</span></strong></li></ul><p style="margin: 0 0 0 20px"><a ng-if="project.editor && project.project_type.show_compounds && !project.project_type.plate_map_project_type" ui-sref="cbh.projects.project.addsingle({projectKey: project.project_key})"><span class="glyphicon glyphicon-pencil"></span> Draw compound</a><br ng-if="project.editor && project.project_type.show_compounds && !project.project_type.plate_map_project_type"><a ng-if="project.editor && !project.project_type.show_compounds && !project.project_type.plate_map_project_type" ng-click="toggleSingleForm.showFlag = !toggleSingleForm.showFlag; cbh.showSingle = true" ui-sref="cbh.searchv2({pids: project.id })"><span class="glyphicon glyphicon-plus-sign"></span> Add single {{project.project_type.show_compounds ? \'compound\' : \'inventory item\'}}</a><br ng-if="project.editor && !project.project_type.show_compounds && !project.project_type.plate_map_project_type"><a ng-if="project.editor && !project.project_type.plate_map_project_type" ui-sref="cbh.projects.project.addcompounds({projectKey: project.project_key})"><span class="glyphicon glyphicon-plus-sign"></span> Add multiple {{project.project_type.show_compounds ? \'compounds\' : \'inventory items\' }}</a><br ng-if="project.editor && project.project_type.plate_map_project_type"><a ng-if="project.editor && project.project_type.plate_map_project_type" ui-sref="cbh.projects.project.addplate({projectKey: project.project_key})"><span class="glyphicon glyphicon-plus-sign"></span> Add Plate</a></p></div></div><div class="proj-section search"><div><ul class="list-unstyled text-center" style=margin-bottom:0><li><img src=images/search.a7c4cd04.svg class="svg {{!project.project_type.show_compounds ? \'nonchem\' : \'\'}}"></li><li><strong class=nexa><span>search</span></strong></li></ul><p style="margin: 0 0 0 20px"><a ng-if=!project.project_type.plate_map_project_type ng-click="cbh.hideSearchForm=true;" ui-sref="cbh.searchv2({pids: project.id })"><span class="glyphicon glyphicon-search"></span> Search all {{project.project_type.show_compounds ? \'compounds\' : \'inventory items\' }}</a><br ng-if=!project.project_type.plate_map_project_type><a ng-if=!project.project_type.plate_map_project_type ui-sref="cbh.searchv2({pids: project.id, encoded_query : ({\'value\' : cbh.logged_in_user.display_name ,field_path: \'created_by\'} | encodeParamForSearch) })"><span class="glyphicon glyphicon-user"></span> Search my {{project.project_type.show_compounds ? \'compounds\' : \'inventory items\' }}</a><br ng-if=project.project_type.plate_map_project_type><a ng-if="project.editor && project.project_type.plate_map_project_type" ui-sref="cbh.projects.project.listplates({projectKey: project.project_key})"><span class="glyphicon glyphicon-search"></span> List Plates</a></p></div></div><div class="proj-section admin"><div ng-if=project.owner><ul class="list-unstyled text-center" style=margin-bottom:0><li><img src=images/map.e00472fe.svg class="svg {{!project.project_type.show_compounds ? \'nonchem\' : \'\'}}"></li><li><strong class=nexa><span>admin</span></strong></li></ul><p style="margin: 0 0 0 20px"><a ng-if=project.owner ng-click=openProjectWindow(project.id)><span class="glyphicon glyphicon-pencil"></span> Edit configuration</a><br ng-if=project.owner><a ng-if=project.owner ng-click=openEditPermissions(project)><span class="glyphicon glyphicon-user"></span> Edit user roles</a><br ng-if=project.owner><a ng-if=project.owner ui-sref="cbh.archiveitems({pids: project.id })"><span class="glyphicon glyphicon-trash"></span> Archive {{project.project_type.show_compounds ? \'compounds\' : \'inventory items\' }}</a><br ng-if=project.owner><a ng-if=project.owner ui-sref="cbh.restoreitems({pids: project.id })"><span class="glyphicon glyphicon-retweet"></span> Restore / view archive</a><br ng-if=project.owner></p></div></div></div>'),a.put("views/templates/saved-search-buttons.html",'<div style=display:inline-block class="form-group pull-right"><div style="display:inline-block; width:28%" class="dropdown pull-right"><button id=savedSearchOptions type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false class="btn btn-primary pull-right">Saved Search... <span class=caret></span></button><ul class="dropdown-menu pull-right" aria-labelledby=savedSearchOptions><li><a ng-click=openNewSavedSearchPopup() ng-if="hasSearchBeenPerformed() == true"><span class="glyphicon glyphicon-save-floppy"></span> <span>Save This Search</span></a></li><li><a ng-click=openMySavedSearchPopup()><span class="glyphicon glyphicon-save-pencil"></span> <span>My Saved Searches</span></a></li></ul></div><p style="display:inline-block; width:60%; line-height:15px" class="help-block pull-right"><small>Perform a search over and over again? Use the saved search feature to save time.</small></p></div>'),a.put("views/templates/search-breadcrumb-template.html",'<div class=row><div class="col-md-3 holder"><fieldset class=breadcrumbs><legend>Hidden Fields</legend><ul class=list-inline><div class=dropdown><button id=hidefieldOptions type=button data-toggle=dropdown class="btn btn-primary btn-lg"><span ng-if="!hide_objects || hide_objects.length == 0">Nothing Hidden</span> <span ng-if="hide_objects.length == 1">{{hide_objects[0].knownBy}}</span> <span ng-if="hide_objects.length   > 1">{{hide_objects.length}} hidden fields</span> <span class=caret></span></button><ul class=dropdown-menu aria-labelledby=hidefieldOptions><li><a ng-click=unHideAll()>Show all fields</a></li><li><hr></li><li class=col-xs-12>Click to hide or show</li><li><div class=col-xs-12><input placeholder="Search by name" ng-model=hidefilt></div></li><li ng-repeat="col in cbh.tabular_data_schema | filter:{knownBy : hidefilt}:strict"><a ng-click=toggleHide(col)><span class=glyphicon ng-class="col.hide==\'hide\' ? \'glyphicon-eye-close\' : \'glyphicon-eye-open\'"></span> <span style="{{col.hide==\'hide\' ? \'color:grey !important\' : \'\'}}">{{col.knownBy}}</span></a></li></ul></div></ul></fieldset></div><div class="col-md-4 holder"><fieldset class=breadcrumbs><legend>Sorts</legend><ul class=list-inline><li class=breadcrumb ng-repeat="bc in sort_objects"><span class=bcname ng-click=filterClicked(bc)>{{bc.knownBy}}</span> <span class="glyphicon glyphicon-sort-by-alphabet" ng-if="bc.sort_direction == \'asc\'"></span> <span class="glyphicon glyphicon-sort-by-alphabet-alt" ng-if="bc.sort_direction == \'desc\'"></span> <button type=button class=close aria-label=Close ng-click=closeSortBreadcrumb(bc)><span aria-hidden=true>&times;</span></button></li><li ng-if="!sort_objects || sort_objects.length == 0"><small>No sorts</small></li></ul></fieldset></div><div class="col-md-4 holder"><fieldset class=breadcrumbs><legend>Filters</legend><ul class=list-inline><li class=breadcrumb ng-if=chemicalfilter><p class=nexa><button type=button class="close pull-right" aria-label=Close ng-click=removeStructureSearch()><span aria-hidden=true>&times;</span></button> <span class="glyphicon glyphicon-filter pull-right"></span> <span class=bcname ng-click=filterClicked(structureCol)>Structure Search</span><br><span class=bcname ng-click=filterClicked(structureCol) style="font-size:0.8em; color:#aaa">{{queryName}}</span> <img ng-if=chemicalfilter.image ng-src=data:image/png;base64,{{chemicalfilter.image}}></p></li><li class=breadcrumb ng-repeat="bc in filter_objects"><p class=nexa><button type=button class="close pull-right" aria-label=Close ng-click=closeFilterBreadcrumb(bc)><span aria-hidden=true>&times;</span></button> <span class="glyphicon glyphicon-filter pull-right"></span> <span class=bcname ng-click=filterClicked(bc)>{{bc.knownBy}}</span><br><span class=bcname ng-click=filterClicked(bc) style="font-size:0.8em; color:#aaa">{{bc.display_filter}}</span></p></li><li ng-if="!chemicalfilter && (!filter_objects || filter_objects.length == 0 )"><small>No filters</small></li></ul></fieldset></div><div class=col-md-1><button style=margin-top:30px class="btn btn-lg btn-danger pull-right" ng-click=cbh.resetSearch()>Reset</button></div></div>'),a.put("views/templates/search-filter-template.html",'<div ng-if=showFilters id=filters-window class=animate-if><div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=close()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class="modal-title blue">{{col.knownBy}} - filters and sorts</h3></div><div class=modal-body><div class=row><div class=col-sm-4 ng-if="col.data ==\'properties.archived\'"><div class=dropdown aria-hidden=false><ul class="list-unstyled pull-left" role=menu aria-labelledby=userBtn><li><a class=relative ng-click=cbh.toggleArchiveFilter() tabindex=0><strong class=nexa><span class="glyphicon glyphicon-filter"></span> &nbsp;Show only archived <span class=glyphicon ng-class="(cbh.archiveFilter) ? \'glyphicon-check\':\'glyphicon-unchecked\'"></span></strong></a></li><li><a class=relative ng-click=cbh.toggleArchiveFilter() tabindex=0><strong class=nexa><span class="glyphicon glyphicon-filter"></span> &nbsp;Show records not archived <span class=glyphicon ng-class="(cbh.archiveFilter) ? \'glyphicon-unchecked\': \'glyphicon-check\'"></span></strong></a></li></ul></div></div><div class=col-sm-4 ng-if=!col.noSort><div aria-hidden=false><ul class="list-unstyled pull-left" role=menu><li class=text-center><strong class=nexa>Sort column:</strong></li><li class=divider><hr></li><li><a class=relative ng-click="cbh.addSort(col.data, \'asc\'); cancel();"><strong class=nexa><span class="glyphicon glyphicon-sort-by-alphabet"></span> &nbsp;A-Z <span class=glyphicon ng-class="(col.sortOrder==\'asc\') ? \'glyphicon-check\':\'glyphicon-unchecked\'"></span></strong></a></li><li><a class=relative ng-click="cbh.addSort(col.data, \'desc\'); cancel();"><strong class=nexa><span class="glyphicon glyphicon-sort-by-alphabet-alt"></span> &nbsp;Z-A <span class=glyphicon ng-class="(col.sortOrder==\'desc\') ? \'glyphicon-check\':\'glyphicon-unchecked\'"></span></strong></a></li></ul></div></div><div class=col-sm-8 ng-if="(col.mappingOptions.length > 0)"><div class=pull-left aria-hidden=false><ul class=list-unstyled role=menu aria-labelledby=userBtn><li class=text-center><strong class=nexa>Map column to:</strong></li><li class=divider><hr></li><li ng-repeat="opt in col.mappingOptions"><a class=relative ng-if=opt.uiClass ng-click="$event.stopPropagation(); cbh.toggleMappedFieldInDirective($index,col.knownBy);cancel();"><strong class=nexa><span ng-bind-html=opt.icon></span> &nbsp;{{opt.title}}</strong> <span ng-if=opt.uiClass class="glyphicon pull-right" ng-class=opt.uiClass></span></a> <a disabled ng-if=!opt.uiClass ng-click=$event.stopPropagation();><strong class="nexa lightgrey"><span ng-bind-html=opt.icon></span> &nbsp;{{opt.title}}</strong></a></li></ul></div></div></div></div></div>'),a.put("views/templates/search-filter-templatev2.html",'<div ng-if=col.showFilters class=col-xs-12><fieldset class=filters><legend>{{col.knownBy}} - add filters and sorts</legend><div class=col-sm-3><form novalidate><div class=col-xs-12 style="padding-top:10px; linear-gradient(to bottom, rgba(181,209,255,0.34) 0%,rgba(181,209,255,0.34) 100%)"><div class=col-xs-12 sf-schema=sortAsfSchema sf-form=sortAsfForm sf-model=col></div><div class=col-xs-12 sf-schema=hideAsfSchema sf-form=hideAsfForm sf-model=col></div></div></form></div><form class=col-sm-9 novalidate id=html5ValidationForm name=html5ValidationForm ng-submit=submit(html5ValidationForm)><div class=col-xs-12 style="padding-top:10px; linear-gradient(to bottom, rgba(181,209,255,0.34) 0%,rgba(181,209,255,0.34) 100%)"><div class=col-xs-12 sf-schema=queryAsfSchema sf-form=queryAsfForm sf-model=col.filters></div><div ng-show=false class=col-xs-12><button id=validatorId type=submit value=Submit class="btn btn-primary" form=html5ValidationForm><span class="glyphicon glyphicon-share"></span>Apply Filter</button></div></div></form></fieldset></div>'),a.put("views/templates/search-filter-templatev2_chemical.html",'<div ng-if=col.showFilters class=col-xs-12><fieldset class=filters><legend>{{col.knownBy}} - add filters and sorts</legend><div class=col-sm-3><form novalidate><div class=col-xs-12 style="padding-top:10px; linear-gradient(to bottom, rgba(181,209,255,0.34) 0%,rgba(181,209,255,0.34) 100%)"><div class=col-xs-12 sf-schema=hideAsfSchema sf-form=hideAsfForm sf-model=col></div></div></form></div><form class=col-sm-9 novalidate id=html5ValidationForm name=html5ValidationForm ng-submit=chemicalsubmit(html5ValidationForm)><div class=col-xs-12 style="padding-top:10px; linear-gradient(to bottom, rgba(181,209,255,0.34) 0%,rgba(181,209,255,0.34) 100%)"><div class=col-xs-12 sf-schema=queryAsfSchema sf-form=queryAsfForm sf-model=chemicalfilters></div></div></form></fieldset></div>'),a.put("views/templates/search-template.html",'<div class="container-flex mt"><div class=col-xs-12><div class=col-sm-12><h2 id=searchtop class="blue pull-left" style="display:inline-block; width:30%"><span class="glyphicon glyphicon-search"></span> Search &nbsp;<button class="btn btn-sm btn-default pull-right" ng-if=!cbh.hideSearchForm ng-click="cbh.hideSearchForm=true;">Hide Advanced and Structure Search</button> <button class="btn btn-sm btn-default" ng-if=cbh.hideSearchForm ng-click="cbh.hideSearchForm=false;">Show Advanced and Structure Search</button></h2><div class="col-xs-5 pull-right" style="display:inline-block; width:60%"><div ng-include="\'views/templates/saved-search-buttons.html\'"></div></div></div><div ng-if=justAdded class="col-sm-12 alert alert-success mb">Your saved {{projectObj.project_type.show_compounds == true ? \'compounds\' : \'items\' }} are shown below. You can now either view the full project or add more items. <button ui-sref="cbh.search({project__project_key_in: selected_projects[0], multiple_batch_id:undefined})" ng-click="cbh.hideSearchForm=false;" class="btn btn-primary">View full project</button> <button ui-sref="cbh.projects.project.addsingle({projectKey: selected_projects[0]})" class="btn btn-primary" ng-show=projectObj.project_type.show_compounds>Draw another compound</button> <button ui-sref="cbh.projects.project.addcompounds({projectKey: selected_projects[0]})" class="btn btn-primary">Add more {{selected_projects[0].project_type.show_compounds == true ? \'compounds\' : \'items\' }} via file</button></div></div><form novalidate name=inputForm role=form style="width:95%; display: table; margin: 0 auto"><div class=row sf-schema=searchFormSchema.simple_schema sf-form=searchFormSchema.simple_form sf-model=cbh.searchForm></div><div class=row ng-if=!cbh.hideSearchForm><div class=col-sm-5><div ng-show=cbh.isIE class=alert-warning>It looks like you are using Internet Explorer. For a better experience with ChemDoodle on ChemBio Hub we recommend using a different browser. Currently only the single bonds and typing atoms features are available in Explorer.</div><div class=row><chemdoodlewrapper molfile=cbh.searchForm.molecule.molfile elementid="\'chemdoodle\'"><canvas id=chemdoodle></canvas></chemdoodlewrapper></div></div><div class=col-sm-7><div class=row sf-schema=searchFormSchema.schema sf-form=searchFormSchema.form sf-model=cbh.searchForm></div><div class="row mt"><div><button ng-click=cbh.runSearch(true) type=submit class="btn btn-lg btn-primary"><span class="glyphicon glyphicon-search"></span> Run structure search</button> <button type=cancel ng-click=cancel() class="btn btn-lg btn-danger pull-right"><span class="glyphicon glyphicon-close"></span> Reset</button></div></div></div></div><a id=search-bottom></a></form></div>'),a.put("views/templates/search-templatev2.html",'<div class=container-flex><div class=row style=margin-top:10px><div class=col-xs-12><h2 ng-if="cbh.statename==\'cbh.searchv2\' && !cbh.justAdded" id=searchtop class="blue pull-left" style=display:inline-block><span class="glyphicon glyphicon-search"></span> Search &nbsp;</h2><h2 ng-if="cbh.statename==\'cbh.searchv2\' && cbh.justAdded" id=searchtop class="blue pull-left" style=display:inline-block><span class="glyphicon glyphicon-ok"></span> All done! &nbsp;</h2><h2 ng-if="cbh.statename==\'cbh.archiveitems\'" id=searchtop class="blue pull-left" style=display:inline-block><span class="glyphicon glyphicon glyphicon-trash"></span>&nbsp;Archive {{cbh.projAddingTo.project_type.show_compounds ? \'compounds\' : \'inventory items\' }}&nbsp;</h2><h2 ng-if="cbh.statename==\'cbh.restoreitems\'" id=searchtop class="blue pull-left" style=display:inline-block><span class="glyphicon glyphicon glyphicon-retweet"></span>&nbsp;Restore / view archived {{cbh.projAddingTo.project_type.show_compounds ? \'compounds\' : \'inventory items\' }}&nbsp;</h2><div class="col-xs-9 pull-right"><div ng-include="\'views/templates/saved-search-buttons.html\'"></div></div></div></div><div class=row><div class="col-xs-6 col-sm-5 col-md-4 col-lg-2"><div class="form-group form-group-lg"><div class=input-group><div class=dropdown><button id=projectOptions type=button data-toggle=dropdown class="btn btn-primary btn-lg" style=text-align:left><span ng-if="cbh.selected_projects.length==0">No Project Filter</span> <span ng-if="cbh.selected_projects.length==1">{{cbh.selected_projects[0].name}}</span> <span ng-if="cbh.selected_projects.length > 1">{{cbh.selected_projects.length}} projects selected</span> <span class="caret text-right"></span></button><ul class="dropdown-menu col" style=width:220px aria-labelledby=projectOptions><li><a ng-click=cbh.selectAllProjects() class=ng-scope>Select All</a></li><li><a ng-click=cbh.deSelectAllProjects() class=ng-scope>Deselect All</a></li><li><hr></li><li><div class=col-xs-12><input placeholder="Search by name" ng-model=projectfilter></div></li><li ng-repeat="project in cbh.projects.objects | filter:{name:projectfilter}"><a ng-click="cbh.toggleProjectFiltered(project);  $event.stopPropagation();" class=ng-scope><span class=glyphicon ng-class="project.filtered ? \'glyphicon-check\' : \'glyphicon-unchecked\'"></span>{{project.name}}</a></li></ul></div></div></div></div><div class="col-xs-6 col-sm-7 col-md-8 col-lg-10"><div class="form-group form-group-lg"><div class=input-group style="border:1px solid #002147; border-radius:4px"><span class=input-group-addon style=margin-left:20px><span class="glyphicon glyphicon-search"></span></span><input ng-model=cbh.textsearch class=form-control placeholder="Search ChemBio Hub Platform"></div></div></div><div class=row><div class=col-xs-12 style="margin:5px 0"><search-breadcrumbs cbh=cbh></search-breadcrumbs></div><div class=col-xs-12 style="margin:5px 0"><div class=filterHolder><search-filter cbh=cbh></search-filter></div></div></div><a id=search-bottom></a></div></div>'),
a.put("views/templates/single-compound-full.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click="$dismiss(\'cancel\')"><span class="glyphicon glyphicon-remove-circle"></span></button><h2 class="modal-title blue nexa">Batch {{::mol.id}} - {{::mol.uuid}} <a href="" clip-copy=::mol.chemblId clip-click="" role=button class="btn btn-default"><span class="glyphicon glyphicon-file"></span> Copy ID</a> <a ng-if="projectObj.project_type.show_compounds == true" href="" clip-copy=::mol.properties.cdxml clip-click="" role=button class="btn btn-default"><span class="glyphicon glyphicon-file"></span> Copy CDXML</a> <button class="btn btn-primary" ng-if=!projectObj.editor disabled>{{projectObj.project_type.copy_action_name | htmlToPlaintext}}</button> <button class="btn btn-primary" ng-if=projectObj.editor ng-click=openClone()>{{projectObj.project_type.copy_action_name | htmlToPlaintext}}</button> <small><span class="glyphicon glyphicon-folder-open"></span> &nbsp;&nbsp;{{projectObj.name}}</small></h2></div><div class=modal-body><form novalidate name=inputForm id=inputForm role=form ng-submit=validateFormData(inputForm)><div class=row ng-show=isNewCompoundsInterface><div class=col-xs-12><img ng-if=mol.bigimage class="col-xs-12 col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1" ng-src=data:image/png;base64,{{mol.bigimage}}></div></div><div ng-hide=isNewCompoundsInterface><div class=row ng-hide=mol.blindedBatchId><div class="col-xs-12 col-md-4" ng-if="projectObj.project_type.show_compounds == true"><img ng-if=mol.bigimage class=col-xs-12 ng-src=data:image/png;base64,{{mol.bigimage}}></div><div class="col-xs-12 col-md-8"><div class=col-xs-12><h2 class="nexa blue">{{projectObj.project_type.show_compounds == true ? \'Compound\' : \'Item\' }} Information</h2></div><div class="col-xs-12 col-md-6"><button-input ng-if=mol.created_by copy-model=mol.created_by disabled label="\'Added By\'"></button-input><div ng-if="projectObj.project_type.show_compounds == true"><button-input copy-model=mol.canonical_smiles disabled label="\'SMILES\'"></button-input><button-input copy-model=mol.standard_inchi disabled label="\'Standard INCHI\'"></button-input><button-input copy-model=mol.standard_inchi_key disabled label="\'Standard INCHI key\'"></button-input></div></div><div class="col-xs-12 col-md-6"><button-input ng-if=mol.created copy-model="mol.created | date:\'dd-MM-yyyy\'" disabled label="\'Registered on\'"></button-input><div ng-if="projectObj.project_type.show_compounds == true"><button-input copy-model="mol.related_molregno.compoundproperties.alogp | number:2" disabled label="\'AlogP\'"></button-input><button-input copy-model="mol.related_molregno.compoundproperties.full_mwt | number:2" disabled label="\'Mol Weight\'"></button-input><button-input copy-model=mol.related_molregno.compoundproperties.full_molformula disabled label="\'Mol Formula\'"></button-input></div></div></div></div><div class="divider spacer"></div><div class=row><div class=col-xs-12><div class=col-xs-12><h2 class="nexa blue">Project Data <button type=button ng-disabled=!projectObj.editor ng-show=!editMode class="btn btn-primary" ng-click=enterEditMode(true)>Edit Mode</button> <button type=button ng-disabled=!projectObj.editor ng-show=editMode class="btn btn-danger" ng-click=enterEditMode(false)>Cancel Edit</button> <button type=submit ng-show=editMode value=Submit class="btn btn-primary" form=inputForm><span class="glyphicon glyphicon-share"></span> Update Project Data</button></h2></div><div class=row ng-if="errormess!=\'\' || !editMode"><div class="help-block col-xs-12 text-center"><p class="nexa text-danger"><strong>{{errormess}}</strong></p></div></div><div class="alert alert-success" ng-show=update_success>Project Data Updated Successfully</div><div class="col-xs-12 col-md-6" ng-hide=editMode><div ng-repeat="item in firstList track by item.key"><button-input copy-model=item.value disabled label=::item.key ng-if="item.isFileField == false"></button-input><div class=form-group ng-if="item.isFileField == true"><label>{{item.key}}</label><ul class=list-inline><li ng-repeat="attachment in item.value.attachments" style=display:inline-table><div class="text-center col-xs-12 thumb-container"><img ng-if="attachment.mimeType.indexOf(\'image\') != -1" width=100 ng-src="{{attachment.url}}"> <img ng-if="attachment.mimeType.indexOf(\'spreadsheetml\') != -1 || attachment.mimeType.indexOf(\'excel\') != -1" width=100 ng-src="images/xlsx-placeholder.8cc1d17c.png"> <img ng-if="attachment.mimeType.indexOf(\'wordprocessingml\') != -1 || attachment.mimeType.indexOf(\'msword\') != -1" width=100 ng-src="images/docx-placeholder.61f1fc6c.png"> <img ng-if="attachment.mimeType.indexOf(\'pdf\') != -1" width=100 ng-src="images/pdf-placeholder.f797271a.png"> <img ng-if="attachment.mimeType.indexOf(\'pdf\') == -1 && attachment.mimeType.indexOf(\'image\') == -1 && attachment.mimeType.indexOf(\'spreadsheetml\') == -1 && attachment.mimeType.indexOf(\'excel\') == -1 && attachment.mimeType.indexOf(\'wordprocessingml\') == -1 && attachment.mimeType.indexOf(\'msword\') == -1" width=100 ng-src="images/file-placeholder.bcb75331.png"><div class=thumb-overlay style="display:flex; flex-direction:column; align-items:stretch; justify-content: center; width:100px"><div><span style="font-size: 0.8em; word-wrap: break-word">{{attachment.printName}}</span></div><div style="font-size: 3em; word-wrap: break-word"><a href={{attachment.url}} style=color:white title=download><span class="glyphicon glyphicon-download"></span></a></div></div></div></li><li ng-show="item.value.attachments.length == 0 || !item.value">no attachments</li></ul></div></div></div><div class="col-xs-12 col-md-6" ng-hide=editMode><div ng-repeat="item in secondList track by item.key"><button-input copy-model=item.value disabled label=::item.key ng-if="item.isFileField == false"></button-input><div class=form-group ng-if="item.isFileField == true"><label>{{item.key}}</label><ul class=list-inline><li ng-repeat="attachment in item.value.attachments" style=display:inline-table><div class="text-center col-xs-12 thumb-container"><img ng-if="attachment.mimeType.indexOf(\'image\') != -1" width=100 ng-src="{{attachment.url}}"> <img ng-if="attachment.mimeType.indexOf(\'spreadsheetml\') != -1 || attachment.mimeType.indexOf(\'excel\') != -1" width=100 ng-src="images/xlsx-placeholder.8cc1d17c.png"> <img ng-if="attachment.mimeType.indexOf(\'wordprocessingml\') != -1 || attachment.mimeType.indexOf(\'msword\') != -1" width=100 ng-src="images/docx-placeholder.61f1fc6c.png"> <img ng-if="attachment.mimeType.indexOf(\'pdf\') != -1" width=100 ng-src="images/pdf-placeholder.f797271a.png"> <img ng-if="attachment.mimeType.indexOf(\'pdf\') == -1 && attachment.mimeType.indexOf(\'image\') == -1 && attachment.mimeType.indexOf(\'spreadsheetml\') == -1 && attachment.mimeType.indexOf(\'excel\') == -1 && attachment.mimeType.indexOf(\'wordprocessingml\') == -1 && attachment.mimeType.indexOf(\'msword\') == -1" width=100 ng-src="images/file-placeholder.bcb75331.png"><div class=thumb-overlay style="display:flex; flex-direction:column; align-items:stretch; justify-content: center; width:100px"><div><span style="font-size: 0.8em; word-wrap: break-word">{{attachment.printName}}</span></div><div style="font-size: 3em; word-wrap: break-word"><a href={{attachment.url}} style=color:white title=download><span class="glyphicon glyphicon-download"></span></a></div></div></div></li><li ng-show="item.value.attachments.length == 0">no attachments</li></ul></div></div></div><div ng-if=editMode class="col-xs-12 col-md-6"><div class=form-group sf-schema=myschema sf-form=firstForm sf-model=mol.custom_fields sf-options="{ feedback: { \'glyphicon\': true, \'glyphicon-asterisk\': form.required && !hasSuccess() && !hasError() , \'glyphicon-remove\': hasError() } }"></div></div><div ng-if=editMode class="col-xs-12 col-md-6"><div class=form-group sf-schema=myschema sf-form=secondForm sf-model=mol.custom_fields sf-options="{ feedback: { \'glyphicon\': true, \'glyphicon-asterisk\': form.required && !hasSuccess() && !hasError() , \'glyphicon-remove\': hasError() } }"></div></div></div><div class=spacer></div><div class=col-xs-12 ng-show="mol.uncurated_fields | notEmpty"><div class=col-xs-12><h2 class="nexa blue">Supplementary Data</h2></div><div class=col-xs-6 ng-repeat="(name, value) in mol.uncurated_fields"><button-input copy-model=::value disabled label=::name></button-input></div></div></div></div><button ng-disabled=!projectObj.editor type=submit ng-show=false value=Submit id=inputFormButton class="btn btn-primary" form=inputForm ng-click="closeInstance = true">Update and Close</button></form></div><div class=modal-footer><button ng-disabled=!projectObj.editor type=submit ng-show=editMode value=Submit class="btn btn-primary" form=inputForm ng-click="closeInstance = true; document.getElementById(\'inputFormButton\').click()">Update and Close</button> <button class="btn btn-danger" ng-click="$dismiss(\'cancel\')" type=button>Close <span ng-show=editMode>and Discard Changes</span></button></div>'),a.put("views/templates/single-field.html",'<div class=modal-body><div ng-if=singleForm class=form-group sf-schema=::myschema sf-form=::singleForm sf-model=mol.customFields></div><div ng-if=!singleForm class="alert alert-warning">Field is not present in the project to which this compound belongs.</div></div><div class=modal-footer><button class="btn btn-danger" ng-click="modalInstance.dismiss(\'cancel\');">Close <span ng-show=singleForm>and Discard Changes</span></button> <button class="btn btn-primary" ng-disabled=!projectObj.editor ng-click=updateBatch(modalInstance);>Update and Close</button></div>'),a.put("views/templates/validation-compounds.html",""),a.put("views/templates/validation-pills.html",'<button class="btn btn-lg" style="min-height:100px; width:13.93%; margin-right:5px" ng-repeat="item in validationItems" ng-class=item.class ng-click=item.filter()><div class=row><info-box class=pull-right style="margin-top:-5px; margin-right:5px" left=false lookup={{item.message}} lookupitems=cbh.messages></info-box></div><div class=row><div ng-show=filesInProcessing class="col-centered bubblingG"><span id=bubblingG_1></span> <span id=bubblingG_2></span> <span id=bubblingG_3></span></div><div class="col-xs-12 report-value" ng-hide=filesInProcessing><strong>{{datasets[current_dataset_id].config[item.reference]}}</strong></div><div ng-hide=filesInProcessing class=col-xs-12>{{item.name}}<span class="glyphicon glyphicon-filter"></span></div></div></button>'),a.put("views/templates/validation.html",'<div class=col-xs-12><div class="col-xs-4 col-sm-4"><div ng-class=fullPage class=col-xs-6><div class="validate-report-box first col-xs-12 alert-success"><div class=report><div style=margin-right:5px class=pull-right><info-box left=true lookup=batch_reg_new_to_chemireg_other lookupitems=cbh.messages></info-box></div><div class="col-xs-5 report-value"><strong class=nexa>{{datasets[current_dataset_id].validated.new}}</strong></div><div class="col-xs-7 report-type text-center"><strong class=nexa>New<br>structures</strong></div></div></div></div><div ng-class=fullPage class=col-xs-6><div class="validate-report-box overlap col-xs-12 alert-info"><div class=report><div style=margin-right:5px class=pull-right><info-box left=true lookup=batch_prereg_to_project_other lookupitems=cbh.messages></info-box></div><div class="col-xs-5 report-value"><strong class=nexa>{{datasets[current_dataset_id].validated.blinded}}</strong></div><div class="col-xs-7 report-type text-center"><strong class=nexa>Without<br>structures</strong></div></div></div></div></div><div class="col-xs-4 col-sm-4"><div ng-class=fullPage ng-hide=single class=col-xs-6><div class="validate-report-box dupe col-xs-12"><div class="report text-center"><div style=margin-right:-10px class=pull-right><info-box left=true lookup=batch_overlaps lookupitems=cbh.messages></info-box></div><div class="report-type alert-warning"><strong class=nexa>Duplicates</strong></div><div class="report-value alert-warning"><strong class=nexa>{{validatedData.dupes}}</strong></div></div><div ng-class=fullPage ng-hide=single class=col-xs-6><div class="validate-report-box dupe col-xs-12 alert-warning"><div class=report><div style=margin-right:-10px class=pull-right><info-box left=true lookup=batch_duplicates lookupitems=cbh.messages></info-box></div><div class="col-xs-5 report-value"><strong class=nexa>{{datasets[current_dataset_id].validated.dupes}}</strong></div><div class="col-xs-7 report-type text-center"><strong class=nexa>Duplicate structures</strong></div></div></div></div></div><div class="col-xs-4 col-sm-4"><div ng-class=fullPage class=col-xs-6><div class="validate-report-box error col-xs-12"><div class="report text-center"><div style=margin-right:5px ng-show=single class=pull-right><info-box left=true lookup=batch_errors_single lookupitems=cbh.messages></info-box></div><div style=margin-right:5px ng-hide=single class=pull-right><info-box left=true lookup=batch_errors_other lookupitems=cbh.messages></info-box></div><div class="report-type alert-danger"><strong class=nexa>Errors</strong></div><div class="report-value alert-danger"><strong class=nexa>{{validatedData.errors}}</strong></div><div class="validate-report-box error col-xs-12 alert-danger"><div class=report><div style=margin-right:-10px ng-show=single class=pull-right><info-box left=true lookup=batch_errors_single lookupitems=cbh.messages></info-box></div><div style=margin-right:-10px ng-hide=single class=pull-right><info-box left=true lookup=batch_errors_other lookupitems=cbh.messages></info-box></div><div class="col-xs-5 report-value"><strong class=nexa>{{datasets[current_dataset_id].validated.errors}}</strong></div><div class="col-xs-7 report-type text-center"><strong class=nexa>Structure<br>Errors</strong></div><div ng-show="validatedData.errors > 0 && !single">at positions <span ng-repeat="error in datasets[current_dataset_id].validated.fileerrors"><span ng-show=$first>{{error.index}}</span> <span ng-show="!$last && !$first">, {{error.index}}</span> <span ng-show="$last && !$first">and {{error.index}}</span> <span ng-show=$last>when counting from the top.</span></span></div></div></div></div><div ng-class=fullPage class=col-xs-6><div class="validate-report-box error col-xs-12 alert-danger"><div class=report><div style=margin-right:-10px class=pull-right><info-box left=true lookup=field_errors_other lookupitems=cbh.messages></info-box></div><div class="col-xs-5 report-value"><strong class=nexa>{{datasets[current_dataset_id].validated.field_errors}}</strong></div><div class="col-xs-7 report-type text-center"><strong class=nexa>Field<br>Errors</strong></div></div></div></div></div></div></div></div></div></div>'),a.put("views/templates/validation_table.html",'<div class="row animate-show" id=compound-data-breakdown ng-show=toggleDataSummary.showFlag><div class=data-summary-holder style=margin-right:20px ng-class="proj.project_type.show_compounds == true ? \'col-md-5 col-md-offset-1\' : \'col-md-6 col-md-offset-3 \'"><div class=row><div class=col-xs-4><div class=text-center style="background-color:#038B14; border-radius: 20px"><span class=date-number style="display:inherit; line-height: 9vw">{{datasets[current_dataset_id].config.batchstats["total"]}}</span></div><small><h2 class="blue text-center">Uploaded<info-box right=true lookup=total_values lookupitems=cbh.messages></info-box><br>Records</h2></small></div><div class=col-xs-8><div class=row ng-if="proj.project_type.show_compounds == true"><div class="col-xs-3 symp-stat" style="background-color:#038B14;  border-radius: 10px"><h2>{{datasets[current_dataset_id].config.batchstats["withstructure"]}}</h2></div><div class=col-xs-6 style=padding:0><p class="nexa vw" style=padding-top:10px>with structures</p></div><div class="col-xs-3 pull-right" style="padding:10px 4px 0 0"><div class=pull-right><a ng-show="datasets[current_dataset_id].config.batchstats[\'withstructure\'] > 0" ng-click="cbh.toggleWarningsFilter(\'warnings.withstructure\')" class="btn btn-sm btn-default" ng-class="warningsFilter ==\'warnings.withstructure\' ? \'blue\' : \'lightgrey\'" title="Filter only records where there is a valid structure"><span class="glyphicon glyphicon-filter"></span></a><info-box lookup=valid_structure_values lookupitems=cbh.messages></info-box></div></div></div><div class=row ng-if="proj.project_type.show_compounds == true"><div class="col-xs-3 symp-stat" style="background-color:#038B14; border-radius: 10px"><h2>{{datasets[current_dataset_id].config.batchstats["withoutstructure"]}}</h2></div><div class=col-xs-6 style=padding:0><p class="nexa vw" style=padding-top:10px>without structures</p></div><div class="col-xs-3 pull-right" style="padding:10px 4px 0 0"><div class=pull-right><a ng-show="datasets[current_dataset_id].config.batchstats[\'withoutstructure\'] > 0" ng-click="cbh.toggleWarningsFilter(\'warnings.withoutstructure\')" class="btn btn-sm btn-default" ng-class="warningsFilter ==\'warnings.withoutstructure\' ? \'blue\' : \'lightgrey\'" title="Filter only records where there is no structure"><span class="glyphicon glyphicon-filter"></span></a><info-box lookup=no_valid_structure_values lookupitems=cbh.messages left=false></info-box></div></div></div><div class=row><div class="col-xs-3 symp-stat" style="background-color:#038B14; border-radius: 10px"><h2>{{datasets[current_dataset_id].config.batchstats["parseerrors"]}}</h2></div><div class=col-xs-6 style=padding:0><p class="nexa vw" style=padding-top:10px>not processed</p></div><div class="col-xs-3 pull-right" style="padding:10px 4px 0 0"><div ng-class="proj.project_type.show_compounds == true ? \'pull-right\' : \'\'"><a ng-show="datasets[current_dataset_id].config.batchstats[\'parseerrors\'] > 0" ng-click="cbh.toggleWarningsFilter(\'warnings.parseerror\')" class="btn btn-sm btn-default" ng-class="warningsFilter ==\'warnings.parseerror\' ? \'blue\' : \'lightgrey\'" title="Filter only records where the structure cannot be processed"><span class="glyphicon glyphicon-filter"></span></a><info-box lookup=error_total_values lookupitems=cbh.messages></info-box></div></div></div></div></div></div><div class="col-md-5 data-summary-holder" style=margin-right:20px ng-if="proj.project_type.show_compounds == true"><div class=row><div class=col-xs-4><div class=text-center style="background-color:rgb(207,122,48); border-radius: 20px"><span class=date-number style="display:inherit; line-height: 9vw">{{datasets[current_dataset_id].config.compoundstats["total"]}}</span></div><small><h2 class="blue text-center">Unique<info-box lookup=inchi_matching lookupitems=cbh.messages></info-box><br>Compounds</h2></small></div><div class=col-xs-8><div class=row><div class="col-xs-3 symp-stat" style="background-color:rgb(207,122,48); border-radius: 10px"><h2>{{datasets[current_dataset_id].config.compoundstats["new"]}}</h2></div><div class=col-xs-6 style=padding:0><p class="nexa vw" style=padding-top:10px>new to this project</p></div><div class="col-xs-3 pull-right" style="padding:10px 4px 0 0"><div class=pull-right><a ng-show="datasets[current_dataset_id].config.compoundstats[\'new\'] > 0" ng-click="cbh.toggleWarningsFilter(\'warnings.new\')" class="btn btn-sm btn-default" ng-class="warningsFilter ==\'warnings.new\' ? \'blue\' : \'lightgrey\'" title="Filter only records new to this project"><span class="glyphicon glyphicon-filter"></span></a><info-box lookup=new_to_chemireg lookupitems=messages></info-box></div></div></div><div class=row><div class="col-xs-3 symp-stat" style="background-color:rgb(207,122,48); border-radius: 10px"><h2>{{datasets[current_dataset_id].config.compoundstats["overlaps"]}}</h2></div><div class=col-xs-6 style=padding:0><p class="nexa vw" style=padding-top:10px>overlaps</p></div><div class="col-xs-3 pull-right" style="padding:10px 4px 0 0"><div class=pull-right><a ng-show="datasets[current_dataset_id].config.compoundstats[\'overlaps\'] > 0" ng-click="cbh.toggleWarningsFilter(\'warnings.overlap\')" class="btn btn-sm btn-default" ng-class="warningsFilter ==\'warnings.overlap\' ? \'blue\' : \'lightgrey\'" title="Filter only records where the structure overlaps with existing AssayReg records"><span class="glyphicon glyphicon-filter"></span></a><info-box lookup=project_match_values lookupitems=cbh.messages></info-box></div></div></div><div class=row ng-show="(datasets[current_dataset_id].config.compoundstats[&quot;duplicateoverlaps&quot;] + datasets[current_dataset_id].config.compoundstats[&quot;duplicatenew&quot;]) > 0" style=padding:0><div class=col-xs-1></div><div class=col-xs-8 style="padding:10px 0 0 0"><p class="nexa vw">Duplicates were found</p></div><div class="col-xs-3 pull-right" style="padding:10px 4px 0 0"><div class=pull-right><a ng-click="cbh.toggleWarningsFilter(\'warnings.duplicate\')" class="btn btn-sm btn-default" ng-class="warningsFilter ==\'warnings.duplicate\' ? \'blue\' : \'lightgrey\'" title="Filter only records that are duplicated in the uploaded data"><span class="glyphicon glyphicon-filter"></span></a><info-box lookup=chemireg_match_values lookupitems=cbh.messages></info-box></div></div></div><div class=row style=padding:0 ng-show="(datasets[current_dataset_id].config.compoundstats[&quot;duplicateoverlaps&quot;] + datasets[current_dataset_id].config.compoundstats[&quot;duplicatenew&quot;]) == 0"><div class=col-xs-1></div><div class=col-xs-8 style="padding:10px 0 0 0"><p class="nexa vw">No duplicates found in uploaded data</p></div><div class="col-xs-3 pull-right" style="padding:10px 4px 0 0"><div class=pull-right><info-box class=pull-right lookup=duplicate_count_values lookupitems=cbh.messages></info-box></div></div></div></div></div></div></div>'),a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/add-compounds2.html",'<div ng-show=currentlyLoading id=loading-overlay></div><div ng-show=currentlyLoading id=loading-message><img src=images/loader-white.5de310f6.gif><br><p class=nexa style=color:white><small>loading...</small></p></div><div flow-init=flowinit flow-name=filedata.flow flow-files-submitted="currentlyLoading = true; $flow.upload()" flow-file-success="assignFile($file.uniqueIdentifier, $file.getExtension())" flow-upload-started="filesUploading=true" flow-complete="filesUploading=false"><div class=col-xs-12><div class=col-xs-12><div class=spacer></div><div class=row><div class=col-xs-12><a ui-sref=cbh.projects.list><h2 class="nexa blue"><small><span class="glyphicon glyphicon-circle-arrow-left"></span>&nbsp;Back to project list</small></h2></a></div></div><div class=spacer></div></div><tabset class=col-xs-12><tab heading="Add {{proj.project_type.show_compounds == true ? \'compounds\' : \'items\' }} to {{proj.name}}"><div class=row ng-hide=dataReady><div class=col-sm-6><div class=row><label for=file_input class=blue><strong class=nexa>Drag and drop your files here</strong></label><info-box style="margin-top:-5px; margin-right:5px" right=true lookup=file_upload_help_text lookupitems=cbh.messages></info-box></div><div flow-drop flow-drag-enter="style={border:\'4px dashed green\', padding: \'10px\'}" flow-drag-leave="style={border:\'4px dashed #ddd\', padding: \'10px\'}" ng-style="style={border:\'4px dashed #ddd\', padding: \'10px\'}" class="col-sm-9 col-lg-10" style=min-height:50px><div ng-repeat="file in $flow.files" style="margin-bottom:0px; min-height:40px">{{file.name | limitTo : 40}}</div><div style="margin-bottom:0px; min-height:40px" ng-show="$flow.files.length == 0">No files uploaded</div><div ng-if="(datasets[current_dataset_id].config.type===\'file\')" class="alert alert-danger" ng-repeat="error in datasets[current_dataset_id].config.errors">{{error}}</div><div ng-if="(datasets[current_dataset_id].config.type===\'file\') && datasets[current_dataset_id].config.errors.length > 0" class="alert alert-primary">If you would like more information about why this file may be erroring, please contact <a href="mailto:{{skinConfig.data_manager_email || \'adam.hendry@chembiohub.ox.ac.uk\'}}?subject=ChemBioHub%20ChemiReg%20file%20upload%20problem" class="btn btn-primary"><span class="glyphicon glyphicon-envelope"></span> {{skinConfig.data_manager_name || \'Adam Hendry\'}}</a>. Please remember to include the file or files you are experiencing difficulty with.</div></div><div class="col-sm-3 col-lg-2"><span flow-btn name=file_input role=btn class="btn btn-primary btn-sm pull-right nexa" ng-show="$flow.files.length < 1">Upload</span> <a ng-show="$flow.files.length > 0" ng-click="file.cancel(); cancelFile(); $flow.files=[];" class="btn btn-sm btn-danger pull-right" role=btn>Remove</a></div><div class="col-xs-12 mt"><p class="nexa blue"><small>Not sure what to upload?&nbsp; <a class="btn btn-default" ng-href="{{proj.custom_field_config.resource_uri}}/?format=xlsx">Download an XLSX template</a></small></p></div></div><div class=col-sm-6 ng-show=skinConfig.enable_smiles_input><div class=row><label for=text_input class="blue text-center"><strong class=nexa>Paste your SMILES or Standard InChIs here</strong></label><info-box right=true lookup=smiles_field lookupitems=cbh.messages></info-box></div><div class="form-group col-sm-9 col-lg-10"><div ui-ace ng-model=inputData.inputstring class=form-control style=height:70px></div><div ng-if="(datasets[current_dataset_id].config.type===\'smilesdata\')" class="alert alert-danger" ng-repeat="error in datasets[current_dataset_id].config.errors">{{error}}</div></div><div class="form-group col-sm-3 col-lg-2"><button ng-click=processSmilesData() class="btn btn-sm btn-primary pull-right">Process</button></div><div class=row data-ng-show=format_not_detected><div class="alert alert-danger" id=format_not_detected>{{messages.format_not_detected}}</div></div></div></div><div ng-if=dataReady><div class=row><a role=button class="pull-right btn btn-default" ng-click="toggleDataSummary.showFlag = !toggleDataSummary.showFlag"><span ng-show=!toggleDataSummary.showFlag><span class="glyphicon glyphicon-plus-sign"></span> Show Data Summary</span><span ng-show=toggleDataSummary.showFlag><span class="glyphicon glyphicon-minus-sign"></span> Hide Data Summary</span></a><h2 class="nexa blue"><span class="glyphicon glyphicon-list"></span>&nbsp;Data summary</h2><div class=col-xs-12 ng-include="\'views/templates/validation_table.html\'"></div><div class=row><div class=col-xs-12><div class="alert alert-info text-center"><div class=pull-right style=margin-top:-6px><button ng-click=cancelFile() class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span> Start again</button> <button ng-show="stateName == \'cbh.projects.project.addcompounds\'" ng-hide="compoundBatches.savestats.newbatches == 0" ng-click=saveTemporaryCompoundData() class="btn btn-success"><span class="glyphicon glyphicon-ok"></span> Save these records</button> <button ng-show="stateName == \'cbh.projects.project.addcompounds\'" disabled ng-hide="compoundBatches.savestats.newbatches > 0" ng-click=saveTemporaryCompoundData() class="btn btn-success"><span class="glyphicon glyphicon-ok"></span> Save these records</button></div><div><strong class=nexa><ng-pluralize count=compoundBatches.savestats.newbatches when="{\'0\': \'0 new batches \',\n'+"                             'one': '1 new batch ',\n                              'other': '{} new batches '}\"></ng-pluralize>will be saved to the database and<ng-pluralize count=compoundBatches.savestats.ignoring when=\"{'0': '0 batches ',\n                             'one': '1 batch ',\n                              'other': '{} new batches '}\"></ng-pluralize>will be ignored.</strong></div><div ng-hide=\"compoundBatches.savestats.newbatches > 0\"><strong class=nexa>You must select at least 1 record as New Batch to be able to click Save.</strong></div></div></div></div></div><div class=row><h2 class=\"nexa blue\"><span class=\"glyphicon glyphicon-pencil\"></span>&nbsp;Edit and save your data below</h2><div class=col-xs-12 ng-include=\"'views/compound-list-new.html'\"></div></div></div></tab></tabset></div></div>"),a.put("views/add-data.html",'<div class=container><div class=row><div class=col-xs-12><a ui-sref=cbh.projects.list><h2 class="nexa blue"><small><span class="glyphicon glyphicon-circle-arrow-left"></span>&nbsp;Back to project list</small></h2></a></div></div><div class=row><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-plus-sign"></span> Add {{addition_name}}</h2></div></div><div class=row id=context-row><div class=col-cs-12><h2 class=blue><small>You are adding data to {{context_datapoint.data_type}}</small></h2></div></div><div class=row><div class=col-xs-12><div class=form-group sf-schema=edit_schema sf-form=edit_form sf-model=test_model.project_data></div></div></div><div class="row mt"><div class=col-xs-12><div class="form-group pull-right"><button type=button class="btn btn-danger" ng-click=addctrl.clearForm()><span class="glyphicon glyphicon-remove-circle"></span> Cancel</button> <button type=submit class="btn btn-primary" ng-click=addctrl.submitForm()><span class="glyphicon glyphicon-share"></span> Submit</button></div></div></div></div>'),a.put("views/add-single-compound.html",'<div class=container-flex><div class=row><div class=col-xs-12 style=margin:20px><h2 class=blue>{{(idToClone ? \'Clone\' : \'Add\')}} Single Compound<br><small>If you want to add more than one compound at a time via SD or Excel, please use <a ui-sref="cbh.projects.project.addcompounds({projectKey: projectKey})">this form</a></small></h2></div></div><div class=row><form novalidate name=inputForm role=form id=inputForm style="width:95%; display: table; margin: 0 auto" ng-submit=validateOtherFormData(inputForm)><div class=row><div class=col-sm-6><div class=col-lg-12><chemdoodlewrapper ng-if=mol molfile=mol.molecule elementid="\'chemdoodle_compound_adder\'"><canvas id=chemdoodle_compound_adder></canvas></chemdoodlewrapper></div><div class=row id=warnings ng-if="dataset.config.errors.length > 0"><div class=col-xs-12><p class="nexa text-danger bg-danger"><strong>It looks like you have drawn an invalid structure - please check and click Validate Compound again if you make any changes.</strong></p></div></div><div class=row id=all-okay ng-if="dataset.config.errors.length == 0 && mol.molecule != \'\' && dataset.config.compoundstats.overlaps > 0"><div class=col-xs-12><p class="nexa text-primary bg-primary"><strong>This structure has been entered before - you can still save it and it will be assigned a new batch ID.</strong></p></div></div><div class=row id=all-okay ng-if="dataset.config.errors.length == 0 && mol.molecule != \'\' && dataset.config.compoundstats.overlaps == 0"><div class=col-xs-12><p class="nexa text-success bg-success"><strong>No problem with your structure and no overlap found.</strong></p></div></div></div><div class=col-sm-6><div class=row><div class=col-xs-12 ng-if="myschema.properties | notEmpty"><h2 class=blue>Project Fields<br><small>Add data specific to this project here. This data WILL be searchable within the ChemBio Hub Platform.</small></h2><div class=col-xs-12><div class=form-group sf-schema=myschema sf-form=myform sf-model=mol.customFields></div></div></div><div class=col-xs-12><h2 class="nexa blue">Supplementary Data<br><small>Add extra data specific to this compound here. This data WILL NOT be searchable within the ChemBio Hub Platform</small></h2><div class=row ng-repeat="custom_field in mol.supplementaryFields" style=margin-top:10px><div class="col-xs-5 col-md-3 custom-field-key"><input class=form-control placeholder="Field Name" id=custom_field_name_{{custom_field.id}} name=custom_field_name_{{custom_field.id}} ng-model=custom_field.name></div><div class="col-xs-6 col-md-8 custom-field-value"><input name=custom_field_value_{{custom_field.id}} id=custom_field_value_{{custom_field.id}} class=form-control placeholder=Value ng-model=custom_field.value></div><div class=col-xs-1 ng-click=removeSupplemetaryField(custom_field.id)><span class="glyphicon glyphicon-minus-sign text-danger" title="Remove this field"></span></div></div><div class="row text-center mt"><a ng-click=addSupplementaryField() class="btn btn-primary" role=button><span class="glyphicon glyphicon-plus-sign"></span> Add Supplementary Data Field</a></div></div></div></div></div><div class=row ng-if=!inputForm.$valid><div class="help-block col-xs-12 text-center"><p class="nexa text-danger"><strong>{{errormess}}</strong></p></div></div><div class="row mt"><div class=col-xs-12><div class=pull-right><button type=button ng-show="mol.molecule == \'\'" disabled class="btn btn-lg btn-primary"><span class="glyphicon glyphicon-ok"></span> Validate compound</button> <button type=button ng-show="mol.molecule != \'\' && ! dataReady" ng-click=validateDrawn(); class="btn btn-lg btn-primary"><span class="glyphicon glyphicon-ok"></span> Validate compound</button> <button ng-show="idToClone && mol.molecule != \'\' && dataReady && dataset.config.errors.length == 0" value=Submit class="btn btn-lg btn-primary"><span class="glyphicon glyphicon-share" ng-click="doArchiveItem = true"></span><span class="glyphicon glyphicon-ok"></span>Save compound and archive cloned compound</button> <button ng-show="mol.molecule != \'\' && dataReady && dataset.config.errors.length == 0" class="btn btn-lg btn-success"><span class="glyphicon glyphicon-share" ng-click="doArchiveItem = false"></span><span class="glyphicon glyphicon-ok"></span>Save compound</button> <button type=button ng-click=revert() class="btn btn-lg btn-danger"><span class="glyphicon glyphicon-remove"></span> {{(idToClone ? \'Revert to cloned\' : \'Clear form\')}}</button></div></div></div><a id=search-bottom></a></form></div></div>'),
a.put("views/add_plate.html",'<div class="container-fluid mt"><div class=col-xs-12><div class=row><h2 class=blue>Add Plate<br><small>Add a new plate map with empty wells. To see a list of plate maps for this project, click here</small> <a ui-sref="cbh.projects.project.listplates({projectKey: projectKey})" class="btn btn-primary" role=button>Show Plates</a></h2><div class=container-flex><div ng-if=errormess class=col-xs-12><div class="col-xs-12 has-error"><div class=help-block>{{errormess}}</div></div></div><form novalidate name=inputForm role=form style="width:95%; display: table; margin: 0 auto"><fieldset ng-disabled=showPlate><div class=row sf-schema=projectObj.schemaform.schema sf-form=projectObj.schemaform.form sf-model=newPlateForm></div></fieldset></form></div><div class=row><div class="col pull-right"><button class="btn btn-danger" ng-click=clearForm(inputForm)>Clear Form</button> <button class="btn btn-success" ng-click=setupNewPlateFromForm(inputForm)>Create New Plate</button></div></div><div class=row ng-if=showPlate><h2 class=blue>Assign Wells<br><small>Click a well to show assigning options. Red is the currently selected well. Green wells have data associated which you can edit.</small></h2><platemap plate=newPlateForm sfh=schemaFormHolder cbh=cbh save-plate-function=saveWholePlate()></platemap></div></div></div></div>'),a.put("views/assayupload.html",'<div flow-init=flowinit flow-name=dpclassif.filedata.flow flow-files-submitted=$flow.upload() flow-file-success=dpclassif.getSheetsForFile($file.uniqueIdentifier) flow-upload-started="" flow-complete="dpclassif.filesUploading=false"><div class=row><div class="col-sm-6 col-xs-offset-2"><div class=row style=margin-top:20px><div class=col-xs-12><label for=file_input class=blue><strong class=nexa><span style="color:#eee; background-color:#002147; padding:5px; border-radius:5px">Adding {{dpclassif.next_level_cfc.data_type.plural}}</span> {{dpclassif.main_data.project_data.Title}} Drag and drop your files here or click Upload to browse for a file</strong></label><info-box style="margin-top:-5px; margin-right:5px" right=true lookup=assay_file_upload_help_text lookupitems=cbh.messages></info-box><div flow-drop flow-drag-enter="style={border:\'4px dashed green\', padding: \'10px\'}" flow-drag-leave="style={border:\'4px dashed #ddd\', padding: \'10px\'}" ng-style="style={border:\'4px dashed #ddd\', padding: \'10px\'}" class="col-sm-9 col-lg-10" style=min-height:50px><div ng-repeat="file in $flow.files" style="margin-bottom:0px; min-height:40px">{{file.name | limitTo : 40}}</div><div style="margin-bottom:0px; min-height:40px" ng-show="$flow.files.length == 0">No files uploaded</div><div ng-if="(datasets[current_dataset_id].config.type===\'file\')" class="alert alert-danger" ng-repeat="error in datasets[current_dataset_id].config.errors">{{error}}</div></div></div></div><div class=row style=margin-top:10px><div class="col-xs-12 pull-left"><a ng-click="file.cancel(); cancelFile(); $flow.files=[]; dpclassif.cancelFile(); dpclassif.addingMultiple = false;" class="btn btn-sm btn-danger" role=button>Cancel</a> <a ng-show="$flow.files.length > 0" ng-click="file.cancel(); cancelFile(); $flow.files=[]; dpclassif.cancelFile();" class="btn btn-sm btn-danger" role=button>Remove</a> <span flow-btn name=file_input role=btn class="btn btn-primary btn-sm nexa" ng-show="$flow.files.length < 1">Upload</span> <span ng-if=iamloading class=text-primary style=padding:8px>{{loadingMessage}}</span></div></div></div></div><div class=row ng-show=dpclassif.uploadData.uploaded><label for=tabs class=blue><strong class=nexa>Select the tab corresponding to the required sheet from your spreadsheet.</strong><info-box lookup=assay_file_use_template lookupitems=cbh.messages right=true></info-box></label><tabset><tab ng-repeat="sheet in dpclassif.uploadData.sheets" select=sheet.specifySheet()><tab-heading>{{sheet.name}}</tab-heading><div class=row ng-if=sheet.metadata.resource_uri><div class=col-xs-12><div class=pull-left><div ng-if="sheet.listOfUnmappedMandatoryFields.length > 0" class=alert-warning style=padding:10px><span class="glyphicon glyphicon-warning-sign"></span> <small>There are unmapped mandatory fields in your file</small></div><div ng-if="sheet.totalUnmapped == 0" class=alert-warning style=padding:10px><span class="glyphicon glyphicon-warning-sign"></span> <small>None of the fields are mapped in your file, saving now would give empty records.</small></div><div ng-if="sheet.totalMappingErrors > 0" class=alert-danger style=padding:10px><span class="glyphicon glyphicon-warning-sign"></span> <small>There are fields with mapping errors due to invalid data or missing rows (for required fields).</small></div><div ng-if="sheet.listOfUnmappedMandatoryFields.length == 0 && sheet.totalUnmapped > 0" class=alert-success style=padding:10px><span class="glyphicon glyphicon-ok"></span> <small>All mandatory fields mapped</small></div></div><div class=pull-right><a ng-click="file.cancel(); cancelFile(); $flow.files=[]; dpclassif.cancelFile(); dpclassif.addingMultiple = false;" role=button class="btn btn-danger">Cancel</a> <a ng-if="sheet.listOfUnmappedMandatoryFields.length == 0 && sheet.totalMappingErrors == 0" ng-click=sheet.saveSheet(sheet.metadata.id) role=button class="btn btn-primary">Save this sheet</a> <a ng-if="sheet.listOfUnmappedMandatoryFields.length > 0 || sheet.totalMappingErrors > 0" role=button class="btn btn-primary disabled" ng-disabled=true>Save this sheet</a> <span ng-if="sheet.listOfUnmappedMandatoryFields.length > 0 && sheet.totalMappingErrors == 0"><info-box freetext="You have mandatory fields for this item which need to be mapped before you can save."></info-box></span> <span ng-if="sheet.listOfUnmappedMandatoryFields.length == 0 && sheet.totalMappingErrors > 0"><info-box freetext="You have data mapping errors which need to be corrected or ignored before you can save."></info-box></span> <span ng-if="sheet.listOfUnmappedMandatoryFields.length > 0 && sheet.totalMappingErrors > 0"><info-box freetext="You have data mapping errors which need to be correctted or ignored before you can save. You also have mandatory fields for this item which need to be mapped before you can save."></info-box></span></div></div></div><div class=row ng-if=sheet.metadata.resource_uri eui-index="\'cbh_attachments__\' + sheet.metadata.id" eui-sort="ejs.Sort(\'id\').order(\'asc\')" eui-enabled=true style="margin:5px 5px 0"><table class="table table-striped"><thead><tr><th class=text-center ng-repeat="item in sheet.metadata.attachment_custom_field_config.project_data_fields"><small>{{ item.elasticsearch_fieldname | removeSpaces }}</small><br><button class="tableFilter btn btn-default" ng-click=" dataoverviewctrl.showMappingPopup(sheet.metadata.titleMap, item, sheet)"><span class="glyphicon glyphicon-random" ng-class="{\'text-success\': item.attachment_field_mapped_to, \'text-danger\': item.attachment_field_unmappable_to, \'text-danger\': (!item.attachment_field_mapped_to && !item.attachment_field_unmappable_to)}"></span></button></th></tr></thead><tbody><tr ng-repeat="childItem in indexVM.results.hits.hits"><td class=text-center style="line-height:0.9 !important" ng-repeat="field in sheet.metadata.attachment_custom_field_config.project_data_fields"><small>{{childItem._source.attachment_data.project_data[field.elasticsearch_fieldname] | limitTo:100}}</small></td></tr><tr ng-if="indexVM.results.hits.hits.length == 0" class=text-center><td colspan="{{(1+ attachment_custom_field_config.project_data_fields.length)}}" class=text-center>No results</td></tr></tbody></table><div class=text-center><ul class=pager><li>{{indexVM.results.hits.total}} records</li><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=1">First</a></li><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=indexVM.page - 1">Previous</a></li><li>Page {{indexVM.page}} of {{indexVM.pageCount}}</li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.page + 1">Next</a></li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.pageCount">Last</a></li><li><select ng-model=indexVM.pageSize><option ng-repeat="item in [5, 10, 20]">{{item}}</option></select>per page</li></ul></div></div></tab></tabset></div></div><div class=row></div>'),a.put("views/cbh.html",'<div ng-include="\'views/templates/header.html\'"></div><!--[if lt IE 7]><p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p><![endif]--><div id=maincontainer style="width:98%; margin-left:1%"><div class=row style=margin-bottom:30px><div class=form-views id=show-everything-here2 ui-view></div></div></div>'),a.put("views/compound-list-new.html","<div><div ng-class=\"container-flex \"><div class=row><div class=col-xs-12><h2 class=subheading><ng-pluralize count=totalCompoundBatches when=\"{'0': '0 ' + cbh.skinning.result_alias + 's',\n             'one': '1 ' + cbh.skinning.result_alias,\n"+'              \'other\': \'{} \' + cbh.skinning.result_alias + \'s\'}"></ng-pluralize><span ng-if=warningsFilter>(filtered)</span> <span ng-if=noData>&nbsp; &nbsp; - &nbsp; &nbsp;{{noData}}</span></h2></div></div><a id=search-bottom></a><div ng-init="dropclass = \'dropdown\'" ng-include="\'views/templates/pagingbar.html\'"></div><div class=spacer></div><div ng-if=noData></div><div class=row><div class=col-xs-12><div ng-if=compoundBatches.columns id=myhot style=margin-top:5px><handsoncompoundtable uncurated-headers=compoundBatches.uncuratedHeaders sorts=compoundBatches.sorts cbh=cbh compounds=compoundBatches.data excluded=compoundBatches.excluded warnings-filter=warningsFilter redraw=compoundBatches.redraw columns=compoundBatches.columns searchform-schema=searchFormSchema search-form=searchForm show-blanks=compoundBatches.showBlanks show-non-blanks=compoundBatches.showNonBlanks messages=messages></handsoncompoundtable></div><table ng-show=""><tr dir-paginate="compoundBatch in compoundBatches.data | itemsPerPage: pagination.compoundBatchesPerPage.value" total-items=totalCompoundBatches current-page=pagination.current><td>{{ compoundBatch }}</td></tr></table></div><div ng-if="listOrGallery.choice == \'gallery\'"><div class=row><div class="col-xs-4 col-sm-2 col16-lg-2" dir-paginate="compoundBatch in compoundBatches.data | itemsPerPage: pagination.compoundBatchesPerPage.value" total-items=totalCompoundBatches current-page=pagination.current><div class="text-center gallery-item" ng-click=cbh.openSingleMol(compoundBatch)><img src=data:image/png;base64,{{compoundBatch.image}} style="cursor: pointer"><p class=nexa><small>{{compoundBatch.chemblId}}</small></p></div></div></div></div></div></div></div>'),a.put("views/compound-list-newv2.html","<div><div ng-class=\"container-flex \"><div class=row><div class=col-xs-12><h2 class=subheading><ng-pluralize count=totalCompoundBatches when=\"{'0': '0 ' + cbh.skinning.result_alias + 's',\n             'one': '1 ' + cbh.skinning.result_alias,\n              'other': '{} ' + cbh.skinning.result_alias + 's'}\"></ng-pluralize><span ng-if=noData>&nbsp; - &nbsp;{{noData}}</span></h2></div></div><a id=search-bottom></a><div ng-init=\"dropclass = 'dropdown'\" ng-include=\"'views/templates/pagingbar.html'\"></div><div class=spacer></div><div ng-if=noData></div><div class=row><div class=col-xs-12><div ng-if=\"listOrGallery.choice == 'list'\"><div ng-show=\"(cbh.changesToUndo.length > 0)\"><div class=\"alert alert-warning text-center\"><ng-pluralize count=cbh.changesToUndo.length when=\"{'0': '',\n                     'one': '1 item updated.',\n"+'                     \'other\': \'{} items updated.\'}"></ng-pluralize><button class="btn btn-danger pull-right" ng-click=undoChanges()><span class="glyphicon glyphicon-thumbs-down"></span> Undo</button></div><div class=spacer></div></div><div ng-if="addingData && cbh.projAddingTo.project_type.show_compounds == false"><div class=col-xs-12><h2 class=blue><small><span class="glyphicon glyphicon-plus"></span>Adding {{cbh.projAddingTo.project_type.show_compounds == true ? \'compounds\' : \'items\' }} to {{cbh.projAddingTo.name}}</small></h2></div><form name=myForm id=myForm role=form ng-submit=doSingleCompoundValidation(myForm)><div ng-repeat="form in formChunks" class="col-xs-12 col-sm-4"><div class=form-group sf-schema=myschema sf-form=form sf-model=newMol.custom_fields></div><div class=spacer></div></div><div class=row ng-if=!myForm.$valid><div class="help-block col-xs-12 text-center"><p class="nexa text-danger"><strong>{{errormess}}</strong></p></div></div><div class=row><div class=col-xs-12><div class=pull-right><button type=reset ng-click=blankForm(true); class="btn btn-primary"><span class="glyphicon glyphicon-ban-circle"></span>&nbsp;Close</button> <button type=reset ng-click=blankForm() class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span>&nbsp;Clear Form</button> <button type=submit value=Submit class="btn btn-primary" form=myForm ng-click="cbh.toggleAddingOff = true"><span class="glyphicon glyphicon-share"></span>Save</button> <button type=submit value=Submit class="btn btn-primary" form=myForm ng-click="cbh.toggleAddingOff = false"><span class="glyphicon glyphicon-share"></span>Save and add another</button></div></div></div></form></div><div id=myhot style=margin-top:5px><div class="hot-loading text-center" style=width:100%><img src=images/ring.c94e0cff.gif style="margin-top:100px; margin-left: auto; margin-right:auto"></div><handsoncompoundtablev2 uncurated-headers=compoundBatches.uncuratedHeaders sorts=compoundBatches.sorts cbh=cbh compounds=compoundBatches.data excluded=compoundBatches.excluded warnings-filter=warningsFilter redraw=compoundBatches.redraw columns=compoundBatches.tabular_data_schema searchform-schema=searchFormSchema search-form=searchForm show-blanks=compoundBatches.showBlanks show-non-blanks=compoundBatches.showNonBlanks messages=messages column=column></handsoncompoundtablev2></div><table ng-show=""><tr dir-paginate="compoundBatch in compoundBatches.data | itemsPerPage: pagination.compoundBatchesPerPage.value" total-items=totalCompoundBatches current-page=pagination.current><td>{{ compoundBatch }}</td></tr></table></div><div ng-if="listOrGallery.choice == \'gallery\'"><div class=row><div class="col-xs-4 col-sm-2 col16-lg-2" dir-paginate="compoundBatch in compoundBatches.data | itemsPerPage: pagination.compoundBatchesPerPage.value" total-items=totalCompoundBatches current-page=pagination.current><div class="text-center gallery-item" ng-click=cbh.openSingleMol(compoundBatch)><img src=data:image/png;base64,{{compoundBatch.image}} style="cursor: pointer"><p class=nexa><small>{{compoundBatch.chemblId}}</small></p></div></div></div></div><h2 class=subheading>&nbsp;</h2></div></div></div></div>'),a.put("views/data-overview.html",'<div ng-show=dataoverviewctrl.currentlyLoading id=loading-overlay></div><div ng-show=dataoverviewctrl.currentlyLoading id=loading-message><img src=images/loader.957018df.gif></div><div class=col-xs-12><div class=row><div class=col-xs-12><a ui-sref=cbh.projects.list><h2 class="nexa blue"><small><span class="glyphicon glyphicon-circle-arrow-left"></span>&nbsp;Back to project list</small></h2></a></div></div><div class=row><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-list"></span> {{assayctrl.proj.name}} Data Overview</h2></div></div><div class=row><div class=col-xs-12><div><div class=row><div ng-show=no_l0 class="col-xs-12 bg-success" style="border: 1px solid #444; padding:10px; border-radius:5px; margin-bottom:20px"><h2 ng-hide=dataoverviewctrl.no_l0_dfc class="nexa blue"><small><span class="glyphicon glyphicon-plus"></span>&nbsp;To get started, add more details about this project here</small></h2><h2 ng-show=dataoverviewctrl.no_l0_dfc class="nexa blue"><small><span class="glyphicon glyphicon-plus"></span>&nbsp;This project needs to be set up correctly in order to add data to it - please contact an administrator</small></h2><div class=row><div class=col-xs-12><div class=form-group sf-schema=assayctrl.l0_schema sf-form=assayctrl.l0_form sf-model=dataoverviewctrl.l0_object.l0.project_data></div></div></div><div class="row mt"><div class=col-xs-12><div class="form-group pull-right"><button type=button class="btn btn-danger" ng-click=dataoverviewctrl.l0_object.cancel()><span class="glyphicon glyphicon-remove-circle"></span> Cancel</button> <button ng-show=dataoverviewctrl.no_l0_dfc disabled type=submit class="btn btn-primary" ng-click=dataoverviewctrl.save_dpc(dataoverviewctrl.l0_object)><span class="glyphicon glyphicon-share"></span> Submit</button> <button ng-hide=dataoverviewctrl.no_l0_dfc type=submit class="btn btn-primary" ng-click=dataoverviewctrl.save_dpc(dataoverviewctrl.l0_object)><span class="glyphicon glyphicon-share"></span> Submit</button></div></div></div></div><div ng-show=!no_l0 class="col-xs-12 bg-success" style="border: 1px solid #444; padding:10px; border-radius:5px; margin-bottom:20px"><div class="pull-right button-group"><button id={{dataoverviewctrl.l0_object.id}} data-toggle=dropdown dropdown-toggle class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-plus-sign"></span> <span class="hidden-xs hidden-sm" title="Add {{dataoverviewctrl.l0_object.next_level_cfc.data_type.name}}">Add {{dataoverviewctrl.l0_object.next_data_type_name}} <span class=caret></span></span></button><ul style="margin-top: -22px" class=dropdown-menu role=menu aria-labelledby={{dataoverviewctrl.l0_object.id}}><li ng-repeat="newdfc in dataoverviewctrl.l0_object.dfc_full.full_permitted_children" role=menuitem><a ng-click="dataoverviewctrl.l0_object.setChosenDataFormConfig(newdfc.resource_uri, true); ">Using {{newdfc[newdfc.last_level].name}} template</a></li></ul></div><div class=pull-left><small>{{assayctrl.l0_dfc[\'l0\'].data_type.name}}</small><br><strong class=nexa>{{dataoverviewctrl.l0_object.main_data.project_data.Title}}</strong></div><div class="button-group pull-left" style="margin-top:5px; margin-left:10px"><button class="btn btn-sm btn-primary" ng-click=dataoverviewctrl.openDetail(dataoverviewctrl.l0_object)><span class="glyphicon glyphicon-list"></span> View Details</button> <a role=button ng-click=dataoverviewctrl.openEditDetail(dataoverviewctrl.l0_object) class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-pencil"></span> Edit {{assayctrl.l0_dfc[\'l0\'].data_type.name}}</a></div></div></div></div></div></div><div ng-show=dataoverviewctrl.l0_object.addingChild><div class=row><div class=col-xs-12><div class=form-group sf-schema=dataoverviewctrl.l0_object.next_level_edit_schema sf-form=dataoverviewctrl.l0_object.next_level_edit_form sf-model=dataoverviewctrl.l0_object.new_next_level_model.project_data></div></div></div><div class="row mt"><div class=col-xs-12><div class="form-group pull-right"><button type=button class="btn btn-danger" ng-click=dataoverviewctrl.l0_object.cancel()><span class="glyphicon glyphicon-remove-circle"></span> Cancel</button> <button type=submit class="btn btn-primary" ng-click=dataoverviewctrl.l0_object.addChild()><span class="glyphicon glyphicon-share"></span> Submit</button></div></div></div></div><div class=row><div class=col-xs-12><div ng-repeat="dpclassif in dataoverviewctrl.l0_object.children" ng-include="\'views/templates/overview-drilldown.html\'"></div></div></div></div>'),a.put("views/demo-add.html","<div class=form-views ui-view></div>"),a.put("views/edit-data.html",'<div class=container><div class=row><div class=col-xs-12><a ui-sref=cbh.projects.list><h2 class="nexa blue"><small><span class="glyphicon glyphicon-circle-arrow-left"></span>&nbsp;Back to project list</small></h2></a></div></div><div class=row><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-plus-sign"></span> Edit {{addition_name}}</h2></div></div><div class=row><div class=col-xs-12><div class=form-group sf-schema=::edit_schema sf-form=::edit_form sf-model=test_model.project_data></div></div></div><div class="row mt"><div class=col-xs-12><div class="form-group pull-right"><button type=button class="btn btn-danger" ng-click=editctrl.clearForm()><span class="glyphicon glyphicon-remove-circle"></span> Cancel</button> <button type=submit class="btn btn-primary" ng-click=editctrl.submitForm()><span class="glyphicon glyphicon-share"></span> Submit</button></div></div></div></div>'),a.put("views/help-chemireg.html",'<div class="row mt"><div class="col-sm-8 col-sm-offset-2"><h2 class=blue id=chemireg-section>ChemiReg Help section<br><small>How-tos, information and FAQs</small></h2></div></div><div class=row><div class="col-sm-8 col-sm-offset-2"><h2 class=subheading>File Submission - What ChemiReg can and can’t accept currently</h2></div><div class="col-sm-5 col-sm-offset-2"><div class=row><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-ok-circle" style=color:#3c763d></span> ChemiReg can accept Excel .XLSX files (newer Office versions)</h2></div><div class=col-xs-12><div class=well><p class=nexa>The file must contain column headers in the top row, with all data organised in the relevant columns underneath. Figures and images cannot currently be accepted.</p><p class=nexa>The submitted Excel file may contain structural information. In this case, use the dropdown menu to select the column heading which containing structural information (eg. SMILES). This will ensure a compound structure is drawn in the system following submission.</p><p class=nexa>An Excel file may be submitted containing no structural information. In this case submit the file as the default “No structural information” using the available dropdown menu. This will assign each record with a unique ID as normal but with no structure information.</p><p class=nexa><a role=button class="btn btn-default" href=/files/faq/example-excel-file-with-structures.xlsx><span class="glyphicon glyphicon-floppy-disk"></span> Download</a> an example of an Excel file that could be registered in the system containing structural information.</p><p class=nexa><a role=button class="btn btn-default" href=/files/faq/example-excel-file-without-structures.xlsx><span class="glyphicon glyphicon-floppy-disk"></span> Download</a> an example of an Excel file that could be registered in the system containing NO structural information.</p></div></div><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-ok-circle" style=color:#3c763d></span> ChemiReg can accept .SDF files</h2></div><div class=col-xs-12><div class=well><p class=nexa>Most SDF files can be uploaded without issue.</p><p class=nexa><a role=button class="btn btn-default" href=/files/faq/example-SDF-file.sdf><span class="glyphicon glyphicon-floppy-disk"></span> Download</a> an example of an SDF file that could be registered in the system</p></div></div><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-ok-circle" style=color:#3c763d></span> ChemiReg can accept ChemDraw data when saved in SDF format</h2></div><div class=col-xs-12><div class=well><p class=nexa><em>To find out how to format your ChemDraw files to be saved to ChemiReg, please refer to the following help document.</em></p></div></div></div></div><div class=col-sm-3><div class=row><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-remove-circle" style=color:#a94442></span> What ChemiReg can’t do (yet):</h2></div><div class=col-xs-12><div class=well><p class=nexa>ChemiReg can’t register compounds containing R-groups.</p><p class=nexa>ChemiReg cannot currently register files containing images e.g. spectra data. This does not include structural information e.g. .SDF file structures are fine).</p><p class=nexa>Reaction pathways cannot currently be accepted.</p></div></div></div></div></div><div class=row><div class="col-sm-8 col-sm-offset-2"><h2 class=subheading>Archiving and restoring items and compounds</h2></div><div class="col-sm-8 col-sm-offset-2"><h2 class=blue>Can I archive items in my project which are no longer relevant or were added in error?</h2><p class=nexa><strong>Yes</strong>. To archive an item or items, on the Search Results page, select the Edit button at the top of the results grid. The first column will now contain an Archive/Restore button. Click this on any items you wish to archive.</p><h2 class=blue>Can I restore previously archived items in my project?</h2><p class=nexa><strong>Yes</strong>. To restore an item or items, on the Search Results page, select the Edit button at the top of the results grid. Now select the filter option in the first column header to "show only archived". Click on any items you wish to restore.</p></div></div><div class=row><div class="col-sm-8 col-sm-offset-2"><h2 class=subheading>Supported Browsers</h2></div><div class="col-sm-8 col-sm-offset-2 text-center"><img src=images/accepted-browsers.07c568e0.png></div></div><div class=spacer></div><div class=row><div class="col-sm-8 col-sm-offset-2"><h2 class=subheading><span class="glyphicon glyphicon-play-circle"></span> Video demos<br><small style=color:white>Short animations to demonstrate some of the things you can do with ChemiReg</small></h2></div><div class=row><div class="col-sm-8 col-sm-offset-2 giffer-holder"><img data-gifffer=images/add-compounds-v3.d5f96814.gif data-gifffer-width=1000 data-gifffer-height=500 style="margin:0 auto"></div></div><div class="row mt"><div class="col-sm-8 col-sm-offset-2 giffer-holder"><img data-gifffer=images/reg-single.f113f34a.gif data-gifffer-width=1000 data-gifffer-height=500></div></div></div><div class=spacer></div><script type=text/javascript>$(document).ready(function(){\n	Gifffer();\n});</script>'),a.put("views/help.html",'<div class="row mt"><div class="col-sm-8 col-sm-offset-2" style=padding-left:15px><h2 class=blue>ChemBio Hub platform Help section<br><small>How-tos, information and FAQs</small></h2></div></div><div class=row><div class="col-sm-8 col-sm-offset-2" data-spy=scroll style="position: relative"><div class=row><div class=col-xs-12><div class="well text-center"><em>Jump to</em>: <a ng-click="scrollTo(\'overview\')"><strong class=nexa>Data Overview</strong></a> | <a ng-click="scrollTo(\'adding-data\')"><strong class=nexa>Adding data</strong></a> | <a ng-click="scrollTo(\'searching\')"><strong class=nexa>Searching AssayReg</strong></a> | <a ng-click="scrollTo(\'chembl\')"><strong class=nexa>Depositing data to Chembl</strong></a> | <a ng-click="scrollTo(\'chemireg-section\')"><strong class=nexa>Adding Chemical Data</strong></a></div><h2 class=blue id=problem>What to do if you have a problem</h2><p><strong class="nexa blue">If you encounter a problem with AssayReg, and this help document does not provide the answer please use the AssayReg menu box to submit an issue - click the AssayReg logo and select <em>Report an Issue</em> Alternatively please email ChemBio Hub - <a href=mailto:info@chembiohub.ox.ac.uk role=button class="btn btn-default"><span class="glyphicon glyphicon-envelope"></span> info@chembiohub.ox.ac.uk</a></strong></p><h2 class=blue id=loggingin>Logging in and initial screen</h2><p>When you log onto AssayReg, you will see a list of the projects you have been given access to. If you think you should be able to access a project not shown in this list, please contact ChemBio Hub <a href=mailto:info@chembiohub.ox.ac.uk role=button class="btn btn-default"><span class="glyphicon glyphicon-envelope"></span> info@chembiohub.ox.ac.uk</a></p><p>Each project has a number of options available: <img src=images/help/project-list-item.4cc1ed5c.png class="img img-responsive center-block"><ul><li><strong>Assay</strong> - click <strong>Data Overview</strong> to be taken to the Project Data Overview page;</li><li><strong>Chem</strong> - you can <strong>Add Compounds</strong> if you have the correct permissions or <strong>Search Compounds</strong></li></ul></p><h2 class=blue id=overview>Project Data Overview</h2><p>For each project, there is a data overview page. This displays all of the data present in the project, separated out into three levels: <strong>Sub-Project</strong>, <strong>Assay</strong> and <strong>Activity</strong>.</p><h3 class=blue id=sections-explained>Project sections - an explanation</h3><p>Each Project contains 3 sections:<ul><li><strong>Sub-Project</strong> - A sub-project normally holds details for a collection of different assays, for example a set of different Characterisation experiments on a particular drug target.</li><li><strong>Assay</strong> - An assay normally holds details of experimental protocols and method development, for example data which needs to be provided to make the assay reproducible. Assays can belong to multiple different Sub-Projects.</li><li><strong>Activity</strong> - An activity holds the single outcome of an Assay, usually machine readouts or more qualitative data. Activity data is specific to a given Assay.</li></ul></p><h3 class=blue id=show-details>Show details</h3><p>You can see the data for a particular level by clicking the appropriate <strong>Actions</strong> button and clicking View Details. This will open a popup window.</p><p><img src=images/help/view-details.c5078e6d.png class="img img-responsive center-block"> <img src=images/help/details-modal.f8fb29d7.png class="img img-responsive center-block"></p><p></p><h3 class=blue>Editing</h3><p>If you have the correct privileges, you can edit data at the Project, Sub Project or Assay level. Click the appropriate <strong>Actions</strong> button and click Edit. A popup window will launch with editable fields containing the data. Make your changes and click <strong>Update and Close</strong>.</p><h3 class=blue>Duplicating</h3><p>If you have the correct privileges, you can duplicate data at the Project, Sub Project or Assay level. Click the appropriate <strong>Actions</strong> button and click Duplicate. A form will be displayed, similar to the Add Single form (discussed below), with editable fields containing the data. Make any changes, add new data if needed and click <strong>Submit</strong>. this will create a new entity which will be displayed in the Data Overview page.</p><h3 class=blue>Activity</h3><p>Activity data for a particular assay is displayed as a table. You can page through the data easily using the buttons at the bottom of the table. If your table contains a lot of columns, you can use the horizontal scrollbar.</p><p>Each row of the Activities table contains a <strong>Duplicate</strong> link in the first column. This allows you to add a new Activity record via the Add Single Activity form, with the data from this row prepopulated into the form. Adding Data is discussed in more depth below.</p><p>If your Activity data references a specific compound, an image of that structure will be shown, provided the UOX ID is registered in this project.</p><h3 class=blue>Filtering activities</h3><p><img src=images/help/filter-and-download.c87783f8.png class="img img-responsive center-block"></p><p></p><p>At the top of the Activities section is a filter text box. So for example, if you type "dichloro" into the text box, the Activities table will only show rows that contain "dichloro" in any of the columns.</p><h3 class=blue>Export</h3><p>The <strong>Download</strong> button allows you to download all the results in the table as an Excel file. To download all activity records, ensure the filter text box is blank. Any filteringapplied will be reflected in the exported file.</p><h2 class=blue id=adding-data>Adding data</h2><p>If you have the correct permissions, you can add data to the system through the AssayReg user interface.</p><h3 class=blue>Single record</h3><p>Adding a single record is the simplest means of getting data into the system. Click <strong>Add Single Activity</strong> and select the correct Assay template to use from the list shown.</p><p><img src=images/help/single-activity-button.1f39694f.png class="img img-responsive center-block"></p><p>A form is then displayed with a placeholder for each field defined in this specific assay. Some fields will be limited in what can be input- for example dates will show a datepicker/calendar field.</p><p><img src=images/help/single-activity.d08c2f20.png class="img img-responsive center-block"></p><p>When you have added the necessary data, click the Submit button. Your data will be saved and will be vsible in the Activity table.</p><h3 class=blue>Multiple records (via upload)</h3><p>You can add multiple records to AssayReg from an Excel file. To use an accurate list of all relevant fields for the specific assay you can download a template of the data format by clicking <strong>Upload Multiple Activities</strong> then click <strong>Download (activity) Template</strong>. You can then use this to add your data for a smooth upload.</p><p>If you have data in a different spreadsheet format, for example from another lab or from machine outputs, you can also upload that data but you may need to map some or all your data, which is explained later in this document.</p><p>For simple file uploads, follow these steps:<br><ul><li>Within the Sub-project and Assay you wish to register the data to, select ‘Upload Multiple Activities’. Select the Assay definition relevant to your data.<br><p><img src=images/help/multiple-activities-1.73c3e947.png class="img img-responsive center-block"><br></p></li><li>Drag your file into the space shown or click upload and choose your data file.<br><p><img src=images/help/multiple-activities-2.3d78ad12.png class="img img-responsive center-block"><br></p></li><li>If your file contains multiple tabs, select the relevant one. The data will be previewed below.<br><p><img src=images/help/multiple-activities-3.fae80d0d.png class="img img-responsive center-block"><br></p></li><li>If all mandatory fields which can\'t be mapped from your file, you can click ‘Save this sheet’. Your data is now registered to your project in AssayReg.<br><p><img src=images/help/multiple-activities-4.cba41036.png class="img img-responsive center-block"><br></p></li></ul></p><h3 class=blue>Data mapping</h3><p>If you are uploading data from a file containing supplementary data, you may have to specify which columns in your file correspond to which Activity columns. This is especially important where there are <em>mandatory</em> fields for the specified Activity - that is to say, fields which cannot be empty for a single result.</p><p>AssayReg uses data mapping to help with data integrity and also to allow conversion to formats required by public databases such as <a href=https://pubchem.ncbi.nlm.nih.gov/about.html target=_blank>PubChem</a> and <a href=https://www.ebi.ac.uk/chembl/ target=_blank>ChEMBL</a>.</p><h3 class=blue>Auto mapping</h3><p>AssayReg will attempt to "automap" your columns to the Activity columns. Columns in your file with a matching column in the Activity have a green mapping icon <span class="glyphicon glyphicon-random text-success"></span> . Columns in your file which cannot be automapped have a red mapping icon <span class="glyphicon glyphicon-random text-danger"></span> .</p><p>You will need to map a column in your file to an Activity column manually if the names are slightly different - for example, you may have a column called "1st Run" in your file and a column called "1st Observation" in the Activity table. They have the same meaning for your work but have been labelled differently. To do this, click the mapping icon in the column you want to map.<br></p><p><img src=images/help/filter-icon.2ee34559.png class="img img-responsive center-block"><br></p><p>A window wil display which will allow you to specify the field you wish to map to.</p><p><img src=images/help/mapping-popup.ecc57d78.png class="img img-responsive center-block"><br></p><h3 class=blue>Unmappable fields</h3><p>Unmappable fields are caused by data fields in your file not matching the type expected by AssayReg for the Assay you are adding to. For example, you may be mapping your column containing text descriptions to a column expecting numerical values or dates.</p><p>Unmappable fields are shown in the mapping popup window for a particular column. You will see a message stating that there is a data type conflict, and the rows causing the issue (together with the row value) are displayed in a table.</p><p><img src=images/help/unmappable-fields.bc023649.png class="img img-responsive center-block"></p><p>If this happens you should correct the data in your Excel file, and try uploading again. If you believe your data to be in the correct format, you should contact an AssayReg administrator. <a href=mailto:info@chembiohub.ox.ac.uk role=button class="btn btn-default"><span class="glyphicon glyphicon-envelope"></span> info@chembiohub.ox.ac.uk</a></p><h3 class=blue>Save</h3><p>Once all of your fields are mapped, you are able to click <strong>Save This Sheet</strong>. Your data will be saved, and will be visible in the activities table.</p><h2 class=blue id=searching>Search page</h2><p>AssayReg allows you to search for data across Projects, Sub-Projects and Assays via the Search Page. You can also carry out text searches via the search bar at the top of every page (including this one).</p><p>The search bar allows you to type text, with matches for that text displayed instantly below. If the text matches any value in Assay, Sub-Project or Project titles, you can click those links and see data for that item in the search page.</p><p><img src=images/help/searchbar.ee6abb23.png class="img img-responsive center-block"></p><p>You are also able to search for your text phrase easily on <a href=https://pubchem.ncbi.nlm.nih.gov/about.html target=_blank>PubChem</a> - just click the link at the bottom, a new window or tab will open in your browser and you will see results for your search displayed on the PubChem website.</p><p>The search results page is shown when you click the <strong>Go</strong> button next to the search bar or select an option below the search bar.</p><h3 class=blue>Filters</h3><p>The Search Page allows you to filter the results shown in a number of ways. Whenever a filter is used, the results are updated automatically. To remove all selections you\'ve made for a single filter, click <strong>Clear</strong> underneath the box.</p><h3 class=blue>Dates</h3><p>You can specify a date range for when records were added to the system - use the <strong>Activity Date From</strong> and <strong>Activity Date To</strong> calendar fields to specify your dates. Results are updated automatically. To remove a date selection, open the date popup and click Clear.</p><p><img src=images/help/date-popup.d6114cb2.png class="img img-responsive center-block"></p><h3 class=blue>User</h3><p>You can specify the user or users who uploaded the data you wish to see. Select the names of users from the dropdown list, and they will be displayed as a tag list in the search box. You can remove any users you have selected. Results are updated automatically.</p><h3 class=blue>Project / Sub-Project / Assay filtering</h3><p>You can specify the Project, Sub-Project or Assay the results belong to using the appropriate search fields. Pick the names of the Project/Sub-Project/Assay you want to narrow results down by from the dropdown list, and they are displayed as a tag list in the search box. You can remove items as you need to. Results are updated automatically.</p><h3 class=blue>Text filtering</h3><p>At the top of the Results table section, there is a text box which allows you to filter the Activities based on text entered here. So for example, if you type "dichloro" into the text box, the Activities table will only show rows that contain "dichloro" in any of the columns, in addition to any other filters you have applied via the search form.</p><h2 class=blue id=chembl>Depositing data to ChEMBL</h2><p><ul><li>AssayReg translates your data to the format required by <a href=https://www.ebi.ac.uk/chembl/ target=_blank>ChEMBL</a>. To view data in a ChEMBL format, use the Search page to find your data.</li><li>You are now in the AssayReg search page. On the data record you wish to export, click ‘View as ChEMBL data’<p><img src=images/help/chembl-1.bba775a6.png class="img img-responsive center-block"></p></li><li>Your activity data should now be visible as a JSON schema form. This is the format in which it will be deposited to ChEMBL - highlight the text, copy and paste into the ChEMBL submission form.<p><img src=images/help/chembl-2.5201d123.png class="img img-responsive center-block"></p></li></ul></p></div></div></div></div><div ng-include="\'views/help-chemireg.html\'"></div><div class=spacer></div>'),
a.put("views/img-template.html",'<div class="centered id-overlay"><a style=color:white ng-click=openSingleMol(row.getProperty(&quot;chemblId&quot;),row.getProperty(&quot;id&quot;))>{{row.getProperty("chemblId")}}</a></div><a><div class=centered><chemsvg properties="row.getProperty(\'properties\')" size="\'200\'" smiles="row.getProperty(\'ctab\')" base-url="\'https://chembiohub.ox.ac.uk/utils/ctab2image\'" substructure-match="row.getProperty(\'substructureMatch\')"></chemsvg></div></a>'),a.put("views/legend.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click="modalInstance.dismiss(\'cancel\');"><span aria-hidden=true class="glyphicon glyphicon-remove-circle"></span></button><h2 class="modal-title blue nexa">What do the headers mean?</h2></div><div class=modal-body><div class=row><div class=col-xs-12><dl class=dl-horizontal><dt ng-repeat-start="leg in legends">{{leg.name}}</dt><dd ng-repeat-end>{{leg.explanation}}</dd></dl></div></div></div><div class=modal-footer><button class="btn btn-danger" ng-click="modalInstance.dismiss(\'cancel\');">Close</button></div>'),a.put("views/list_plates.html",'<div class="container-fluid mt"><div class=col-xs-12><div class=row><h2 class=blue>Plate Maps<br><small>Plate maps currently in the system. To add a plate map to the project, click here</small> <a ui-sref="cbh.projects.project.addplate({projectKey: projectKey})" class="btn btn-primary" role=button>Add Plate</a></h2><div class=container-flex ng-init=loadPlateMaps()><div class=col-xs-8><dir-pagination-controls on-page-change=pageChanged(newPageNumber) max-size=5></dir-pagination-controls></div><table class="table table-responsive"><thead><tr><th ng-repeat="field in projectObj.custom_field_config.project_data_fields">{{field.edit_form.form[0].key}}</th><th>Added on</th><th>Edit</th></tr></thead><tbody><tr dir-paginate="plate in plates | itemsPerPage:5" current-page=pagination.current total-items=totalCount><td ng-repeat="field in projectObj.custom_field_config.project_data_fields">{{plate.custom_fields[field.edit_form.form[0].key]}}</td><td>{{plate.created | date: "d MMM yyyy"}}</td><td data-plate-id={{plate.id}}><span class="glyphicon glyphicon-pencil" ng-click=loadPlateForEditing(plate.id) style=cursor:pointer></span></td></tr><tr ng-if="plates.length == 0"><td colspan=6>no items</td></tr></tbody></table><div ng-if=showEditingForm><h2 class=blue>{{editingPlate.name}}</h2><platemap plate=editingPlate sfh=schemaFormHolder cbh=cbh save-plate-function=patchWholePlate() plate-saved=plateSaved></platemap></div></div></div></div></div>'),a.put("views/main.html",'<div class=jumbotron><h1>\'Allo, \'Allo!</h1><p class=lead><img src=images/yeoman.d2754b85.png alt="I\'m Yeoman"><br>Always a pleasure scaffolding your apps.</p><p><a class="btn btn-lg btn-success" ng-href=#>Splendid!<span class="glyphicon glyphicon-ok"></span></a></p></div><div class="row marketing"><h4>HTML5 Boilerplate</h4><p>HTML5 Boilerplate is a professional front-end template for building fast, robust, and adaptable web apps or sites.</p><h4>Angular</h4><p>AngularJS is a toolset for building the framework most suited to your application development.</p><h4>Karma</h4><p>Spectacular Test Runner for JavaScript.</p></div>'),a.put("views/modal-edit-project.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 ng-if="operation==\'update\'" class="modal-title blue">Editing {{proj.name}}</h3><h3 style=display:inline-block ng-if="operation==\'add\'" class="modal-title blue">Adding a new project</h3><div ng-if="operation==\'add\'" class=dropdown style=display:inline-block><button type=button class="btn btn-default" id=copyProjectButton class="btn btn-primary btn-toggle" data-toggle=dropdown><span class="glyphicon glyphicon-copy"></span> Copy project definition</button><ul class=dropdown-menu role=menu aria-labelledby=copyProjectButton><li><div class="form-group col-xs-12"><label>Filter project list:</label><input class=form-control placehoder="Search list" ng-model="psearch"></div></li><li ng-repeat="project in projects | filter: {\'name\': psearch}"><a ng-click=copyProjectDefinition(project.id)>Fields from {{project.name}}</a></li></ul></div></div><div class=modal-body><div class=row><div class=col-xs-12><form novalidate ng-submit=saveChanges(myForm) name=myForm id=myForm><div class=form-group sf-form=projectForm sf-schema=projectSchema sf-model=proj></div><div ng-if=isIE class=pull-right><button type=button class="btn btn-danger" ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span> Close and Discard Changes</button> <button type=submit value=Submit class="btn btn-primary" form=myForm><span class="glyphicon glyphicon-share"></span>Save Changes and Close</button></div></form></div><div ng-if=errormess class=col-xs-12><div class="col-xs-12 has-error"><div class=help-block>{{errormess}}</div></div></div></div></div><div class=modal-footer><div ng-if=!isIE><button type=button class="btn btn-danger" ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span> Close and Discard Changes</button> <button type=submit value=Submit class="btn btn-primary" form=myForm><span class="glyphicon glyphicon-share"></span>Save Changes and Close</button></div></div>'),a.put("views/modal-edit-template.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class="modal-title blue">More Information</h3></div><div class=modal-body><div class=row><div class=form-group></div><div class=col-xs-12><div class=form-group sf-schema=popup_data.this_level_edit_schema sf-form=popup_data.this_level_edit_form sf-model=popup_data.main_data.project_data></div></div></div></div><div class=modal-footer><button type=button class="btn btn-danger" ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span> Close and Discard Changes</button> <button type=submit class="btn btn-primary" ng-click=saveEdits()><span class="glyphicon glyphicon-share"></span> Update and Close</button></div>'),a.put("views/modal-project-permissions.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 style=display:inline-block class="modal-title blue">Editing user roles on {{proj.name}}</h3><div class=dropdown style=display:inline-block><button type=button class="btn btn-default" id=copyProjectButton class="btn btn-primary btn-toggle" data-toggle=dropdown><span class="glyphicon glyphicon-copy"></span> Copy roles from another project</button><ul class=dropdown-menu role=menu aria-labelledby=copyProjectButton><li><div class="form-group col-xs-12"><label>Filter project list:</label><input class=form-control placehoder="Search list" ng-model="psearch"></div></li><li ng-repeat="project in projects | filter: {\'name\': psearch, \'editor\': true }"><a ng-click=copyProjectPermissions(project.id)>Merge {{project.name}} roles</a></li></ul></div></div><div class=modal-body><div class=row><div class=col-xs-12 ng-repeat="role in projectPermissions.roles"><div class=form-group><label class=control-label>Project {{ role | titlecase }}s</label><ui-select multiple ng-model=projectPermissions[role].users theme=bootstrap><ui-select-match placeholder="&#9660;&nbsp;Select User..." ui-lock-choice="($item.is_logged_in && role==\'owner\')"><span ng-if="$item.first_name != \'\' && $item.last_name != \'\'">{{$item.first_name + \' \' + $item.last_name + ($item.inviting ? \' (inviting new)\' : \'\')}}</span><span ng-if="$item.first_name == \'\' && $item.last_name == \'\'">{{$item.username + ($item.inviting ? \' (inviting new)\' : \'\')}}</span></ui-select-match><ui-select-choices ui-disable-choice="u.is_logged_in || role==\'owner\' && !u.can_create_and_own_projects" repeat="u.resource_uri as u in allUsers | propsFilter: {display_name: $select.search}"><div><div ng-bind-html="(u.display_name | highlight: $select.search) + (u.inviting ? \' (inviting new)\' : \'\')"></div></div></ui-select-choices></ui-select><div ng-if="projectPermissions[role + \'_message\']" class=help-block>{{projectPermissions[role + \'_message\']}}</div></div><div ng-if=errormess class=col-xs-12><div class="col-xs-12 has-error"><div class=help-block>{{errormess}}</div></div></div></div></div></div><div class=modal-footer><button type=button class="btn btn-danger" ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span> Close and Discard Changes</button> <button type=button class="btn btn-primary" ng-click=saveChanges()><span class="glyphicon glyphicon-share"></span>Save Changes and Close</button></div>'),a.put("views/modal-template.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click=cancel()><span class="glyphicon glyphicon-remove-circle"></span></button><h3 class=modal-title>Details</h3></div><div class=modal-body><table class="table table-striped" style=table-layout:fixed ng-if="popup_data.main_cfc != \'chembl\'"><tr ng-repeat="form in popup_data.main_cfc.project_data_fields"><th colspan=1>{{form.name}}</th><td colspan=2 style=word-wrap:break-word><div ng-if="form.edit_schema.properties[form.elasticsearch_fieldname].format == \'file_upload\'" ng-init="uploads = popup_data.main_data.project_data[form.elasticsearch_fieldname].attachments; clickFunction = toggleExpand; imageFunction = fetchImage;" ng-include="\'views/templates/files-uploaded-view.html\'"></div><span ng-if="form.edit_schema.properties[form.elasticsearch_fieldname].format != \'file_upload\'" ng-bind-html=popup_data.main_data.project_data[form.elasticsearch_fieldname]></span></td></tr></table><pre ng-if="popup_data.main_cfc == \'chembl\'">{{popup_data | json}}</pre></div><div class=modal-footer><button class="btn btn-danger" type=button ng-click=cancel()>Close</button></div>'),a.put("views/no-projects.html","<div class=row><div class=col-xs-12><h2 class=blue>As a new user, you're only asigned to the demo and playground projects.</h2><p class=nexa>Use the demo project to view and search our demo dataset</p><p class=nexa>Use the playground project to test the system, adding compounds. Data will be deleted frequently.</p><p class=nexa>Site admins have been made aware that you are a new user and will assign you to projects shortly.</p><p class=nexa>You will then be able to view projects you are added to, submit compounds and search them.</p><p class=nexa>If you do have any queries or want to chase up the status of your projects, please email <strong><a href=mailto:info@chembiohub.ox.ac.uk>info@chembiohub.ox.ac.uk</a></strong>.</p></div></div>"),a.put("views/project-full.html","<div class=form-views ui-view></div>"),a.put("views/projects-list.html",'<div class=container><div class=col-xs-12><div class=row style=margin-top:10px><div class=col-xs-12><h2 class="blue nexa" style=display:inline-block><span class="glyphicon glyphicon-{{glyphicon}}"></span> &nbsp;<span style="text-transform: capitalize">{{headline}}</span></h2><p class=nexa style=display:inline-block;margin-bottom:0px><small><a ng-if=cbh.logged_in_user.can_create_and_own_projects ng-click=openProjectWindow(-1)><span class="glyphicon glyphicon-plus"></span> Add Project</a> <a ng-if=!cbh.logged_in_user.can_create_and_own_projects disabled class=disabled><span class="glyphicon glyphicon-plus"></span> Add Project</a></small><info-box ng-if=!cbh.logged_in_user.can_create_and_own_projects freetext="You do not have permission to create projects at this time. Please ask an administrator for details." right=true></info-box></p><h2 class="blue nexa"><small>{{subheading}}<info-box lookup=projects_help lookupitems=cbh.messages right=true></info-box></small></h2><span class="pull-right hidden-xs" style="margin-top: -40px; margin-right: -10px"><label>Filter project list:</label><input ng-model=search.name><info-box lookup=project_list_filter_help lookupitems=cbh.messages left=true></info-box></span></div></div><div class="row visible-xs"><div class="col-xs-12 text-center"><span style="margin-top: -40px; margin-right: -10px"><label>Filter project list:</label><input ng-model=search.name><info-box lookup=project_list_filter_help lookupitems=cbh.messages left=true></info-box></span></div></div><div class=row-flex><div class=flex-col><project-list></project-list></div></div><div ng-if="" ng-include="\'views/no-projects.html\'"></div><a id=search-bottom></a><div class=form-views ui-view=projectsummary></div><div class=form-views ui-view=newresults></div></div></div>'),a.put("views/projects.html","<div class=form-views ui-view></div>"),a.put("views/search.html","<div class=col-xs-12><div ui-view=form></div></div><div class=col-xs-12><div class=form-views ui-view=newresults></div></div>"),a.put("views/searchassays.html",'<div><div class=row style=margin-top:10px><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-search"></span> Search Assays<br><small>Narrow down assay results using the form below</small></h2></div></div><div style="width:95%; display: table;\n    margin: 0 auto" class=row><div class=row><div class=col-xs-4><div class=form-group><label class=control-label>Activity Created By User</label><ui-select multiple ng-model=userData.useruris theme=bootstrap><ui-select-match placeholder="&#9660;&nbsp;Select User..."><span ng-if="$item.first_name != \'\' && $item.last_name != \'\'">{{$item.first_name + \' \' + $item.last_name }}</span><span ng-if="$item.first_name == \'\' && $item.last_name == \'\'">{{$item.username }}</span></ui-select-match><ui-select-choices repeat="u.resource_uri as u in users"><div ng-if="u.first_name != \'\' && u.last_name != \'\'"><div ng-bind-html="u.first_name + \' \' + u.last_name"></div></div><div ng-if="u.first_name == \'\' && u.last_name == \'\'"><div ng-bind-html=u.username></div></div></ui-select-choices></ui-select><span class=pull-right><small><a ng-click=clearUserSelections()>Clear</a></small></span></div></div><div class=col-xs-4><div class=form-group><label class=control-label>Activity Date From</label><input class="form-control datepicker" ng-model=dates.start ng-change="dateHandler(\'start\')"></div></div><div class=col-xs-4><div class=form-group><label class=control-label>Activity Date To</label><input class="form-control datepicker" ng-model=dates.end ng-change="dateHandler(\'end\')"></div></div></div><div class=row><div class=col-xs-4><div class=form-group><label class=control-label>Projects</label><ui-select multiple ng-model=selections.l0 theme=bootstrap eui-index="\'cbh_queries\'" eui-enabled=true eui-filter="ejs.TermFilter(\'level_from\', \'l0\')"><span eui-query="ejs.MultiMatchQuery([\'l0.project_data_all\'], $select.search).type(\'phrase_prefix\')" eui-enabled=$select.search></span><ui-select-match placeholder="&#9660;&nbsp;Select Project...">{{$item._source.l0.project_data.Title}}</ui-select-match><ui-select-choices repeat="childItem._source.l0.resource_uri as childItem in indexVM.results.hits.hits"><div ng-bind-html=childItem._source.l0.project_data.Title></div></ui-select-choices></ui-select><span class=pull-right><small><a ng-click="clearSelections(\'l0\')">Clear</a></small></span></div></div><div class=col-xs-4><div class=form-group><label class=control-label>Studies</label><ui-select multiple ng-model=selections.l1 theme=bootstrap eui-index="\'cbh_queries\'" eui-enabled=true eui-filter="ejs.TermFilter(\'level_from\', \'l1\')"><span eui-enabled="selections.l0.length > 0" eui-filter="ejs.TermsFilter(\'l0.resource_uri.raw\', selections.l0)"></span> <span eui-query="ejs.MultiMatchQuery([\'l1.project_data_all\'], $select.search).type(\'phrase_prefix\')" eui-enabled=$select.search></span><ui-select-match placeholder="&#9660;&nbsp;Select Sub Project...">{{$item._source.l1.project_data.Title}}</ui-select-match><ui-select-choices repeat="childItem._source.l1.resource_uri as childItem in indexVM.results.hits.hits"><div ng-bind-html=childItem._source.l1.project_data.Title></div></ui-select-choices></ui-select><span class=pull-right><small><a ng-click="clearSelections(\'l1\')">Clear</a></small></span></div></div><div class=col-xs-4><div class=form-group><label class=control-label>Assays</label><ui-select multiple ng-model=selections.l2 theme=bootstrap eui-index="\'cbh_queries\'" eui-enabled=true eui-filter="ejs.TermFilter(\'level_from\', \'l2\')"><span eui-enabled="selections.l0.length > 0" eui-filter="ejs.TermsFilter(\'l0.resource_uri.raw\', selections.l0)"></span> <span eui-enabled="selections.l1.length > 0" eui-filter="ejs.TermsFilter(\'l1.resource_uri.raw\', selections.l1)"></span> <span eui-query="ejs.MultiMatchQuery([\'l2.project_data_all\'], $select.search).type(\'phrase_prefix\')" eui-enabled=$select.search></span><ui-select-match placeholder="&#9660;&nbsp;Select Assay...     ">{{$item._source.l2.project_data.Title}}</ui-select-match><ui-select-choices repeat="childItem._source.l2.resource_uri as childItem in indexVM.results.hits.hits"><div ng-bind-html=childItem._source.l2.project_data.Title></div></ui-select-choices></ui-select><span class=pull-right><small><a ng-click="clearSelections(\'l2\')">Clear</a></small></span></div></div></div><div class=row><div class=col-xs-12><div class=pull-right><button class="btn btn-lg btn-danger" role=button ng-click=resetForm()><span class="glyphicon glyphicon-remove"></span> Reset</button></div></div></div></div><div class="row mt"><div class=col-xs-12><div eui-index="\'cbh_queries\'" eui-enabled=true eui-filter="ejs.TermFilter(\'level_from\', \'l3\')" eui-sort="ejs.Sort(\'modified\').order(\'desc\')"><h2 class=subheading>{{indexVM.results.hits.total}} Results</h2><div class=pull-right><span><input eui-query="ejs.MultiMatchQuery([\'l0.project_data_all\',\'l1.project_data_all\',\'l2.project_data_all\',\'l3.project_data_all\'], cbh.textsearch).type(\'phrase_prefix\')" ng-model=cbh.textsearch eui-enabled=cbh.textsearch eui-highlight="ejs.Highlight(\'*\').preTags(\'<span class=\\\'highlighted\\\'>\').postTags(\'</span>\')"></span> <span></span> <span ng-include="\'views/templates/download-results.html\'"></span></div><span eui-enabled="selections.l0.length > 0" eui-filter="ejs.TermsFilter(\'l0.resource_uri.raw\', selections.l0)"></span> <span eui-enabled="selections.l1.length > 0" eui-filter="ejs.TermsFilter(\'l1.resource_uri.raw\', selections.l1)"></span> <span eui-enabled="selections.l2.length > 0" eui-filter="ejs.TermsFilter(\'l2.resource_uri.raw\', selections.l2)"></span> <span eui-enabled="dates.startES != \'\'" eui-filter="ejs.RangeFilter(\'l3.created\').gte(dates.startES)"></span> <span eui-enabled="dates.endES != \'\'" eui-filter="ejs.RangeFilter(\'l3.created\').lte(dates.endES)"></span> <span eui-enabled=cbh.textsearch eui-query="ejs.MultiMatchQuery([\'l0.project_data_all\',\'l1.project_data_all\',\'l2.project_data_all\',\'l3.project_data_all\'], cbh.textsearch).type(\'phrase_prefix\')"></span> <span eui-enabled="userData.useruris.length > 0" eui-filter="ejs.TermsFilter(\'l3.created_by.raw\', userData.useruris)"></span> <span eui-enabled=true eui-highlight="ejs.Highlight(\'l0.*\').preTags(\'<span class=\\\'highlighted\\\'>\').postTags(\'</span>\')"></span><table class="table table-striped"><thead><tr><th><small>Structure</small></th><th><small>Standardised Activity</small></th><th><small>Activity Details</small></th><th><small>Assay</small></th><th><small>Sub-Project</small></th><th><small>Project</small></th><th><small>Added</small></th></tr></thead><tbody><tr ng-repeat="childItem in indexVM.results.hits.hits"><td><img ng-if=childItem._source.imgSrc ng-src=data:image/png;base64,{{childItem._source.imgSrc}}></td><td><a ng-click="showDetailPopup(childItem._source.l3.custom_field_config, childItem._source.l3.project_data)">View Activity Details</a></td><td>{{childItem._source.chembl.activities.published_type}}&nbsp;-&nbsp;{{childItem._source.chembl.activities.published_value}}{{childItem._source.chembl.activities.published_units}} <a ng-if=childItem._source.chembl ng-click=showChemblPopup(childItem._source.chembl)>View deposition preview</a></td><td><a ng-click="showDetailPopup(childItem._source.l2.custom_field_config, childItem._source.l2.project_data)">{{childItem._source.l2.project_data.Title}}</a><br></td><td><a ng-click="showDetailPopup(childItem._source.l1.custom_field_config, childItem._source.l1.project_data)">{{childItem._source.l1.project_data.Title}}</a><br></td><td><a ng-click="showDetailPopup(childItem._source.l0.custom_field_config, childItem._source.l0.project_data)">{{childItem._source.l0.project_data.Title}}</a><br></td><td>{{childItem._source.l3.created | date : \'dd MMM yyyy\'}}</td></tr><tr ng-if="indexVM.results.hits.hits.length == 0" class=text-center><td colspan="{{(1+ dpclassif.next_level_cfc.project_data_fields.length)}}" class=text-center>No results</td></tr></tbody></table><div class=text-center><ul class=pager><li>{{indexVM.results.hits.total}} results</li><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=1">First</a></li><li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=indexVM.page - 1">Previous</a></li><li>Page {{indexVM.page}} of {{indexVM.pageCount}}</li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.page + 1">Next</a></li><li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.pageCount">Last</a></li><li><select ng-model=indexVM.pageSize><option ng-repeat="item in [5, 10, 20]">{{item}}</option></select>per page</li></ul></div></div></div></div></div><script type=text/javascript>$(\'.datepicker\').pickadate({\n  // Escape any “rule” characters with an exclamation mark (!).\n  format: \'dd mmm, yyyy\',\n  formatSubmit: \'yyyy-MM-dd\',\n});</script>'),a.put("views/single-compound.html","<div ng-include=\"'views/templates/single-compound-full.html'\"></div>"),a.put("views/start.html",'<app-progress wizard=wizard></app-progress><div class=col-xs-12 flow-init=flowinit flow-name=filedata.flow flow-files-submitted=$flow.upload() flow-file-success="assignFileId($file.uniqueIdentifier, $file.getExtension())" flow-upload-started="filesUploading=true" flow-complete="filesUploading=false"><div class=form-views ui-view></div></div>'),a.put("views/statuses.html",'<div class=modal-header><button type=button class="close pull-right" data-dismiss=alert aria-label=Close ng-click="modalInstance.dismiss(\'cancel\');"><span aria-hidden=true class="glyphicon glyphicon-remove-circle"></span></button><h2 class="modal-title blue nexa">What do the statuses mean?</h2></div><div class=modal-body><div class=row><h3 class="blue text-center">Info column</h3><div class=col-xs-12><dl class=dl-horizontal><dt ng-repeat-start="leg in legends" style=margin-bottom:5px>{{leg.name}}</dt><dd ng-repeat-end style=margin-bottom:5px>{{leg.explanation}}</dd></dl></div><h3 class="blue text-center">Action column</h3><div class=col-xs-12><dl class=dl-horizontal><dt ng-repeat-start="act in actions" style=margin-bottom:5px>{{act.name}}</dt><dd ng-repeat-end style=margin-bottom:5px>{{act.explanation}}</dd></dl></div></div><div class=row><div class="col-xs-12 text-center">if you have any further questions please <a role=button class="btn btn-sm btn-default" href="mailto:info@chembiohub.ox.ac.uk?subject=AssayReg%20Info">contact us</a></div></div></div><div class=modal-footer><button class="btn btn-danger" ng-click="modalInstance.dismiss(\'cancel\');">Close</button></div>'),a.put("views/user-profile.html",'<div class=container-flex><div class=row><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-user"></span> <span ng-if=userFromList.first_name>{{ userFromList.first_name }} {{ userFromList.last_name }}</span> <span ng-if=!userFromList.first_name>{{ userFromList.username }}</span><br><small>Member since {{ userFromList.date_joined | date }}</small> <small ng-if=userFromList.is_superuser><span class="glyphicon glyphicon-star"></span> Admin User</small></h2></div></div><div class=row><div class=col-xs-3><h2 class=subheading>Saved Searches</h2><div class=row style="margin-bottom:15px; margin-left:10px; margin-right:10px; border-radius:10px"><div class=col-xs-12><div ng-include="\'views/templates/my-searches-list.html\'" ng-init="links = links;"></div></div></div></div></div></div>'),a.put("views/users-list.html",'<div class="row mt"><div class=col-xs-12><h2 class="blue nexa"><span class="glyphicon glyphicon-user"></span> AssayReg Users<br><small>Click a user name to see the user activity in more detail</small></h2></div></div><div class=row><div class="col-xs-6 col-sm-3" ng-repeat="user in users"><div class="well projectbox"><p class=nexa><strong><a ui-sref="cbh.user({username: user.username})"><span ng-if=user.first_name>{{ user.first_name }} {{ user.last_name }}</span> <span ng-if=!user.first_name>{{ user.username }}</span></a></strong><br><span class="glyphicon glyphicon-time"></span> <small>Last login: {{ user.last_login | date }}</small><br><span class="glyphicon glyphicon-check"></span> <small>Member Since: {{ user.date_joined | date }}</small></p></div></div></div>'),a.put("views/view-data.html",'<div class=container><div class=row><div class=col-xs-12><a ui-sref="cbh.projects.project.assay.data_overview({projectKey : projectKey})"><h2 class="nexa blue"><small><span class="glyphicon glyphicon-circle-arrow-left"></span>&nbsp;Back to project overview</small></h2></a></div></div><div class=row><div class=col-xs-12><h2 class=blue><span class="glyphicon glyphicon-list"></span> View Studies<br><a ui-sref=cbh.projects.list></a></h2></div></div><div ng-repeat="(levelindex, level) in levels = [\'l0\', \'l1\', \'l2\', \'l3\' ]"><div class=row><div ng-repeat="form in assayctrl.proj.enabled_forms"><div class=row ng-if="form.id == viewctrl.dc"><div class=col-xs-12 style="border: 1px solid #444; padding:10px; border-radius:5px; margin-bottom:20px" eui-index="\'cbh_queries\'" eui-filter="ejs.BoolFilter().must(ejs.TermFilter(\'data_form_config.raw\' , form.resource_uri)).must(ejs.TermFilter(\'level_from\', level)).must(ejs.TermFilter(\'l0_permitted_projects.raw\', assayctrl.proj.resource_uri))" eui-enabled=true><div><small>{{form[level].data_type.name}}</small><br><strong class=nexa>{{form[level].name}}</strong></div><div class=table-responsive><table class=table><thead><tr><th>Actions</th><th ng-repeat="field in form[level].project_data_fields">{{field.name}}</th></tr></thead><tbody><tr ng-repeat="hit in indexVM.results.hits.hits"><td style="min-width:100px; max-width:200px"><div class=btn-group dropdown><button id=single-button type=button class="btn btn-default" dropdown-toggle><span class="glyphicon glyphicon-plus"></span> <span class="glyphicon glyphicon-pencil"></span><span class=caret></span></button><ul class=dropdown-menu role=menu aria-labelledby=single-button><li ng-if="levelindex < 3" role=menuitem><a href=# ui-sref="cbh.projects.project.assay.add_data({\'dc\': hit._source.id, \'projectKey\': projectKey, \'lev\': levels[levelindex+1], \'data_form_id\' : viewctrl.dc })">Add {{ assayctrl.proj.enabled_forms[$parent.$index ][levels[levelindex+1]].data_type.name }}<br>to this {{ form[level].data_type.name }}</a></li></ul></div></td><td ng-repeat="field in form[level].project_data_fields">{{hit._source[level].project_data[field.elasticsearch_fieldname]}}</td></tr></tbody></table></div></div></div></div></div></div></div>')}]);